<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Travel Phrase Flashcards</title>
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --card:#111827;
      --cardEdge:#1f2937;    /* gray-800 */
      --text:#e5e7eb;        /* gray-200 */
      --muted:#9ca3af;       /* gray-400 */
      --accent:#22c55e;      /* green-500 */
      --accent-2:#3b82f6;    /* blue-500 */
      --warn:#f59e0b;        /* amber-500 */
      --danger:#ef4444;      /* red-500 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
      --radius-sm: 10px;
      --transition: 280ms ease;
      --flip-duration: 600ms;
    }
    *{box-sizing:border-box}
    html,body{
      height:100%;
      background: radial-gradient(1200px 600px at 10% 10%, #0b1224 20%, #0f172a 60%) no-repeat, var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;
      margin:0;
    }
    a{color:inherit}
    button{
      background:#182235;
      color:var(--text);
      border:1px solid #233044;
      padding:.7rem 1rem;
      border-radius: var(--radius-sm);
      cursor:pointer;
      transition: transform var(--transition), background var(--transition), opacity var(--transition);
      font-weight:600;
    }
    button:hover{ transform: translateY(-1px); background:#1d2a41; }
    button:active{ transform: translateY(0); }
    button:disabled{ opacity:.55; cursor:not-allowed; transform:none; }
    .btn-accent{ background: linear-gradient(180deg, #1fb968, #16a34a); border-color: #16a34a; }
    .btn-blue{ background: linear-gradient(180deg, #4f8df7, #3b82f6); border-color:#3b82f6; }
    .btn-danger{ background: linear-gradient(180deg, #f87171, #ef4444); border-color:#ef4444; }
    .btn-ghost{ background: transparent; border:1px dashed #2a3a53; }
    header{
      display:flex; align-items:center; justify-content:space-between;
      padding: 18px clamp(16px, 4vw, 36px);
    }
    #uiTitle{ font-size: clamp(20px, 2.4vw, 28px); margin:0; letter-spacing:.2px }
    .header-right{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }
    #learningBadge{
      background:#0b1323;
      border:1px solid #20304d;
      padding:.5rem .75rem;
      border-radius:999px;
      color:var(--muted);
      font-weight:600;
    }
    main{
      max-width: 1100px;
      margin: 0 auto;
      padding: 10px clamp(16px, 4vw, 36px) 40px;
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:16px; flex-wrap:wrap;
      margin-bottom: 16px;
    }
    .progress-wrap{ display:flex; align-items:center; gap:14px; flex-wrap:wrap }
    #progressBar{
      width:min(44vw, 420px); height:10px; background:#0b1323; border:1px solid #20304d; border-radius:999px; overflow:hidden;
    }
    #progressFill{
      height:100%; width:0%; background: linear-gradient(90deg, var(--accent), #86efac);
      transition: width 400ms ease;
    }
    #progressText{ color:var(--muted); font-weight:600; font-size:.95rem }
    .controls{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }
    .card-area{ display:grid; place-items:center; gap:10px; }
    .card-scene{
      width:clamp(280px, 58vw, 680px);
      aspect-ratio: 16/10;
      perspective: 1000px;
      margin: 12px 0;
      filter: drop-shadow(var(--shadow));
    }
    .card{
      position:relative; width:100%; height:100%;
      transform-style: preserve-3d;
      transition: transform var(--flip-duration) cubic-bezier(.21,.66,.16,.99), box-shadow var(--transition);
      border-radius: var(--radius);
    }
    .card:focus{ outline: 2px solid #3b82f6; outline-offset: 4px; }
    .card:hover{ box-shadow: 0 14px 40px rgba(0,0,0,.45); }
    .card.flipped{ transform: rotateY(180deg); }
    .card-face{
      position:absolute; inset:0; display:flex; flex-direction:column; justify-content:space-between; align-items:stretch;
      background: linear-gradient(180deg, #0f1a2b, #0d1322);
      border:1px solid var(--cardEdge);
      border-radius: var(--radius);
      padding: 18px clamp(14px, 2.8vw, 24px);
      backface-visibility: hidden;
    }
    .card-back{ transform: rotateY(180deg); background: linear-gradient(180deg, #0d1423, #101827); }
    .lang-tag{
      align-self:flex-start; font-size:.8rem; letter-spacing:.4px;
      color:#a1a9b5; background:#0b1323; border:1px solid #25344d; padding:.25rem .5rem; border-radius:999px;
    }
    .phrase-text{
      display:flex; align-items:center; justify-content:center; text-align:center;
      font-size: clamp(20px, 3.6vw, 38px);
      line-height: 1.2;
      word-break: keep-all;
      padding: 12px;
      min-height: 70%;
    }
    .hint{
      color:var(--muted);
      font-size:.95rem;
      text-align:center;
      user-select:none;
    }
    .nav-controls{
      display:flex; align-items:center; justify-content:center;
      gap:10px; margin-top: 8px; flex-wrap:wrap;
    }
    .fly-out{
      animation: flyOut 420ms cubic-bezier(.4,.6,.2,1) forwards;
    }
    @keyframes flyOut{
      0%{ transform: translateX(0) rotate(0) scale(1); opacity:1 }
      60%{ transform: translateX(20px) rotate(2deg) scale(.98); opacity:.9 }
      100%{ transform: translateX(120px) rotate(6deg) scale(.92); opacity:0 }
    }
    .shuffle-pulse{ animation: pulse 400ms ease; }
    @keyframes pulse{ 0%{transform:scale(1)} 50%{transform:scale(1.03)} 100%{transform:scale(1)} }
    .all-done{
      text-align:center; color:#a7f3d0; background:linear-gradient(180deg,#083b2c,#062d23);
      border:1px solid #065f46; border-radius: var(--radius); padding: 16px;
      max-width: 680px; margin: 10px auto 0;
    }
    footer{
      color:var(--muted); font-size:.85rem; text-align:center; padding: 16px;
    }
    /* Overlay (language selection) */
    .overlay{
      position: fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background: rgba(3,6,14,.72);
      backdrop-filter: blur(6px);
      z-index: 50;
      padding: 20px;
      transition: opacity var(--transition), visibility var(--transition);
    }
    .overlay.hidden{ opacity:0; visibility:hidden; pointer-events:none }
    .modal{
      width: min(92vw, 720px);
      background: linear-gradient(180deg, #0b1323, #0c1426);
      border:1px solid #243049;
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: clamp(16px, 3vw, 26px);
    }
    .modal h2{ margin-top:0; margin-bottom: 10px; font-size: clamp(20px, 2.6vw, 28px) }
    .modal .grid{
      display:grid; grid-template-columns: repeat(auto-fit, minmax(120px,1fr));
      gap:10px; margin-top: 12px;
    }
    .modal .subtle{ color:var(--muted); margin:2px 0 12px }
    .sr-only{
      position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .card, #progressFill, .fly-out, .shuffle-pulse, button { transition: none !important; animation: none !important; }
    }
    @media (max-width: 600px){
      .controls{ justify-content:center }
      .topbar{ justify-content:center }
      #progressBar{ width: 68vw }
    }
  </style>
</head>
<body>
  <div id="startOverlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="choosePrompt">
    <div class="modal">
      <h2 id="choosePrompt">Which language would you like to learn?</h2>
      <p class="subtle" id="chooseSubtle">Your interface language has been set from your device locale.</p>
      <div class="grid">
        <button id="btnLearnEN" class="btn-blue" data-lang="en" aria-label="Learn English">English</button>
        <button id="btnLearnES" class="btn-accent" data-lang="es" aria-label="Learn Spanish">Español</button>
        <button id="btnLearnFR" class="btn-blue" data-lang="fr" aria-label="Learn French">Français</button>
        <button id="btnLearnJA" class="btn-blue" data-lang="ja" aria-label="Learn Japanese">日本語</button>
      </div>
      <div style="display:flex; gap:10px; align-items:center; margin-top:14px; flex-wrap:wrap">
        <button id="continueLastBtn" class="btn-ghost" style="display:none"></button>
      </div>
    </div>
  </div>

  <header>
    <h1 id="uiTitle">Travel Phrase Flashcards</h1>
    <div class="header-right">
      <span id="learningBadge">Learning: —</span>
      <button id="changeLangBtn" class="btn-ghost" aria-haspopup="dialog">Change target language</button>
    </div>
  </header>

  <main>
    <section class="topbar" aria-label="Progress and actions">
      <div class="progress-wrap">
        <div id="progressBar" aria-hidden="true"><div id="progressFill"></div></div>
        <div id="progressText" aria-live="polite">Learned 0 of 10</div>
      </div>
      <div class="controls">
        <button id="shuffleBtn" title="Shuffle (S)">Shuffle</button>
        <button id="resetBtn" class="btn-danger" title="Reset learned">Reset learned</button>
      </div>
    </section>

    <section class="card-area" aria-label="Flashcard">
      <div class="card-scene">
        <div id="card" class="card" tabindex="0" role="button" aria-pressed="false" aria-describedby="uiHint">
          <div id="cardFront" class="card-face card-front">
            <div id="frontLangTag" class="lang-tag">Front</div>
            <div id="frontText" class="phrase-text">—</div>
          </div>
          <div id="cardBack" class="card-face card-back">
            <div id="backLangTag" class="lang-tag">Back</div>
            <div id="backText" class="phrase-text">—</div>
          </div>
        </div>
      </div>
      <div class="hint" id="uiHint">Click or press Space to flip the card</div>
    </section>

    <section class="nav-controls" aria-label="Navigation">
      <button id="prevBtn" title="Previous (←)">⟵ <span data-i18n="prev">Previous</span></button>
      <button id="markLearnedBtn" class="btn-accent" title="Mark as learned (L)"><span data-i18n="learned">Mark as learned</span> ✓</button>
      <button id="nextBtn" title="Next (→)"><span data-i18n="next">Next</span> ⟶</button>
    </section>

    <div id="allDoneBox" class="all-done" style="display:none"></div>

    <div id="ariaStatus" class="sr-only" aria-live="polite"></div>
  </main>

  <footer>
    Shortcuts: Space to flip, ←/→ to navigate, L to mark learned, S to shuffle.
  </footer>

  <script>
    (function(){
      const phrases = {
        en: [
          "How are you?",
          "What is your name?",
          "Where is the bathroom?",
          "Where is the train station?",
          "How much is this?",
          "Do you speak English?",
          "Can you help me?",
          "What time is it?",
          "Where can I get a taxi?",
          "Where can I find a good restaurant?"
        ],
        es: [
          "¿Cómo estás?",
          "¿Cómo te llamas?",
          "¿Dónde está el baño?",
          "¿Dónde está la estación de tren?",
          "¿Cuánto cuesta esto?",
          "¿Habla inglés?",
          "¿Puede ayudarme?",
          "¿Qué hora es?",
          "¿Dónde puedo tomar un taxi?",
          "¿Dónde hay un buen restaurante?"
        ],
        fr: [
          "Comment allez-vous ?",
          "Comment vous appelez-vous ?",
          "Où sont les toilettes ?",
          "Où est la gare ?",
          "Combien ça coûte ?",
          "Parlez-vous anglais ?",
          "Pouvez-vous m'aider ?",
          "Quelle heure est-il ?",
          "Où puis-je prendre un taxi ?",
          "Où puis-je trouver un bon restaurant ?"
        ],
        ja: [
          "お元気ですか。",
          "お名前は何ですか。",
          "トイレはどこですか。",
          "駅はどこですか。",
          "これはいくらですか。",
          "英語を話せますか。",
          "手伝ってもらえますか。",
          "今は何時ですか。",
          "タクシーはどこで乗れますか。",
          "いいレストランはどこですか。"
        ]
      };

      const ui = {
        en: {
          title: "Travel Phrase Flashcards",
          choose: "Which language would you like to learn?",
          chooseSubtle: "Your interface language has been set from your device locale.",
          changeLanguage: "Change target language",
          learning: "Learning: {lang}",
          progress: "Learned {learned} of {total}",
          hint: "Click or press Space to flip the card",
          allDone: "All cards learned! Great job.",
          prev: "Previous",
          next: "Next",
          shuffle: "Shuffle",
          learnedBtn: "Mark as learned",
          reset: "Reset learned",
          continue: "Continue with {lang}",
          names: { en:"English", es:"Spanish", fr:"French", ja:"Japanese" }
        },
        es: {
          title: "Tarjetas de frases de viaje",
          choose: "¿Qué idioma quieres aprender?",
          chooseSubtle: "El idioma de la interfaz se estableció según la configuración de tu dispositivo.",
          changeLanguage: "Cambiar idioma objetivo",
          learning: "Aprendiendo: {lang}",
          progress: "Aprendidas {learned} de {total}",
          hint: "Haz clic o presiona Espacio para voltear la tarjeta",
          allDone: "¡Todas las tarjetas aprendidas! Buen trabajo.",
          prev: "Anterior",
          next: "Siguiente",
          shuffle: "Barajar",
          learnedBtn: "Marcar como aprendido",
          reset: "Reiniciar aprendidas",
          continue: "Continuar con {lang}",
          names: { en:"Inglés", es:"Español", fr:"Francés", ja:"Japonés" }
        },
        fr: {
          title: "Cartes de phrases de voyage",
          choose: "Quelle langue voulez-vous apprendre ?",
          chooseSubtle: "La langue de l'interface a été définie à partir de votre appareil.",
          changeLanguage: "Changer la langue cible",
          learning: "Apprentissage : {lang}",
          progress: "{learned} sur {total} appris",
          hint: "Cliquez ou appuyez sur Espace pour retourner la carte",
          allDone: "Toutes les cartes sont apprises ! Bravo.",
          prev: "Précédent",
          next: "Suivant",
          shuffle: "Mélanger",
          learnedBtn: "Marquer comme appris",
          reset: "Réinitialiser appris",
          continue: "Continuer en {lang}",
          names: { en:"Anglais", es:"Espagnol", fr:"Français", ja:"Japonais" }
        },
        ja: {
          title: "旅行フレーズのフラッシュカード",
          choose: "学びたい言語はどれですか？",
          chooseSubtle: "インターフェース言語は端末の言語設定から自動選択されています。",
          changeLanguage: "学習する言語を変更",
          learning: "学習中：{lang}",
          progress: "{total}枚中{learned}枚を学習",
          hint: "クリックまたはスペースキーでカードをめくります",
          allDone: "すべてのカードを学習しました。お疲れさま！",
          prev: "前へ",
          next: "次へ",
          shuffle: "シャッフル",
          learnedBtn: "学習済みにする",
          reset: "学習をリセット",
          continue: "{lang}を続ける",
          names: { en:"英語", es:"スペイン語", fr:"フランス語", ja:"日本語" }
        }
      };

      // DOM references
      const startOverlay = document.getElementById('startOverlay');
      const choosePrompt = document.getElementById('choosePrompt');
      const chooseSubtle = document.getElementById('chooseSubtle');
      const continueLastBtn = document.getElementById('continueLastBtn');

      const uiTitle = document.getElementById('uiTitle');
      const changeLangBtn = document.getElementById('changeLangBtn');
      const learningBadge = document.getElementById('learningBadge');

      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');

      const card = document.getElementById('card');
      const frontText = document.getElementById('frontText');
      const backText = document.getElementById('backText');
      const frontLangTag = document.getElementById('frontLangTag');
      const backLangTag = document.getElementById('backLangTag');
      const hint = document.getElementById('uiHint');

      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const shuffleBtn = document.getElementById('shuffleBtn');
      const markLearnedBtn = document.getElementById('markLearnedBtn');
      const resetBtn = document.getElementById('resetBtn');
      const allDoneBox = document.getElementById('allDoneBox');
      const ariaStatus = document.getElementById('ariaStatus');

      const btnLearnEN = document.getElementById('btnLearnEN');
      const btnLearnES = document.getElementById('btnLearnES');
      const btnLearnFR = document.getElementById('btnLearnFR');
      const btnLearnJA = document.getElementById('btnLearnJA');

      // State
      const ALL_LANGS = ['en','es','fr','ja'];
      let uiLang = detectUiLang();
      let targetLang = null;
      let order = [...Array(10).keys()];
      let currentPos = 0; // index in 'order'
      let learned = new Set(); // indexes learned
      const STORAGE_PREFIX = 'fc_v1_';

      function detectUiLang(){
        const nav = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
        const code = nav.slice(0,2);
        return ALL_LANGS.includes(code) ? code : 'en';
      }

      function t(key, vars={}){
        const dict = ui[uiLang] || ui.en;
        let str = dict[key] || ui.en[key] || key;
        for(const k in vars){ str = str.replace(`{${k}}`, vars[k]); }
        return str;
      }

      function langName(code){
        const dict = ui[uiLang] || ui.en;
        return (dict.names && dict.names[code]) ? dict.names[code] : code;
      }

      function setUiText(){
        document.documentElement.lang = uiLang;
        uiTitle.textContent = t('title');
        changeLangBtn.textContent = t('changeLanguage');
        choosePrompt.textContent = t('choose');
        chooseSubtle.textContent = t('chooseSubtle');
        document.querySelector('[data-i18n="prev"]')?.replaceChildren(t('prev'));
        document.querySelector('[data-i18n="next"]')?.replaceChildren(t('next'));
        shuffleBtn.textContent = t('shuffle');
        markLearnedBtn.firstChild && (markLearnedBtn.firstChild.nodeType === 3 ? markLearnedBtn.firstChild.nodeValue = t('learnedBtn') + ' ' : markLearnedBtn.firstChild.textContent = t('learnedBtn'));
        resetBtn.textContent = t('reset');
        hint.textContent = t('hint');
        btnLearnEN.textContent = langName('en');
        btnLearnES.textContent = langName('es');
        btnLearnFR.textContent = langName('fr');
        btnLearnJA.textContent = langName('ja');
        updateLearningBadge();
        updateProgress();
        updateCardLangTags();
        // continue button (if available)
        const last = localStorage.getItem(STORAGE_PREFIX + 'lastTarget');
        if(last && ALL_LANGS.includes(last)){
          continueLastBtn.style.display = 'inline-flex';
          continueLastBtn.textContent = t('continue', { lang: langName(last) });
          continueLastBtn.dataset.lang = last;
        }else{
          continueLastBtn.style.display = 'none';
        }
      }

      function updateLearningBadge(){
        learningBadge.textContent = t('learning', { lang: targetLang ? langName(targetLang) : '—' });
      }

      function updateProgress(){
        const total = order.length;
        const learnedCount = learned.size;
        const pct = Math.round((learnedCount/total)*100);
        progressFill.style.width = `${pct}%`;
        progressText.textContent = t('progress', { learned: learnedCount, total });
      }

      function updateCardLangTags(){
        frontLangTag.textContent = langName(uiLang);
        backLangTag.textContent = targetLang ? langName(targetLang) : '—';
      }

      function renderCard(){
        const idx = getCurrentIndex();
        if(idx === -1){
          showAllDone();
          return;
        }
        hideAllDone();
        const front = phrases[uiLang][idx];
        const back = phrases[targetLang][idx];
        frontText.textContent = front;
        backText.textContent = back;
        updateCardLangTags();
        // Reset flip state
        card.classList.remove('flipped');
        card.setAttribute('aria-pressed', 'false');
      }

      function showAllDone(){
        allDoneBox.style.display = 'block';
        allDoneBox.textContent = t('allDone');
        frontText.textContent = '✓';
        backText.textContent = '✓';
        card.classList.remove('flipped');
        card.setAttribute('aria-pressed','false');
        markLearnedBtn.disabled = true;
        nextBtn.disabled = true;
        prevBtn.disabled = false; // allow browsing anyway, but no cards; keep prev enabled to avoid trapping
      }

      function hideAllDone(){
        allDoneBox.style.display = 'none';
        markLearnedBtn.disabled = false;
        nextBtn.disabled = false;
      }

      function getCurrentIndex(){
        // Find nearest unlearned starting from currentPos
        // If all learned, return -1
        if(learned.size >= order.length) return -1;
        // Ensure currentPos points to an unlearned index
        if(learned.has(order[currentPos])){
          const next = findNextPos(1);
          if(next !== -1) currentPos = next;
        }
        return order[currentPos];
      }

      function findNextPos(step){
        const total = order.length;
        for(let i=1;i<=total;i++){
          const pos = (currentPos + step*i + total) % total;
          if(!learned.has(order[pos])) return pos;
        }
        return -1;
      }

      function go(step){
        const next = findNextPos(step);
        if(next !== -1){
          currentPos = next;
          renderCard();
          bumpCard();
        }
      }

      function bumpCard(){
        card.classList.add('shuffle-pulse');
        setTimeout(()=>card.classList.remove('shuffle-pulse'), 420);
      }

      function shuffleDeck(){
        // Fisher-Yates shuffle order array, preserving learned set as is
        for(let i=order.length-1;i>0;i--){
          const j = Math.floor(Math.random()*(i+1));
          [order[i], order[j]] = [order[j], order[i]];
        }
        // Move currentPos to first unlearned
        for(let i=0;i<order.length;i++){
          if(!learned.has(order[i])){ currentPos = i; break; }
        }
        bumpCard();
        renderCard();
        saveState();
        ariaStatus.textContent = t('shuffle');
      }

      function markLearned(){
        const idx = getCurrentIndex();
        if(idx === -1) return;
        if(learned.has(idx)) { go(1); return; }
        // Animate out
        card.classList.add('fly-out');
        setTimeout(()=>{
          learned.add(idx);
          saveState();
          updateProgress();
          card.classList.remove('fly-out');
          const nextPos = findNextPos(1);
          if(nextPos !== -1){
            currentPos = nextPos;
            renderCard();
          }else{
            showAllDone();
          }
          ariaStatus.textContent = uiLang === 'ja' ? '学習済みにしました' : (uiLang === 'fr' ? 'Marqué comme appris' : (uiLang === 'es' ? 'Marcado como aprendido' : 'Marked as learned'));
        }, 420);
      }

      function resetLearned(){
        learned.clear();
        saveState();
        updateProgress();
        // Set current to first in order
        currentPos = 0;
        renderCard();
        ariaStatus.textContent = t('reset');
      }

      function flipCard(){
        const flipped = card.classList.toggle('flipped');
        card.setAttribute('aria-pressed', flipped ? 'true' : 'false');
      }

      function startWith(lang){
        if(!ALL_LANGS.includes(lang)) return;
        targetLang = lang;
        updateLearningBadge();
        // Load state
        loadState();
        // Ensure order length matches phrases
        order = [...Array(phrases.en.length).keys()];
        // Set current position to first unlearned
        currentPos = 0;
        for(let i=0;i<order.length;i++){
          if(!learned.has(order[i])){ currentPos = i; break; }
        }
        renderCard();
        updateProgress();
        // Hide overlay
        startOverlay.classList.add('hidden');
        localStorage.setItem(STORAGE_PREFIX + 'lastTarget', targetLang);
      }

      function loadState(){
        const key = STORAGE_PREFIX + 'learned_' + targetLang;
        try{
          const raw = localStorage.getItem(key);
          learned = new Set(raw ? JSON.parse(raw) : []);
        }catch(e){ learned = new Set(); }
      }

      function saveState(){
        const key = STORAGE_PREFIX + 'learned_' + targetLang;
        try{
          localStorage.setItem(key, JSON.stringify([...learned]));
        }catch(e){}
      }

      // Event bindings
      [btnLearnEN, btnLearnES, btnLearnFR, btnLearnJA, continueLastBtn].forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const lang = e.currentTarget.dataset.lang;
          startWith(lang);
        });
      });

      changeLangBtn.addEventListener('click', ()=>{
        startOverlay.classList.remove('hidden');
      });

      shuffleBtn.addEventListener('click', shuffleDeck);
      prevBtn.addEventListener('click', ()=>go(-1));
      nextBtn.addEventListener('click', ()=>go(1));
      markLearnedBtn.addEventListener('click', markLearned);
      resetBtn.addEventListener('click', resetLearned);

      card.addEventListener('click', flipCard);
      card.addEventListener('keydown', (e)=>{
        if(e.key === ' ' || e.key === 'Enter'){
          e.preventDefault();
          flipCard();
        }
      });

      document.addEventListener('keydown', (e)=>{
        // ignore when overlay is open (ask screen)
        if(!startOverlay.classList.contains('hidden')) return;

        if(e.key === 'ArrowLeft'){ e.preventDefault(); go(-1); }
        else if(e.key === 'ArrowRight'){ e.preventDefault(); go(1); }
        else if(e.key.toLowerCase() === 'l'){ e.preventDefault(); markLearned(); }
        else if(e.key.toLowerCase() === 's'){ e.preventDefault(); shuffleDeck(); }
        else if(e.key === ' '){ /* allow card to handle */ }
      });

      // Initialize
      setUiText();
      // If we know last target, keep continue button visible; user still must choose
      // Also pre-fill header badge
      updateLearningBadge();

      // Adjust UI language strings if the browser language changes on the fly (rare)
      // Not essential to handle, but keep function accessible.
      window.addEventListener('languagechange', ()=>{
        uiLang = detectUiLang();
        setUiText();
        if(targetLang){ renderCard(); }
      });

      // Utility: ensure app fits 1280x720; it’s responsive by design.

      // Accessibility: update ARIA with current languages
      updateCardLangTags();

      // If target selected before (lastTarget), we could auto-open? Spec says ask, so we keep overlay.
    })();
  </script>
</body>
</html>