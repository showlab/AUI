<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Online Poll Board</title>
  <meta name="description" content="Vote on fun topics and see live results with smooth animations.">
  <style>
    :root{
      --bg-1:#f9fbff;
      --bg-2:#f6f6ff;
      --bg-3:#eefaff;
      --card:#ffffff;
      --text:#1f2430;
      --muted:#6b7280;
      --primary:#6a72ff;
      --primary-600:#5b63e6;
      --accent:#ffb86b;
      --good:#00bfa6;
      --danger:#ff6b88;
      --ring: rgba(106,114,255,0.35);

      --shadow: 0 10px 30px rgba(16,24,40,0.08), 0 4px 6px rgba(16,24,40,0.06);
      --radius: 16px;
      --radius-sm: 12px;
      --radius-xs: 9px;
      --space: clamp(16px, 2vw, 24px);
      --space-sm: clamp(10px, 1.5vw, 16px);
      --space-xs: 8px;
      --maxw: 1100px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 800px at -10% -10%, var(--bg-3), transparent 60%),
        radial-gradient(900px 600px at 110% 10%, #fff3f8, transparent 50%),
        radial-gradient(700px 600px at 50% 120%, #f3fff9, transparent 55%),
        linear-gradient(180deg, var(--bg-1), var(--bg-2));
      background-attachment: fixed;
    }

    header#app-header{
      position: sticky;
      top:0;
      backdrop-filter: saturate(1.2) blur(6px);
      background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.65));
      z-index: 10;
      border-bottom: 1px solid rgba(16,24,40,0.06);
    }
    .header-inner{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 18px var(--space);
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: var(--space);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:16px;
    }
    .brand-logo{
      width:44px;height:44px;border-radius:12px;
      background: conic-gradient(from 210deg, var(--primary), #a0b1ff, #9bf0e1, var(--accent), var(--primary));
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.8), 0 8px 18px rgba(106,114,255,0.25);
      position:relative;
      overflow:hidden;
    }
    .brand-logo::after{
      content:"";
      position:absolute; inset: 4px 6px auto auto;
      width:10px;height:10px;border-radius:50%;
      background: #fff; opacity:.9;
      filter: blur(.5px);
    }
    .brand h1{
      font-size: clamp(18px, 2.4vw, 24px);
      margin:0;
      letter-spacing:.2px;
    }
    .brand p{
      margin: 2px 0 0 0;
      color:var(--muted);
      font-size: 14px;
    }

    .controls{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap: wrap;
    }
    .search{
      position:relative;
      flex: 1 1 260px;
      min-width: 240px;
      max-width: 420px;
    }
    .search input{
      width:100%;
      padding: 12px 14px 12px 40px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid rgba(16,24,40,0.08);
      outline:none;
      transition: border-color .2s, box-shadow .2s;
      box-shadow: 0 2px 8px rgba(16,24,40,0.05) inset;
    }
    .search input:focus{
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--ring);
    }
    .search .icon{
      position:absolute; left:12px; top:50%; transform:translateY(-50%);
      width:18px;height:18px; opacity:.6;
    }
    button.btn{
      appearance: none;
      border:none;
      background: var(--primary);
      color:#fff;
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 600;
      cursor:pointer;
      box-shadow: 0 6px 16px rgba(106,114,255,0.35);
      transition: transform .05s ease, box-shadow .2s ease, background .2s ease;
    }
    button.btn:hover{ background: var(--primary-600) }
    button.btn:active{ transform: translateY(1px) }
    button.btn.secondary{
      background: #fff;
      color: var(--text);
      border: 1px solid rgba(16,24,40,0.12);
      box-shadow: 0 4px 12px rgba(16,24,40,0.08);
    }

    main{
      max-width: var(--maxw);
      margin: 16px auto 80px;
      padding: 0 var(--space);
    }
    .status-row{
      margin: 12px 0 18px;
      display:flex; align-items:center; gap: 12px; flex-wrap:wrap;
      color: var(--muted);
      font-size: 14px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      background: #fff;
      border:1px solid rgba(16,24,40,0.08);
      padding: 6px 10px; border-radius: 999px;
      box-shadow: 0 2px 8px rgba(16,24,40,0.05);
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: var(--space);
    }

    article.poll-card{
      grid-column: span 12;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      border: 1px solid rgba(16,24,40,0.06);
      transition: transform .2s ease, box-shadow .2s ease;
      overflow: hidden;
      position: relative;
      isolation: isolate;
    }
    @media (min-width: 980px){
      article.poll-card{ grid-column: span 6; }
    }
    article.poll-card::before{
      content:"";
      position:absolute; inset: -40px -20px auto auto;
      width: 160px; height: 160px; border-radius: 50%;
      background: radial-gradient(closest-side, rgba(106,114,255,0.12), transparent);
      z-index:-1;
    }
    article.poll-card:hover{
      transform: translateY(-2px);
      box-shadow: 0 16px 36px rgba(16,24,40,0.12), 0 4px 10px rgba(16,24,40,0.08);
    }

    .poll-head{
      display:flex; align-items:flex-start; justify-content: space-between; gap: 10px;
      margin-bottom: 12px;
    }
    .poll-title{
      margin:0;
      font-size: 20px;
    }
    .poll-desc{
      margin:6px 0 0 0;
      color: var(--muted);
      font-size: 14px;
    }
    .poll-actions{
      display:flex; gap: 8px; align-items:center;
    }
    .poll-actions button{ font-size: 13px; padding: 8px 10px }

    .options{
      display:grid;
      gap: 8px;
      margin: 14px 0;
    }
    .option-btn{
      width:100%;
      display:flex; align-items:center; justify-content: space-between;
      padding: 12px 14px;
      background: #ffffff;
      border: 1px solid rgba(16,24,40,0.10);
      border-radius: var(--radius-sm);
      cursor:pointer;
      transition: border-color .2s ease, box-shadow .2s ease, transform .04s ease, background .2s ease;
      position: relative;
      overflow: hidden;
    }
    .option-btn:hover{
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--ring);
    }
    .option-btn:active{ transform: translateY(1px) }
    .option-btn.selected{
      background: linear-gradient(180deg, #f7f8ff, #ffffff);
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--ring);
    }
    .option-label{
      display:flex; align-items:center; gap: 10px;
      font-weight: 600;
    }
    .chip{
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #f6f7ff;
      color: var(--primary);
      border:1px solid rgba(106, 114, 255, .25);
    }
    .plus-float{
      position:absolute;
      left:50%; top:50%;
      transform: translate(-50%, -20%);
      font-weight:700;
      color: var(--good);
      pointer-events:none;
      opacity:0;
      animation: popUp .7s ease-out forwards;
      text-shadow: 0 0 0 rgba(0,0,0,0);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.12));
    }
    @keyframes popUp{
      0%{ transform: translate(-50%, -10%) scale(.9); opacity:0 }
      20%{ opacity:1 }
      60%{ transform: translate(-50%, -60%) scale(1.08) }
      100%{ transform: translate(-50%, -90%) scale(1); opacity:0 }
    }

    .results{
      margin-top: 8px;
      padding-top: 10px;
      border-top: 1px dashed rgba(16,24,40,0.12);
    }
    .result-row{
      display:flex; flex-direction: column; gap: 6px;
      margin: 10px 0;
    }
    .result-meta{
      display:flex; align-items:center; justify-content: space-between; gap: 10px;
      font-size: 13px;
    }
    .result-meta .label{
      display:flex; align-items:center; gap: 8px;
    }
    .result-meta .count{
      color: var(--muted);
      min-width: 52px; text-align:right;
    }
    .bar{
      position:relative;
      height: 12px;
      background: #f3f5ff;
      border: 1px solid rgba(16,24,40,0.06);
      border-radius: 999px;
      overflow:hidden;
    }
    .bar > .fill{
      position:absolute; left:0; top:0; height:100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary), #8fa0ff);
      transition: width .65s cubic-bezier(.21,.9,.24,1);
    }
    .bar[color="1"] > .fill{ background: linear-gradient(90deg, #6a72ff, #98a3ff) }
    .bar[color="2"] > .fill{ background: linear-gradient(90deg, #00bfa6, #75e6d8) }
    .bar[color="3"] > .fill{ background: linear-gradient(90deg, #ff7ab6, #ffc4de) }
    .bar[color="4"] > .fill{ background: linear-gradient(90deg, #ffb86b, #ffe0b5) }
    .bar[color="5"] > .fill{ background: linear-gradient(90deg, #7bd8ff, #bcecff) }

    .totals{
      display:flex; align-items:center; justify-content: space-between;
      margin-top: 14px;
      font-size: 13px;
      color: var(--muted);
    }
    .totals strong{ color: var(--text) }

    .empty-state{
      display:none;
      margin: 16px 0 0;
      text-align:center;
      color: var(--muted);
      padding: 20px;
    }

    footer{
      max-width: var(--maxw);
      margin: 28px auto 40px;
      padding: 0 var(--space);
      color: var(--muted);
      font-size: 13px;
      text-align:center;
    }

    /* Small helpers */
    .sr{ position:absolute !important; width:1px;height:1px; padding:0;margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }

    /* Entrance animation */
    .appear{
      animation: appear .45s ease both;
    }
    @keyframes appear{
      from{ opacity:0; transform: translateY(6px) }
      to{ opacity:1; transform: translateY(0) }
    }
  </style>
</head>
<body>
  <header id="app-header" role="banner">
    <div class="header-inner">
      <div class="brand">
        <div class="brand-logo" aria-hidden="true"></div>
        <div>
          <h1>Online Poll Board</h1>
          <p>Vote on topics and watch results update in real-time</p>
        </div>
      </div>
      <div class="controls">
        <div class="search">
          <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M21 21l-4.3-4.3m1.55-4.75a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <label for="search-input" class="sr">Search polls</label>
          <input id="search-input" type="search" placeholder="Search polls..." autocomplete="off" />
        </div>
        <button id="reset-all-btn" class="btn secondary" type="button" title="Reset all votes">Reset All</button>
      </div>
    </div>
  </header>

  <main id="app" role="main" aria-live="polite" aria-busy="false">
    <div class="status-row">
      <span class="badge" id="voted-count-badge" aria-live="polite">You’ve voted in 0 of 0 polls</span>
      <span class="badge">Tip: Click an option to vote. You can change your vote anytime.</span>
    </div>
    <section id="polls-list" class="grid" aria-label="Polls list"></section>
    <div id="empty-state" class="empty-state">No polls match your search.</div>
  </main>

  <footer role="contentinfo">
    Built with semantic HTML, CSS, and vanilla JavaScript. Votes are stored locally in your browser for demo purposes.
  </footer>

  <script>
    ;(() => {
      const STORAGE_KEYS = {
        totals: 'opb_totals_v1',
        selections: 'opb_selections_v1'
      };

      const defaultPolls = [
        {
          id: 'frontend',
          title: 'Favorite Frontend Framework',
          description: 'Which frontend framework do you enjoy the most?',
          options: [
            { id: 'react', label: 'React' },
            { id: 'vue', label: 'Vue' },
            { id: 'svelte', label: 'Svelte' },
            { id: 'angular', label: 'Angular' }
          ]
        },
        {
          id: 'pet',
          title: 'Best Pet',
          description: 'What is the best companion animal?',
          options: [
            { id: 'dog', label: 'Dog' },
            { id: 'cat', label: 'Cat' },
            { id: 'fish', label: 'Fish' },
            { id: 'bird', label: 'Bird' },
            { id: 'reptile', label: 'Reptile' }
          ]
        },
        {
          id: 'beverage',
          title: 'Morning Beverage',
          description: 'Your go-to morning drink?',
          options: [
            { id: 'coffee', label: 'Coffee' },
            { id: 'tea', label: 'Tea' },
            { id: 'juice', label: 'Juice' },
            { id: 'water', label: 'Water' }
          ]
        },
        {
          id: 'work',
          title: 'Preferred Work Setting',
          description: 'Where do you feel most productive?',
          options: [
            { id: 'office', label: 'Office' },
            { id: 'home', label: 'Home' },
            { id: 'cafe', label: 'Cafe' },
            { id: 'outdoors', label: 'Outdoors' },
            { id: 'cowork', label: 'Co-working Space' }
          ]
        },
        {
          id: 'vacation',
          title: 'Dream Vacation',
          description: 'Pick your dream getaway.',
          options: [
            { id: 'beach', label: 'Beach' },
            { id: 'mountain', label: 'Mountains' },
            { id: 'city', label: 'City' },
            { id: 'countryside', label: 'Countryside' },
            { id: 'cruise', label: 'Cruise' }
          ]
        }
      ];

      // Utility: DOM getters
      const $ = (sel, scope=document) => scope.querySelector(sel);
      const $$ = (sel, scope=document) => Array.from(scope.querySelectorAll(sel));

      // Storage helpers
      const load = (key, fallback) => {
        try { return JSON.parse(localStorage.getItem(key)) ?? fallback; }
        catch(e){ return fallback; }
      };
      const save = (key, val) => localStorage.setItem(key, JSON.stringify(val));

      // Seed initial totals if none
      function generateInitialTotals() {
        const totals = {};
        let seed = 1337; // simple deterministic seed
        const rand = () => (seed = (seed * 16807) % 2147483647) / 2147483647;
        defaultPolls.forEach(p => {
          totals[p.id] = {};
          p.options.forEach((opt, i) => {
            // Skew slightly to make some options lead; range ~20..160
            const base = Math.floor(20 + rand() * 140);
            totals[p.id][opt.id] = base + Math.floor(i * rand() * 12);
          });
        });
        return totals;
      }

      // State
      let totals = load(STORAGE_KEYS.totals, null);
      if (!totals) {
        totals = generateInitialTotals();
        save(STORAGE_KEYS.totals, totals);
      }
      let selections = load(STORAGE_KEYS.selections, {});

      // Render
      const pollsList = $('#polls-list');
      const emptyState = $('#empty-state');
      const votedBadge = $('#voted-count-badge');

      function getPollById(id){ return defaultPolls.find(p => p.id === id); }
      function sumVotes(pollId){
        const t = totals[pollId] || {};
        return Object.values(t).reduce((a,b)=>a+b,0);
      }

      function optionRowHTML(poll, opt, colorIndex){
        const count = totals[poll.id][opt.id] || 0;
        const total = sumVotes(poll.id) || 0;
        const pct = total === 0 ? 0 : Math.round((count/total)*100);
        const safeLabel = opt.label.replace(/</g,'&lt;').replace(/>/g,'&gt;');
        return `
          <div class="result-row" role="group" aria-label="${safeLabel} result">
            <div class="result-meta">
              <span class="label">
                <span class="chip" aria-hidden="true">${pct}%</span>
                <span>${safeLabel}</span>
              </span>
              <span class="count"><span id="count-${poll.id}-${opt.id}" aria-live="polite">${count}</span> votes</span>
            </div>
            <div class="bar" color="${colorIndex}" aria-hidden="true">
              <div id="bar-${poll.id}-${opt.id}" class="fill" style="width:${pct}%"></div>
            </div>
          </div>
        `;
      }

      function pollCardHTML(poll, index){
        const userChoice = selections[poll.id];
        const total = sumVotes(poll.id);
        const colors = ['1','2','3','4','5'];
        const optionButtons = poll.options.map((opt, i) => {
          const selected = userChoice === opt.id ? 'selected' : '';
          const safeLabel = opt.label.replace(/</g,'&lt;').replace(/>/g,'&gt;');
          return `
            <button id="poll-${poll.id}-option-${opt.id}" class="option-btn ${selected}" type="button"
              data-role="option" data-poll-id="${poll.id}" data-option-id="${opt.id}"
              aria-pressed="${selected ? 'true' : 'false'}" aria-label="Vote for ${safeLabel}">
              <span class="option-label">
                <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 21c4.97 0 9-4.03 9-9S16.97 3 12 3 3 7.03 3 12s4.03 9 9 9zm-1.2-6.2l6-6-1.4-1.4-4.6 4.58-2.2-2.18-1.4 1.42 3.6 3.58z" fill="${selected ? 'var(--primary)' : 'rgba(31,36,48,0.28)'}"/></svg>
                <span>${safeLabel}</span>
              </span>
              <span class="chip">${totals[poll.id][opt.id]} votes</span>
            </button>
          `;
        }).join('');

        const results = poll.options.map((opt, i) => optionRowHTML(poll, opt, colors[i % colors.length])).join('');

        return `
          <article class="poll-card appear" id="poll-card-${poll.id}" data-poll-id="${poll.id}" aria-labelledby="title-${poll.id}">
            <div class="poll-head">
              <div>
                <h2 id="title-${poll.id}" class="poll-title">${poll.title}</h2>
                <p class="poll-desc">${poll.description}</p>
              </div>
              <div class="poll-actions">
                <button id="clear-vote-${poll.id}" class="btn secondary" type="button" data-role="clear" data-poll-id="${poll.id}" ${userChoice ? '' : 'disabled'} title="Clear my vote">Clear</button>
              </div>
            </div>

            <div class="options" role="group" aria-label="Options for ${poll.title}">
              ${optionButtons}
            </div>

            <div class="results" aria-label="Results for ${poll.title}">
              ${results}
              <div class="totals">
                <span id="selected-badge-${poll.id}">${userChoice ? `You voted: <strong>${getOptionLabel(poll, userChoice)}</strong>` : 'No vote yet'}</span>
                <span>Total: <strong id="total-${poll.id}" aria-live="polite">${total}</strong> votes</span>
              </div>
            </div>
          </article>
        `;
      }

      function getOptionLabel(poll, optionId){
        const found = poll.options.find(o => o.id === optionId);
        return found ? found.label : '';
      }

      function renderAll(){
        pollsList.innerHTML = defaultPolls.map(pollCardHTML).join('');
        updateVotedBadge();
        // Animate counts in softly on first load
        setTimeout(() => {
          defaultPolls.forEach(p => updatePollUI(p.id, null, true));
        }, 30);
      }

      function updateVotedBadge(){
        const total = defaultPolls.length;
        const voted = Object.keys(selections).filter(pid => selections[pid]).length;
        votedBadge.textContent = `You’ve voted in ${voted} of ${total} polls`;
      }

      // Animate number helper
      function animateNumber(el, from, to, duration=700){
        if (!el) return;
        const start = performance.now();
        const delta = to - from;
        const d = Math.max(200, Math.min(900, duration));
        function frame(t){
          const p = Math.min(1, (t - start) / d);
          const eased = 1 - Math.pow(1-p, 3);
          const val = Math.round(from + delta * eased);
          el.textContent = String(val);
          if (p < 1) requestAnimationFrame(frame);
        }
        requestAnimationFrame(frame);
      }

      // Add a floating "+1" pop on vote
      function floatPlus(el){
        const span = document.createElement('span');
        span.className = 'plus-float';
        span.textContent = '+1';
        el.appendChild(span);
        setTimeout(() => span.remove(), 750);
      }

      // UI update for a poll
      function updatePollUI(pollId, prevCounts = null, gentle = false){
        const poll = getPollById(pollId);
        const totalNow = sumVotes(pollId);
        const totalEl = $(`#total-${pollId}`);
        // Determine previous totals if needed
        let prevTotal = prevCounts ? Object.values(prevCounts).reduce((a,b)=>a+b,0) : (gentle ? 0 : totalNow);

        // Animate total
        if (totalEl) animateNumber(totalEl, prevTotal, totalNow, gentle ? 600 : 700);

        // Update each option row + chip
        poll.options.forEach((opt, i) => {
          const countNow = totals[pollId][opt.id] || 0;
          const countEl = $(`#count-${pollId}-${opt.id}`);
          const chip = $(`#poll-${pollId}-option-${opt.id} .chip`);
          const bar = $(`#bar-${pollId}-${opt.id}`);

          const prev = prevCounts ? prevCounts[opt.id] : (gentle ? 0 : countNow);
          if (countEl) animateNumber(countEl, prev, countNow, gentle ? 600 : 700);
          if (chip) chip.textContent = `${countNow} votes`;

          const pct = totalNow === 0 ? 0 : Math.round((countNow / totalNow) * 100);
          if (bar) bar.style.width = pct + '%';
          // Update the small percent chip in result label
          const meta = countEl?.closest('.result-row')?.querySelector('.chip');
          if (meta) meta.textContent = `${pct}%`;
        });

        // Update selected badge and button states
        const choice = selections[pollId];
        const badge = $(`#selected-badge-${pollId}`);
        if (badge) {
          badge.innerHTML = choice ? `You voted: <strong>${getOptionLabel(poll, choice)}</strong>` : 'No vote yet';
        }
        const clearBtn = $(`#clear-vote-${pollId}`);
        if (clearBtn) clearBtn.disabled = !choice;

        // Toggle selected styles/aria on option buttons
        poll.options.forEach(opt => {
          const btn = $(`#poll-${pollId}-option-${opt.id}`);
          if (btn) {
            const sel = choice === opt.id;
            btn.classList.toggle('selected', sel);
            btn.setAttribute('aria-pressed', sel ? 'true' : 'false');
            // Icon color adjust happens via HTML change on re-render; keep simple here
          }
        });

        updateVotedBadge();
      }

      // Handle vote
      function handleVote(pollId, optionId, sourceBtn){
        const poll = getPollById(pollId);
        if (!poll) return;

        const prevChoice = selections[pollId] || null;
        if (prevChoice === optionId) {
          // Already selected; small feedback
          sourceBtn?.classList.add('selected');
          setTimeout(()=> sourceBtn?.classList.remove('selected'), 150);
          return;
        }

        // Snapshot previous counts for animation
        const prevCounts = { ...(totals[pollId] || {}) };

        // Update totals
        totals[pollId] = totals[pollId] || {};
        totals[pollId][optionId] = (totals[pollId][optionId] || 0) + 1;
        if (prevChoice) {
          totals[pollId][prevChoice] = Math.max(0, (totals[pollId][prevChoice] || 1) - 1);
        }
        selections[pollId] = optionId;

        // Persist
        save(STORAGE_KEYS.totals, totals);
        save(STORAGE_KEYS.selections, selections);

        // UI feedback
        if (sourceBtn) floatPlus(sourceBtn);
        updatePollUI(pollId, prevCounts, false);
      }

      // Clear vote for a poll
      function clearVote(pollId){
        const poll = getPollById(pollId);
        if (!poll) return;
        const prevChoice = selections[pollId];
        if (!prevChoice) return;

        const prevCounts = { ...(totals[pollId] || {}) };
        totals[pollId][prevChoice] = Math.max(0, (totals[pollId][prevChoice] || 0) - 1);
        delete selections[pollId];

        save(STORAGE_KEYS.totals, totals);
        save(STORAGE_KEYS.selections, selections);

        updatePollUI(pollId, prevCounts, false);
      }

      // Reset all
      function resetAll(){
        const ok = confirm('Reset all votes and clear your selections? This cannot be undone.');
        if (!ok) return;
        totals = generateInitialTotals();
        selections = {};
        save(STORAGE_KEYS.totals, totals);
        save(STORAGE_KEYS.selections, selections);
        renderAll();
      }

      // Search/filter
      function applyFilter(query){
        const q = query.trim().toLowerCase();
        let visible = 0;
        $$('.poll-card', pollsList).forEach(card => {
          const pid = card.getAttribute('data-poll-id');
          const poll = getPollById(pid);
          const hay = (poll.title + ' ' + poll.description).toLowerCase();
          const show = !q || hay.includes(q);
          card.style.display = show ? '' : 'none';
          if (show) visible++;
        });
        emptyState.style.display = visible === 0 ? 'block' : 'none';
      }

      // Event delegation
      pollsList.addEventListener('click', (e) => {
        const target = e.target.closest('[data-role]');
        if (!target) return;

        const role = target.getAttribute('data-role');
        const pollId = target.getAttribute('data-poll-id');

        if (role === 'option') {
          const optionId = target.getAttribute('data-option-id');
          handleVote(pollId, optionId, target);
        } else if (role === 'clear') {
          clearVote(pollId);
        }
      });

      // Controls
      $('#reset-all-btn').addEventListener('click', resetAll);
      $('#search-input').addEventListener('input', (e) => applyFilter(e.target.value));

      // Initial render
      renderAll();
      applyFilter('');
    })();
  </script>
</body>
</html>