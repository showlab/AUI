<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Target Click Challenge</title>
  <style>
    :root{
      --bg1:#f5f7ff;
      --bg2:#eef9ff;
      --ink:#1b2a3a;
      --accent:#4c6fff;
      --accent-2:#00c2a8;
      --glass: rgba(255,255,255,0.6);
      --glass-border: rgba(0,0,0,0.08);
      --shadow: 0 10px 30px rgba(0,0,0,0.12);
    }

    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background: radial-gradient(1200px 800px at 10% -10%, var(--bg2), transparent),
                  radial-gradient(1000px 600px at 110% 10%, #fff8f2, transparent),
                  linear-gradient(180deg, var(--bg1), #ffffff);
      overflow: hidden;
    }

    header {
      position: absolute;
      top: 16px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 5;
      text-align: center;
      pointer-events: none;
    }
    header h1 {
      margin: 0;
      font-weight: 800;
      letter-spacing: -0.02em;
      font-size: clamp(20px, 2.6vw, 34px);
      text-shadow: 0 1px 0 #fff;
    }

    main {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    /* Playfield */
    #playfield {
      position: absolute;
      inset: 0;
      overflow: hidden;
      touch-action: manipulation;
      cursor: crosshair;
    }

    /* Scoreboard (modern glass overlay) */
    #scoreboard {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 6;
      display: grid;
      grid-auto-flow: column;
      gap: 14px;
      align-items: center;
      padding: 12px 16px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 14px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      user-select: none;
    }
    .meter {
      display: grid;
      gap: 2px;
      min-width: 92px;
    }
    .meter .label {
      font-size: 12px;
      opacity: .7;
    }
    .meter .value {
      display: inline-flex;
      align-items: baseline;
      gap: 6px;
      font-weight: 800;
      font-variant-numeric: tabular-nums;
      letter-spacing: -0.02em;
    }
    .chip {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 4px 8px;
      background: rgba(76,111,255,0.12);
      color: var(--accent);
      font-weight: 700;
      border-radius: 999px;
      font-size: 12px;
    }

    /* Controls */
    .controls {
      position: absolute;
      left: 20px;
      bottom: 20px;
      z-index: 6;
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .btn {
      appearance: none;
      border: 0;
      border-radius: 12px;
      padding: 12px 18px;
      font-weight: 800;
      letter-spacing: 0.02em;
      background: linear-gradient(135deg, var(--accent), #6aa8ff);
      color: white;
      box-shadow: 0 10px 18px rgba(76,111,255,0.35), inset 0 1px 0 rgba(255,255,255,0.35);
      cursor: pointer;
      transition: transform .06s ease, box-shadow .2s ease, filter .2s ease;
    }
    .btn:disabled {
      filter: grayscale(0.35) brightness(0.9);
      cursor: not-allowed;
    }
    .btn:active:not(:disabled) {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 6px 12px rgba(76,111,255,0.25);
    }
    .btn.secondary {
      background: linear-gradient(135deg, #0fb, #30d9c4);
      box-shadow: 0 10px 18px rgba(0,255,187,0.28), inset 0 1px 0 rgba(255,255,255,0.35);
    }

    .hint {
      opacity: .75;
      font-size: 13px;
      padding: 6px 10px;
      border-radius: 10px;
      background: rgba(0,0,0,0.04);
    }

    /* Target styling */
    .target {
      position: absolute;
      border-radius: 50%;
      transform: translate3d(0,0,0) scale(0.6);
      animation: appear .18s ease-out forwards, pulse 1.2s ease-in-out infinite;
      will-change: transform, opacity, filter;
      cursor: crosshair;
      /* Bullseye using radial gradients with hue variable */
      --h: 200; /* hue set inline per target */
      background:
        radial-gradient(circle at 50% 50%, hsl(var(--h), 95%, 70%) 0 14%, transparent 15% 28%),
        radial-gradient(circle at 50% 50%, hsl(var(--h), 95%, 52%) 29% 43%, transparent 44% 58%),
        radial-gradient(circle at 50% 50%, hsl(var(--h), 95%, 44%) 59% 74%, transparent 75% 100%);
      box-shadow:
        0 10px 20px rgba(0,0,0,0.18),
        inset 0 0 20px rgba(255,255,255,0.6);
    }
    .target::after {
      /* animated outer pulse ring */
      content: '';
      position: absolute;
      inset: -8%;
      border-radius: 50%;
      border: 2px solid hsla(var(--h), 90%, 45%, 0.5);
      animation: ripple 1.4s ease-out infinite;
      pointer-events: none;
    }
    .target.hit {
      animation: hit .22s ease-out forwards;
      filter: saturate(1.2);
    }
    .target.fading {
      animation: fadeout .22s ease-in forwards;
    }

    @keyframes appear {
      from { transform: scale(0.2); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    @keyframes ripple {
      0% { transform: scale(0.9); opacity: 0.65; }
      70% { opacity: 0.2; }
      100% { transform: scale(1.15); opacity: 0; }
    }
    @keyframes hit {
      0% { transform: scale(1); opacity: 1; }
      60% { transform: scale(1.15); opacity: 1; }
      100% { transform: scale(0.4); opacity: 0; }
    }
    @keyframes fadeout {
      to { transform: scale(0.85); opacity: 0; }
    }

    /* Start & End Overlays */
    .overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      padding: 20px;
      z-index: 7;
      pointer-events: auto;
      background: radial-gradient(1200px 700px at 50% -10%, rgba(255,255,255,0.6), rgba(255,255,255,0.1));
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
    }
    .card {
      width: min(520px, 92vw);
      background: var(--glass);
      border:1px solid var(--glass-border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 22px 22px;
      text-align: center;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .card h2 {
      margin: 6px 0 8px;
      font-size: clamp(22px, 3vw, 30px);
    }
    .card p {
      margin: 6px 0 14px;
      opacity: .8;
    }
    .results {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      margin: 18px 0 8px;
    }
    .result {
      background: rgba(255,255,255,0.75);
      border: 1px solid var(--glass-border);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .result .label {
      font-size: 12px;
      opacity: .6;
    }
    .result .value {
      font-size: 22px;
      font-weight: 800;
      margin-top: 4px;
      font-variant-numeric: tabular-nums;
    }

    .sr-only {
      position: absolute !important;
      width: 1px; height: 1px;
      padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0);
      border: 0;
    }

    @media (max-width: 600px) {
      .results { grid-template-columns: 1fr; }
      #scoreboard { grid-auto-flow: row; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Target Click Challenge</h1>
  </header>

  <main>
    <!-- Scoreboard -->
    <aside id="scoreboard" aria-live="polite">
      <div class="meter" aria-label="Time remaining">
        <span class="label">Time</span>
        <span class="value"><span class="chip">‚è±</span><span id="timerValue">20.0s</span></span>
      </div>
      <div class="meter" aria-label="Score">
        <span class="label">Score</span>
        <span class="value"><span class="chip">üéØ</span><span id="scoreValue">0</span></span>
      </div>
      <div class="meter" aria-label="Accuracy">
        <span class="label">Accuracy</span>
        <span class="value"><span class="chip">‚úÖ</span><span id="accuracyValue">0%</span></span>
      </div>
    </aside>

    <!-- Controls -->
    <div class="controls">
      <button id="startButton" data-testid="start-button" class="btn" type="button" aria-label="Start game">Start</button>
      <button id="restartButton" data-testid="restart-button" class="btn secondary" type="button" aria-label="Restart game" style="display:none;">Restart</button>
      <div class="hint">Click targets as they appear. You have 20 seconds!</div>
    </div>

    <!-- Playfield -->
    <section id="playfield" data-testid="playfield" aria-label="Game area" role="application"></section>

    <!-- Start Overlay -->
    <div id="startOverlay" class="overlay" aria-hidden="false">
      <div class="card">
        <div class="chip" aria-hidden="true">Ready?</div>
        <h2>Test your reflexes</h2>
        <p>Targets pop up around the screen for a split second. Click them to score. Aim for precision and speed!</p>
        <div class="results" aria-hidden="true">
          <div class="result">
            <div class="label">Duration</div>
            <div class="value">20s</div>
          </div>
          <div class="result">
            <div class="label">Goal</div>
            <div class="value">Hit as many as you can</div>
          </div>
          <div class="result">
            <div class="label">Tip</div>
            <div class="value">Be accurate</div>
          </div>
        </div>
        <button id="overlayStartButton" class="btn" type="button" aria-label="Start the challenge now">Play Now</button>
      </div>
    </div>

    <!-- End Overlay -->
    <div id="endOverlay" class="overlay" style="display:none;" aria-hidden="true">
      <div class="card" role="dialog" aria-modal="true" aria-labelledby="endTitle">
        <div class="chip" aria-hidden="true">Results</div>
        <h2 id="endTitle">Time‚Äôs up!</h2>
        <div class="results">
          <div class="result">
            <div class="label">Score</div>
            <div id="finalScore" class="value">0</div>
          </div>
          <div class="result">
            <div class="label">Accuracy</div>
            <div id="finalAccuracy" class="value">0%</div>
          </div>
          <div class="result">
            <div class="label">Clicks</div>
            <div id="finalClicks" class="value">0</div>
          </div>
        </div>
        <p>Press R to play again, or hit the button below.</p>
        <button id="playAgainButton" class="btn secondary" type="button" aria-label="Play again">Play Again</button>
      </div>
    </div>
  </main>

  <script>
    (function(){
      const DURATION_MS = 20000;
      const TARGET_MIN_SIZE = 42;   // px
      const TARGET_MAX_SIZE = 76;   // px
      const TARGET_MIN_TTL = 720;   // ms
      const TARGET_MAX_TTL = 1100;  // ms
      const SPAWN_MIN_DELAY = 260;  // ms
      const SPAWN_MAX_DELAY = 680;  // ms
      const EDGE_MARGIN = 10;       // px

      const playfield = document.getElementById('playfield');
      const startBtn = document.getElementById('startButton');
      const restartBtn = document.getElementById('restartButton');
      const overlayStartBtn = document.getElementById('overlayStartButton');
      const playAgainBtn = document.getElementById('playAgainButton');

      const startOverlay = document.getElementById('startOverlay');
      const endOverlay = document.getElementById('endOverlay');

      const timerValue = document.getElementById('timerValue');
      const scoreValue = document.getElementById('scoreValue');
      const accuracyValue = document.getElementById('accuracyValue');

      const finalScore = document.getElementById('finalScore');
      const finalAccuracy = document.getElementById('finalAccuracy');
      const finalClicks = document.getElementById('finalClicks');

      let isRunning = false;
      let startTime = 0;
      let hits = 0;
      let clicks = 0;
      let spawnTimeout = null;
      let endTimeout = null;
      let timerInterval = null;
      let targetSeq = 0;

      // Helpers
      const rand = (min, max) => Math.random() * (max - min) + min;
      const randInt = (min, max) => Math.floor(rand(min, max + 1));
      const clamp = (v, lo, hi) => Math.min(hi, Math.max(lo, v));

      function resetState(){
        isRunning = false;
        startTime = 0;
        hits = 0;
        clicks = 0;
        targetSeq = 0;
        clearTimers();
        removeAllTargets();
        updateScoreboard(0);
        updateAccuracy();
        timerValue.textContent = (DURATION_MS / 1000).toFixed(1) + 's';
      }

      function clearTimers(){
        if (spawnTimeout) { clearTimeout(spawnTimeout); spawnTimeout = null; }
        if (endTimeout) { clearTimeout(endTimeout); endTimeout = null; }
        if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
      }

      function removeAllTargets(){
        playfield.querySelectorAll('.target').forEach(el => el.remove());
      }

      function updateScoreboard(timeLeftMs){
        scoreValue.textContent = String(hits);
        const sec = Math.max(0, timeLeftMs ?? DURATION_MS) / 1000;
        timerValue.textContent = sec.toFixed(1) + 's';
      }

      function updateAccuracy(){
        const acc = clicks > 0 ? (hits / clicks) * 100 : 0;
        accuracyValue.textContent = `${acc.toFixed(0)}%`;
        return acc;
      }

      function gameTimeLeft(){
        if (!isRunning) return 0;
        const elapsed = performance.now() - startTime;
        return Math.max(0, DURATION_MS - elapsed);
      }

      function startGame(){
        resetState();
        isRunning = true;
        startTime = performance.now();

        startBtn.disabled = true;
        restartBtn.style.display = 'inline-flex';
        startOverlay.style.display = 'none';
        startOverlay.setAttribute('aria-hidden', 'true');

        scheduleNextSpawn();
        endTimeout = setTimeout(endGame, DURATION_MS);
        timerInterval = setInterval(() => {
          updateScoreboard(gameTimeLeft());
        }, 60);
      }

      function endGame(){
        if (!isRunning) return;
        isRunning = false;
        clearTimers();

        // Remove or fade out current targets
        playfield.querySelectorAll('.target').forEach(el => {
          el.classList.add('fading');
          setTimeout(() => el.remove(), 220);
        });

        const acc = updateAccuracy();
        finalScore.textContent = String(hits);
        finalAccuracy.textContent = `${acc.toFixed(0)}%`;
        finalClicks.textContent = String(clicks);

        startBtn.disabled = false;
        endOverlay.style.display = 'grid';
        endOverlay.setAttribute('aria-hidden', 'false');
        // Focus the play again button for accessibility
        setTimeout(() => playAgainBtn.focus(), 20);
      }

      function scheduleNextSpawn(){
        if (!isRunning) return;
        const delay = rand(SPAWN_MIN_DELAY, SPAWN_MAX_DELAY);
        const fieldRect = playfield.getBoundingClientRect();
        const scoreboardRect = document.getElementById('scoreboard').getBoundingClientRect();

        spawnTimeout = setTimeout(() => {
          // Calculate a safe spawn zone avoiding scoreboard area (roughly)
          const size = randInt(TARGET_MIN_SIZE, TARGET_MAX_SIZE);
          const hue = randInt(0, 360);
          const ttl = randInt(TARGET_MIN_TTL, TARGET_MAX_TTL);

          const pfLeft = fieldRect.left;
          const pfTop = fieldRect.top;

          const avoidTop = Math.max(EDGE_MARGIN, scoreboardRect.bottom - pfTop + 8); // avoid scoreboard area
          const maxX = fieldRect.width - size - EDGE_MARGIN;
          const maxY = fieldRect.height - size - EDGE_MARGIN;

          let x = rand(EDGE_MARGIN, maxX);
          let y = rand(avoidTop, maxY);

          spawnTarget({ x, y, size, hue, ttl });
          scheduleNextSpawn();
        }, delay);
      }

      function spawnTarget({x, y, size, hue, ttl}){
        if (!isRunning) return;
        const el = document.createElement('div');
        el.className = 'target';
        const id = `target-${++targetSeq}`;
        el.id = id;
        el.setAttribute('data-testid', 'target');
        el.setAttribute('role', 'button');
        el.setAttribute('aria-label', 'Click target');
        el.style.width = size + 'px';
        el.style.height = size + 'px';
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        el.style.setProperty('--h', hue);
        el.dataset.state = 'alive';

        // Auto-despawn
        const timeoutId = setTimeout(() => {
          if (el.dataset.state === 'alive') {
            el.dataset.state = 'gone';
            el.classList.add('fading');
            setTimeout(() => el.remove(), 220);
          }
        }, ttl);

        // Keep reference on element to clear timer if hit
        el.dataset.tid = timeoutId;

        playfield.appendChild(el);
      }

      function handlePlayfieldClick(e){
        if (!isRunning) return;
        // Only count clicks inside the playfield area
        const target = e.target.closest('.target');
        clicks++;

        if (target && target.dataset.state === 'alive') {
          hitTarget(target);
        }
        updateAccuracy();
      }

      function hitTarget(target){
        target.dataset.state = 'hit';
        hits++;
        scoreValue.textContent = String(hits);

        // Clear its auto-despawn
        if (target.dataset.tid) {
          clearTimeout(Number(target.dataset.tid));
        }

        target.classList.add('hit');
        setTimeout(() => {
          target.remove();
        }, 180);
      }

      // Event listeners
      playfield.addEventListener('click', handlePlayfieldClick);

      startBtn.addEventListener('click', startGame);
      overlayStartBtn.addEventListener('click', startGame);
      restartBtn.addEventListener('click', () => {
        endOverlay.style.display = 'none';
        endOverlay.setAttribute('aria-hidden', 'true');
        startGame();
      });
      playAgainBtn.addEventListener('click', () => {
        endOverlay.style.display = 'none';
        endOverlay.setAttribute('aria-hidden', 'true');
        startGame();
      });

      // Keyboard shortcut: R to restart/play again
      window.addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() === 'r') {
          if (isRunning) {
            // ignore while running
          } else {
            endOverlay.style.display = 'none';
            endOverlay.setAttribute('aria-hidden', 'true');
            startGame();
          }
        }
      });

      // Ensure initial UI
      resetState();
    })();
  </script>
</body>
</html>