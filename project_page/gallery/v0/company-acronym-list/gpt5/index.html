<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8" />
  <title>Company Acronym List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Learn and remember internal company acronyms with search, categories, and quiz mode." />
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --surface: #0b1222;
      --text: #e5e7eb;
      --muted: #9aa4b2;
      --accent: #3b82f6;
      --accent-2: #22c55e;
      --danger: #ef4444;
      --chip-bg: #111827;
      --chip-border: #1f2937;
      --border: #232a36;
      --mark-bg: #fde68a;
      --mark-text: #1f2937;
      --focus: #93c5fd;
      --shadow: 0 8px 24px rgba(0,0,0,.35);
      --radius: 12px;
      --radius-sm: 8px;
      --trans: 160ms ease;
      --container-w: 1100px;
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f7fafc;
        --panel: #ffffff;
        --surface: #ffffff;
        --text: #0f172a;
        --muted: #475569;
        --accent: #2563eb;
        --accent-2: #16a34a;
        --danger: #dc2626;
        --chip-bg: #f1f5f9;
        --chip-border: #e2e8f0;
        --border: #e5e7eb;
        --mark-bg: #fef08a;
        --mark-text: #111827;
        --focus: #2563eb;
        --shadow: 0 10px 24px rgba(3,7,18,.08);
      }
    }

    html, body {
      height: 100%;
      background: radial-gradient(1200px 650px at 20% -20%, rgba(59,130,246,.08), transparent 40%),
                  radial-gradient(1000px 500px at 110% 20%, rgba(34,197,94,.07), transparent 40%),
                  var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
      line-height: 1.45;
    }

    .container {
      max-width: var(--container-w);
      margin: 0 auto;
      padding: 16px 20px 32px 20px;
    }

    header.app-header {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: saturate(140%) blur(10px);
      background: linear-gradient(180deg, rgba(15,23,42,.85), rgba(15,23,42,.65));
      border-bottom: 1px solid var(--border);
    }
    @media (prefers-color-scheme: light) {
      header.app-header {
        background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.75));
      }
    }
    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      max-width: var(--container-w);
      margin: 0 auto;
      padding: 14px 20px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .brand-logo {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: conic-gradient(from 230deg, var(--accent), var(--accent-2));
      box-shadow: 0 8px 24px rgba(59,130,246,.25), 0 6px 18px rgba(34,197,94,.2);
    }
    .brand-title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: .3px;
    }

    nav[role="tablist"] {
      display: flex;
      gap: 6px;
      background: var(--surface);
      padding: 6px;
      border-radius: 999px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .tab-btn {
      appearance: none;
      border: none;
      background: transparent;
      color: var(--muted);
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 600;
      letter-spacing: .2px;
      cursor: pointer;
      transition: background var(--trans), color var(--trans);
      outline: none;
    }
    .tab-btn[aria-selected="true"] {
      background: linear-gradient(180deg, rgba(59,130,246,.14), rgba(59,130,246,.06));
      color: var(--text);
      box-shadow: inset 0 0 0 1px rgba(59,130,246,.35);
    }
    .tab-btn:focus-visible {
      box-shadow: 0 0 0 3px var(--focus);
    }

    main {
      max-width: var(--container-w);
      margin: 18px auto 0;
      padding: 0 20px 32px 20px;
    }

    /* Panels */
    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.02)), var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .panel-section {
      padding: 16px;
    }
    .panel + .panel {
      margin-top: 16px;
    }

    /* Search and filters */
    .search-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
    }
    @media (max-width: 640px) {
      .search-row {
        grid-template-columns: 1fr;
      }
    }
    .input-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 8px 12px;
    }
    .input-wrap input[type="search"] {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 16px;
      outline: none;
      min-width: 0;
    }
    .btn {
      appearance: none;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.02)), var(--surface);
      color: var(--text);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 600;
      cursor: pointer;
      transition: transform var(--trans), box-shadow var(--trans), background var(--trans);
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .btn:focus-visible { box-shadow: 0 0 0 3px var(--focus); }
    .btn-secondary {
      color: var(--muted);
    }
    .btn-primary {
      background: linear-gradient(180deg, rgba(59,130,246,.20), rgba(59,130,246,.10));
      border-color: rgba(59,130,246,.35);
    }
    .btn-success {
      background: linear-gradient(180deg, rgba(34,197,94,.20), rgba(34,197,94,.10));
      border-color: rgba(34,197,94,.35);
    }
    .btn-danger {
      background: linear-gradient(180deg, rgba(239,68,68,.20), rgba(239,68,68,.10));
      border-color: rgba(239,68,68,.35);
    }

    .hint {
      color: var(--muted);
      font-size: 13px;
    }

    .chip-list {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      padding: 6px;
      border-radius: var(--radius-sm);
      background: var(--surface);
      border: 1px solid var(--border);
    }
    .chip {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 13px;
      background: var(--chip-bg);
      border: 1px solid var(--chip-border);
      color: var(--text);
      cursor: pointer;
      user-select: none;
      transition: background var(--trans), box-shadow var(--trans), transform var(--trans);
    }
    .chip:hover { transform: translateY(-1px); }
    .chip input[type="checkbox"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }
    .chip .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      box-shadow: inset 0 0 0 2px var(--border);
      background: transparent;
      transition: background var(--trans), box-shadow var(--trans);
    }
    .chip[data-checked="true"] {
      box-shadow: inset 0 0 0 1px rgba(59,130,246,.4), 0 8px 14px rgba(59,130,246,.12);
      background: linear-gradient(180deg, rgba(59,130,246,.10), rgba(59,130,246,.04));
    }
    .chip[data-checked="true"] .dot {
      background: var(--accent);
      box-shadow: none;
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }
    .toolbar-left, .toolbar-right {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    /* List */
    .list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 10px 14px;
      border-bottom: 1px dashed var(--border);
      color: var(--muted);
      font-weight: 600;
      font-size: 14px;
    }
    .acronym-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .acronym-item {
      display: grid;
      grid-template-columns: 140px 1fr auto;
      gap: 16px;
      padding: 14px;
      border-bottom: 1px solid var(--border);
    }
    @media (max-width: 820px) {
      .acronym-item {
        grid-template-columns: 1fr;
      }
    }
    .term {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: .4px;
    }
    .definition {
      color: var(--text);
      font-size: 15px;
    }
    .meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 6px;
    }
    .tag {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      color: var(--muted);
      border: 1px solid var(--border);
      background: var(--surface);
    }
    .actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .copy-btn {
      font-size: 13px;
    }

    mark {
      background: var(--mark-bg);
      color: var(--mark-text);
      padding: 0 3px;
      border-radius: 4px;
    }

    /* Quiz */
    .quiz-grid {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 16px;
    }
    @media (max-width: 980px) {
      .quiz-grid { grid-template-columns: 1fr; }
    }

    .quiz-card {
      padding: 16px;
      border-top: 1px solid var(--border);
    }
    .quiz-title {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 8px;
    }
    .option-btn {
      width: 100%;
      text-align: left;
      padding: 12px 14px;
      margin-bottom: 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.02)), var(--surface);
      cursor: pointer;
      transition: transform var(--trans), box-shadow var(--trans), border-color var(--trans);
      position: relative;
    }
    .option-btn:hover { transform: translateY(-1px); }
    .option-btn[data-selected="true"] {
      box-shadow: inset 0 0 0 2px rgba(59,130,246,.45);
    }
    .option-btn[data-correct="true"] {
      background: linear-gradient(180deg, rgba(34,197,94,.12), rgba(34,197,94,.06));
      border-color: rgba(34,197,94,.45);
    }
    .option-btn[data-correct="false"] {
      background: linear-gradient(180deg, rgba(239,68,68,.12), rgba(239,68,68,.06));
      border-color: rgba(239,68,68,.45);
    }

    .progress {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .progressbar {
      height: 8px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 999px;
      overflow: hidden;
      width: 100%;
    }
    .progressbar > div {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width 240ms ease-out;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
    }

    footer {
      max-width: var(--container-w);
      margin: 18px auto 24px;
      padding: 0 20px;
      color: var(--muted);
      font-size: 13px;
      text-align: center;
    }
    .sr-only {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <header class="app-header" role="banner">
    <div class="header-inner">
      <div class="brand" aria-label="App brand">
        <div class="brand-logo" aria-hidden="true"></div>
        <div class="brand-title">Company Acronym List</div>
      </div>
      <nav role="tablist" aria-label="Primary">
        <button id="tabBrowse" class="tab-btn" role="tab" aria-selected="true" aria-controls="browseSection">Browse</button>
        <button id="tabQuiz" class="tab-btn" role="tab" aria-selected="false" aria-controls="quizSection">Quiz</button>
      </nav>
    </div>
  </header>

  <main>
    <!-- Browse Section -->
    <section id="browseSection" class="panel" role="tabpanel" aria-labelledby="tabBrowse">
      <div class="panel-section">
        <div class="search-row">
          <label class="input-wrap" for="searchInput" aria-label="Search acronyms">
            <span aria-hidden="true" style="color:var(--muted)">üîé</span>
            <input id="searchInput" type="search" placeholder="Search by acronym, definition, or tag..." autocomplete="off" />
            <button id="clearSearchBtn" class="btn btn-secondary" type="button" title="Clear search">Clear</button>
          </label>
          <div class="hint">Tip: Try "security", "revenue", or "product"</div>
        </div>

        <div class="toolbar" style="margin-top: 14px;">
          <div class="toolbar-left">
            <strong style="font-size:14px">Filter by category</strong>
          </div>
          <div class="toolbar-right">
            <button id="catSelectAllBtn" class="btn btn-secondary" type="button">Select All</button>
            <button id="catClearBtn" class="btn btn-secondary" type="button">Clear</button>
          </div>
        </div>
        <div id="categoryFilters" class="chip-list" aria-label="Category filters"></div>
      </div>

      <div class="list-header">
        <div id="resultsCount">0 results</div>
        <div class="muted">Click copy to copy the definition</div>
      </div>

      <ul id="acronymList" class="acronym-list" aria-live="polite"></ul>
    </section>

    <!-- Quiz Section -->
    <section id="quizSection" class="panel" role="tabpanel" aria-labelledby="tabQuiz" hidden>
      <div class="panel-section quiz-grid">
        <aside class="panel" aria-label="Quiz setup">
          <div class="panel-section">
            <div class="quiz-title">Quiz Setup</div>

            <div style="margin-bottom: 10px;">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
                <label for="quizCountInput"><strong>Number of questions</strong></label>
                <div><span id="quizCountDisplay">5</span></div>
              </div>
              <input id="quizCountInput" type="range" min="3" max="15" step="1" value="5" style="width:100%;" />
              <div class="muted">Clamped to available items after filters.</div>
            </div>

            <div class="toolbar" style="margin: 6px 0 6px;">
              <div class="toolbar-left"><strong style="font-size:14px">Categories</strong></div>
              <div class="toolbar-right">
                <button id="quizSelectAllBtn" class="btn btn-secondary" type="button">Select All</button>
                <button id="quizClearBtn" class="btn btn-secondary" type="button">Clear</button>
              </div>
            </div>
            <div id="quizCategoryFilters" class="chip-list" aria-label="Quiz category filters"></div>

            <div style="margin-top: 10px; display:flex; gap:8px; flex-wrap: wrap;">
              <button id="quizStartButton" class="btn btn-primary" type="button">Start Quiz</button>
              <button id="quizRestartButton" class="btn btn-secondary" type="button" hidden>Restart</button>
            </div>
            <div class="muted" style="margin-top:8px;">Keyboard: 1-4 to choose, Enter to submit/next</div>
          </div>
        </aside>

        <section aria-label="Quiz" class="panel">
          <div class="panel-section">
            <div class="progress">
              <div id="quizProgressText" class="muted">Not started</div>
              <div style="min-width: 120px; text-align:right;"><span id="quizScoreText" class="muted">Score: 0</span></div>
            </div>
            <div class="progressbar" aria-hidden="true"><div id="quizProgressBar"></div></div>

            <div id="quizCard" class="quiz-card" hidden>
              <div class="quiz-title" id="quizQuestionText">Question will appear here</div>
              <div id="quizOptions" aria-label="Answer options" style="margin-top: 8px;"></div>

              <div style="display:flex; gap:8px; margin-top: 8px; flex-wrap: wrap;">
                <button id="quizSubmitButton" class="btn btn-success" type="button" disabled>Submit</button>
                <button id="quizNextButton" class="btn btn-primary" type="button" disabled>Next</button>
              </div>
            </div>

            <div id="quizPlaceholder" class="muted" style="padding: 16px;">
              Choose your settings and press Start Quiz.
            </div>

            <div id="quizSummary" class="panel" style="margin-top: 12px;" hidden>
              <div class="panel-section">
                <div class="quiz-title">Summary</div>
                <div id="quizSummaryStats" class="muted" style="margin-bottom: 8px;"></div>
                <div id="quizReview"></div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>
  </main>

  <footer>
    ¬© <span id="year"></span> Company Acronym List. All acronyms and definitions are for educational use.
  </footer>

  <script>
    // Data
    const ACRONYMS = [
      { term: "OKR", definition: "Objectives and Key Results", categories: ["Process","Leadership","Product","People"] },
      { term: "KPI", definition: "Key Performance Indicator", categories: ["Process","Product","Leadership"] },
      { term: "SLA", definition: "Service Level Agreement", categories: ["Process","Support","Engineering"] },
      { term: "ETA", definition: "Estimated Time of Arrival", categories: ["Process","Project"] },
      { term: "EOD", definition: "End Of Day", categories: ["Process","People"] },
      { term: "COB", definition: "Close Of Business", categories: ["Process","People"] },
      { term: "WIP", definition: "Work In Progress", categories: ["Process","Project","Engineering"] },
      { term: "QA", definition: "Quality Assurance", categories: ["Engineering","Process"] },
      { term: "QE", definition: "Quality Engineering", categories: ["Engineering"] },
      { term: "CI", definition: "Continuous Integration", categories: ["Engineering","Process"] },
      { term: "CD", definition: "Continuous Delivery", categories: ["Engineering","Process"] },
      { term: "CI/CD", definition: "Continuous Integration and Continuous Delivery", categories: ["Engineering","Process"] },
      { term: "SSO", definition: "Single Sign-On", categories: ["Security","IT"] },
      { term: "MFA", definition: "Multi-Factor Authentication", categories: ["Security","IT"] },
      { term: "IAM", definition: "Identity and Access Management", categories: ["Security","IT"] },
      { term: "PII", definition: "Personally Identifiable Information", categories: ["Security","Compliance","Data"] },
      { term: "GDPR", definition: "General Data Protection Regulation", categories: ["Compliance","Legal"] },
      { term: "SOC 2", definition: "Service Organization Control 2", categories: ["Compliance","Security"] },
      { term: "NPS", definition: "Net Promoter Score", categories: ["Product","Support","Marketing"] },
      { term: "CSAT", definition: "Customer Satisfaction", categories: ["Support","Product","Sales"] },
      { term: "LTV", definition: "Lifetime Value", categories: ["Finance","Sales","Marketing"] },
      { term: "CAC", definition: "Customer Acquisition Cost", categories: ["Finance","Sales","Marketing"] },
      { term: "ARR", definition: "Annual Recurring Revenue", categories: ["Finance","Sales"] },
      { term: "MRR", definition: "Monthly Recurring Revenue", categories: ["Finance","Sales"] },
      { term: "ROI", definition: "Return on Investment", categories: ["Finance","Leadership"] },
      { term: "MVP", definition: "Minimum Viable Product", categories: ["Product","Engineering","Project"] },
      { term: "PoC", definition: "Proof of Concept", categories: ["Product","Engineering","Project"] },
      { term: "RFC", definition: "Request for Comments", categories: ["Engineering","Process"] },
      { term: "SOW", definition: "Statement of Work", categories: ["Project","Sales","Legal"] },
      { term: "RACI", definition: "Responsible, Accountable, Consulted, Informed", categories: ["Process","Project","People"] },
      { term: "PRD", definition: "Product Requirements Document", categories: ["Product","Project"] },
      { term: "SOP", definition: "Standard Operating Procedure", categories: ["Process","Compliance"] },
      { term: "TTV", definition: "Time to Value", categories: ["Product","Sales","Support"] },
      { term: "SLI", definition: "Service Level Indicator", categories: ["Engineering","Support","Process"] },
      { term: "SLO", definition: "Service Level Objective", categories: ["Engineering","Support","Process"] },
      { term: "ETL", definition: "Extract, Transform, Load", categories: ["Data","Engineering"] }
    ];

    // Utilities
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const escapeRegExp = s => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const slug = s => s.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
    const uniq = arr => Array.from(new Set(arr));
    const shuffle = (arr) => {
      const a = arr.slice();
      for (let i=a.length-1;i>0;i--) {
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    };
    const clamp = (x,min,max)=>Math.max(min,Math.min(max,x));

    // Build categories from data
    const ALL_CATEGORIES = uniq(ACRONYMS.flatMap(a => a.categories)).sort((a,b) => a.localeCompare(b));

    // State
    const state = {
      activeTab: 'browse',
      search: '',
      filters: new Set(ALL_CATEGORIES), // browsing filters
      quizFilters: new Set(ALL_CATEGORIES),
      quizCount: 5,
    };

    // Storage keys
    const LS_KEY = 'cal_state_v1';

    function saveState() {
      try {
        const s = {
          activeTab: state.activeTab,
          search: state.search,
          filters: Array.from(state.filters),
          quizFilters: Array.from(state.quizFilters),
          quizCount: state.quizCount,
        };
        localStorage.setItem(LS_KEY, JSON.stringify(s));
      } catch {}
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return;
        const s = JSON.parse(raw);
        if (s.activeTab) state.activeTab = s.activeTab;
        if (typeof s.search === 'string') state.search = s.search;
        if (Array.isArray(s.filters)) state.filters = new Set(s.filters);
        if (Array.isArray(s.quizFilters)) state.quizFilters = new Set(s.quizFilters);
        if (typeof s.quizCount === 'number') state.quizCount = s.quizCount;
      } catch {}
    }

    // Rendering helpers
    function renderCategoryChips(containerId, cats, selectedSet, prefix) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      cats.forEach(cat => {
        const id = `${prefix}-cat-${slug(cat)}`;
        const checked = selectedSet.has(cat);
        const label = document.createElement('label');
        label.className = 'chip';
        label.setAttribute('data-checked', checked ? 'true' : 'false');
        label.title = cat;

        const input = document.createElement('input');
        input.type = 'checkbox';
        input.id = id;
        input.checked = checked;
        input.setAttribute('aria-label', `Filter by ${cat}`);
        input.addEventListener('change', (e) => {
          const on = e.target.checked;
          (prefix === 'browse' ? state.filters : state.quizFilters)[on ? 'add' : 'delete'](cat);
          label.setAttribute('data-checked', on ? 'true' : 'false');
          saveState();
          if (prefix === 'browse') {
            renderList();
          } else {
            updateQuizAvailabilityHint();
          }
        });

        const dot = document.createElement('span');
        dot.className = 'dot';
        dot.setAttribute('aria-hidden','true');

        const text = document.createElement('span');
        text.textContent = cat;

        label.appendChild(input);
        label.appendChild(dot);
        label.appendChild(text);
        container.appendChild(label);
      });
    }

    function highlight(str, q) {
      if (!q) return str;
      try {
        const re = new RegExp(escapeRegExp(q), 'ig');
        return str.replace(re, m => `<mark>${m}</mark>`);
      } catch {
        return str;
      }
    }

    function normalize(s) {
      return s.toLowerCase();
    }

    function filterAcronyms() {
      const q = normalize(state.search.trim());
      const allowed = state.filters;
      return ACRONYMS.filter(a => {
        // category filter
        const hasCat = a.categories.some(c => allowed.has(c));
        if (!hasCat) return false;
        // search filter
        if (!q) return true;
        const hay = `${a.term} ${a.definition} ${a.categories.join(' ')}`.toLowerCase();
        return hay.includes(q);
      }).sort((a,b) => a.term.localeCompare(b.term, undefined, {sensitivity:'base'}));
    }

    function renderList() {
      const list = $('#acronymList');
      const items = filterAcronyms();
      $('#resultsCount').textContent = `${items.length} result${items.length===1?'':'s'}`;

      list.innerHTML = '';
      if (items.length === 0) {
        const empty = document.createElement('li');
        empty.className = 'acronym-item';
        empty.innerHTML = `<div class="definition">No results. Try clearing filters or using a different search.</div>`;
        list.appendChild(empty);
        return;
      }

      const q = state.search.trim();

      items.forEach(a => {
        const li = document.createElement('li');
        li.className = 'acronym-item';
        li.dataset.acronym = a.term;

        const term = document.createElement('div');
        term.className = 'term';
        term.innerHTML = highlight(a.term, q);

        const body = document.createElement('div');
        const def = document.createElement('div');
        def.className = 'definition';
        def.innerHTML = highlight(a.definition, q);

        const meta = document.createElement('div');
        meta.className = 'meta';
        a.categories.forEach(c => {
          const span = document.createElement('span');
          span.className = 'tag';
          span.textContent = c;
          meta.appendChild(span);
        });

        body.appendChild(def);
        body.appendChild(meta);

        const actions = document.createElement('div');
        actions.className = 'actions';
        const copyBtn = document.createElement('button');
        copyBtn.type = 'button';
        copyBtn.className = 'btn copy-btn';
        copyBtn.textContent = 'Copy';
        copyBtn.id = `copy-${slug(a.term)}`;
        copyBtn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(`${a.term}: ${a.definition}`);
            copyBtn.textContent = 'Copied!';
            setTimeout(() => copyBtn.textContent = 'Copy', 1000);
          } catch {
            copyBtn.textContent = 'Failed';
            setTimeout(() => copyBtn.textContent = 'Copy', 1000);
          }
        });
        actions.appendChild(copyBtn);

        li.appendChild(term);
        li.appendChild(body);
        li.appendChild(actions);
        list.appendChild(li);
      });
    }

    // Tabs
    function setTab(tab) {
      state.activeTab = tab;
      $('#tabBrowse').setAttribute('aria-selected', String(tab==='browse'));
      $('#tabQuiz').setAttribute('aria-selected', String(tab==='quiz'));
      $('#browseSection').hidden = tab !== 'browse';
      $('#quizSection').hidden = tab !== 'quiz';
      saveState();
    }

    // Quiz Logic
    const quiz = {
      pool: [],
      current: 0,
      order: [],
      score: 0,
      answers: [], // {term, correctDef, chosenDef, correct:boolean}
      selectedIndex: null,
      options: [], // current shuffled options (array of definitions)
      maxOptions: 4,
    };

    function getQuizPool() {
      const allowed = state.quizFilters;
      let pool = ACRONYMS.filter(a => a.categories.some(c => allowed.has(c)));
      if (pool.length === 0) pool = ACRONYMS.slice();
      return pool.sort((a,b)=>a.term.localeCompare(b.term));
    }

    function updateQuizAvailabilityHint() {
      const pool = getQuizPool();
      // update submit button availability or hints if needed
      // For now, just ensure quizCount is within bounds
      const maxCount = Math.min(15, pool.length);
      const desired = state.quizCount;
      const clamped = clamp(desired, 1, Math.max(1, maxCount));
      if (clamped !== desired) {
        state.quizCount = clamped;
        $('#quizCountInput').value = String(clamped);
        $('#quizCountDisplay').textContent = String(clamped);
      }
    }

    function renderQuizOptions(options) {
      const container = $('#quizOptions');
      container.innerHTML = '';
      options.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'option-btn';
        btn.id = `quizOption${idx+1}`;
        btn.setAttribute('data-index', idx);
        btn.setAttribute('data-selected','false');
        btn.innerHTML = `<strong>${idx+1}.</strong> <span>${opt}</span>`;
        btn.addEventListener('click', () => selectOption(idx));
        container.appendChild(btn);
      });
    }

    function selectOption(idx) {
      quiz.selectedIndex = idx;
      $$('#quizOptions .option-btn').forEach((b, i) => b.setAttribute('data-selected', String(i===idx)));
      $('#quizSubmitButton').disabled = false;
    }

    function submitAnswer() {
      if (quiz.selectedIndex == null) return;
      const correctDef = quiz.pool[quiz.order[quiz.current]].definition;
      const chosenDef = quiz.options[quiz.selectedIndex];
      const isCorrect = correctDef === chosenDef;

      // visual feedback
      $$('#quizOptions .option-btn').forEach((b, i) => {
        const def = quiz.options[i];
        if (def === correctDef) b.setAttribute('data-correct','true');
        else if (i === quiz.selectedIndex) b.setAttribute('data-correct','false');
        b.disabled = true;
      });

      $('#quizSubmitButton').disabled = true;
      $('#quizNextButton').disabled = false;

      if (isCorrect) quiz.score++;

      quiz.answers.push({
        term: quiz.pool[quiz.order[quiz.current]].term,
        correctDef,
        chosenDef,
        correct: isCorrect
      });
      updateQuizHeader();
    }

    function nextQuestion() {
      quiz.current++;
      if (quiz.current >= quiz.order.length) {
        finishQuiz();
        return;
      }
      showQuestion();
    }

    function startQuiz() {
      quiz.pool = getQuizPool();
      const maxCount = Math.min(quiz.pool.length, 15);
      const count = clamp(state.quizCount, 1, Math.max(1, maxCount));
      quiz.order = shuffle([...Array(quiz.pool.length).keys()]).slice(0, count);
      quiz.current = 0;
      quiz.score = 0;
      quiz.answers = [];
      quiz.selectedIndex = null;
      $('#quizSummary').hidden = true;
      $('#quizPlaceholder').hidden = true;
      $('#quizCard').hidden = false;
      $('#quizRestartButton').hidden = false;

      showQuestion();
      updateQuizHeader();
    }

    function buildOptions(correctIdx) {
      const correctDef = quiz.pool[correctIdx].definition;
      const defs = new Set([correctDef]);
      // seed from pool first
      const poolDefs = shuffle(quiz.pool.map(a => a.definition));
      for (const d of poolDefs) {
        if (defs.size >= quiz.maxOptions) break;
        if (d !== correctDef) defs.add(d);
      }
      // fallback from the full dataset if needed
      if (defs.size < quiz.maxOptions) {
        const moreDefs = shuffle(ACRONYMS.map(a => a.definition));
        for (const d of moreDefs) {
          if (defs.size >= quiz.maxOptions) break;
          if (d !== correctDef) defs.add(d);
        }
      }
      return shuffle(Array.from(defs));
    }

    function showQuestion() {
      const idxInPool = quiz.order[quiz.current];
      const card = $('#quizCard');
      const term = quiz.pool[idxInPool].term;

      $('#quizQuestionText').textContent = `What does "${term}" stand for?`;
      quiz.options = buildOptions(idxInPool);
      renderQuizOptions(quiz.options);

      quiz.selectedIndex = null;
      $('#quizSubmitButton').disabled = true;
      $('#quizNextButton').disabled = true;
      $$('#quizOptions .option-btn').forEach(b => {
        b.disabled = false;
        b.removeAttribute('data-correct');
        b.setAttribute('data-selected','false');
      });
      updateQuizHeader();
    }

    function updateQuizHeader() {
      const total = quiz.order.length || 0;
      const current = Math.min(quiz.current + 1, total);
      $('#quizProgressText').textContent = total ? `Question ${current} of ${total}` : 'Not started';
      $('#quizScoreText').textContent = `Score: ${quiz.score}`;
      const pct = total ? Math.round((quiz.current / total) * 100) : 0;
      $('#quizProgressBar').style.width = `${pct}%`;
    }

    function finishQuiz() {
      $('#quizCard').hidden = true;
      $('#quizSummary').hidden = false;
      $('#quizPlaceholder').hidden = true;

      const total = quiz.order.length;
      const correct = quiz.score;
      const stats = `You got ${correct} out of ${total} correct (${Math.round((correct/total)*100)}%).`;
      $('#quizSummaryStats').textContent = stats;

      const review = $('#quizReview');
      review.innerHTML = '';
      quiz.answers.forEach((a, i) => {
        const row = document.createElement('div');
        row.className = 'panel';
        row.style.marginTop = '8px';
        const section = document.createElement('div');
        section.className = 'panel-section';
        section.innerHTML = `
          <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
            <div><strong>Q${i+1}:</strong> ${a.term}</div>
            <div>${a.correct ? '‚úÖ' : '‚ùå'}</div>
          </div>
          <div style="margin-top:6px;">
            <div><strong>Correct:</strong> ${a.correctDef}</div>
            ${a.correct ? '' : `<div><strong>Your answer:</strong> ${a.chosenDef}</div>`}
          </div>
        `;
        row.appendChild(section);
        review.appendChild(row);
      });

      // fill progress bar to 100%
      $('#quizProgressBar').style.width = '100%';
      $('#quizProgressText').textContent = 'Quiz completed';
    }

    // Event bindings
    function bindUI() {
      // Tabs
      $('#tabBrowse').addEventListener('click', () => setTab('browse'));
      $('#tabQuiz').addEventListener('click', () => setTab('quiz'));

      // Search
      const searchInput = $('#searchInput');
      searchInput.value = state.search;
      searchInput.addEventListener('input', e => {
        state.search = e.target.value;
        saveState();
        renderList();
      });
      $('#clearSearchBtn').addEventListener('click', () => {
        state.search = '';
        searchInput.value = '';
        saveState();
        renderList();
        searchInput.focus();
      });

      // Filters - Browse
      $('#catSelectAllBtn').addEventListener('click', () => {
        state.filters = new Set(ALL_CATEGORIES);
        renderCategoryChips('categoryFilters', ALL_CATEGORIES, state.filters, 'browse');
        saveState();
        renderList();
      });
      $('#catClearBtn').addEventListener('click', () => {
        state.filters = new Set(); // none
        renderCategoryChips('categoryFilters', ALL_CATEGORIES, state.filters, 'browse');
        saveState();
        renderList();
      });

      // Quiz controls
      const countInput = $('#quizCountInput');
      const countDisplay = $('#quizCountDisplay');
      countInput.value = state.quizCount;
      countDisplay.textContent = String(state.quizCount);
      countInput.addEventListener('input', e => {
        state.quizCount = parseInt(e.target.value, 10) || 5;
        countDisplay.textContent = String(state.quizCount);
        saveState();
        updateQuizAvailabilityHint();
      });

      $('#quizSelectAllBtn').addEventListener('click', () => {
        state.quizFilters = new Set(ALL_CATEGORIES);
        renderCategoryChips('quizCategoryFilters', ALL_CATEGORIES, state.quizFilters, 'quiz');
        saveState();
        updateQuizAvailabilityHint();
      });
      $('#quizClearBtn').addEventListener('click', () => {
        state.quizFilters = new Set();
        renderCategoryChips('quizCategoryFilters', ALL_CATEGORIES, state.quizFilters, 'quiz');
        saveState();
        updateQuizAvailabilityHint();
      });

      $('#quizStartButton').addEventListener('click', () => startQuiz());
      $('#quizRestartButton').addEventListener('click', () => startQuiz());
      $('#quizSubmitButton').addEventListener('click', () => submitAnswer());
      $('#quizNextButton').addEventListener('click', () => nextQuestion());

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        const tab = state.activeTab;
        if (tab !== 'quiz') return;
        const key = e.key;
        if (['1','2','3','4'].includes(key)) {
          const idx = parseInt(key,10)-1;
          const btn = document.getElementById(`quizOption${idx+1}`);
          if (btn && !btn.disabled) {
            selectOption(idx);
          }
        } else if (key === 'Enter') {
          const submit = $('#quizSubmitButton');
          const next = $('#quizNextButton');
          if (!submit.disabled) submit.click();
          else if (!next.disabled) next.click();
        }
      });
    }

    // Init
    function init() {
      loadState();

      // Year
      $('#year').textContent = new Date().getFullYear();

      // Render category chips
      renderCategoryChips('categoryFilters', ALL_CATEGORIES, state.filters, 'browse');
      renderCategoryChips('quizCategoryFilters', ALL_CATEGORIES, state.quizFilters, 'quiz');

      // Render list
      renderList();

      // Set tab
      setTab(state.activeTab || 'browse');

      // Update quiz hints
      updateQuizAvailabilityHint();

      // Bind events
      bindUI();
    }

    // Defer init to ensure DOM present
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>