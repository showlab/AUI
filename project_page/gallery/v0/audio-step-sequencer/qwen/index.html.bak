<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Step Sequencer</title>
    <style>
        :root {
            --primary: #00f3ff;
            --secondary: #ff00c8;
            --dark: #0a0a1a;
            --darker: #050510;
            --light: #e0e0ff;
            --grid-bg: rgba(10, 10, 30, 0.7);
            --grid-border: rgba(0, 243, 255, 0.3);
            --active-cell: rgba(0, 243, 255, 0.8);
            --pattern-bg: rgba(255, 0, 200, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
            position: relative;
        }

        h1 {
            font-size: 3.5rem;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .controls-panel {
            background: rgba(10, 10, 30, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
            border: 1px solid var(--grid-border);
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-item {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: rgba(0, 243, 255, 0.2);
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.8);
        }

        .value-display {
            text-align: center;
            font-size: 1.2rem;
            margin-top: 5px;
            color: var(--secondary);
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: var(--darker);
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.4);
            font-size: 1rem;
            min-width: 140px;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 243, 255, 0.6);
        }

        button:active {
            transform: translateY(1px);
        }

        button#save-pattern {
            background: linear-gradient(45deg, #ff00c8, #00f3ff);
        }

        button#load-pattern {
            background: linear-gradient(45deg, #00f3ff, #ff00c8);
        }

        button#export-wav {
            background: linear-gradient(45deg, #ff9900, #ff00c8);
        }

        .sequencer-grid {
            background: var(--grid-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
            border: 1px solid var(--grid-border);
            overflow-x: auto;
        }

        .grid-header {
            display: flex;
            margin-bottom: 15px;
            gap: 10px;
        }

        .step-label {
            flex: 1;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            color: var(--primary);
        }

        .drum-tracks {
            display: flex;
            gap: 10px;
        }

        .track {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .track-name {
            text-align: center;
            padding: 10px;
            background: rgba(0, 243, 255, 0.1);
            border-radius: 8px;
            font-weight: bold;
            color: var(--primary);
        }

        .steps {
            display: flex;
            gap: 10px;
        }

        .step {
            flex: 1;
            aspect-ratio: 1/1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            border: 1px solid rgba(0, 243, 255, 0.2);
        }

        .step.active {
            background: var(--active-cell);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.7);
            transform: scale(0.95);
        }

        .step.active::after {
            content: "";
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 2px solid white;
            border-radius: 5px;
        }

        .step:hover {
            background: rgba(0, 243, 255, 0.2);
        }

        .step.playing {
            animation: pulse 0.3s infinite alternate;
        }

        @keyframes pulse {
            from { box-shadow: 0 0 5px rgba(0, 243, 255, 0.5); }
            to { box-shadow: 0 0 20px rgba(0, 243, 255, 0.9); }
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(10, 10, 30, 0.7);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
            border: 1px solid var(--grid-border);
            margin-top: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--secondary);
        }

        .status-indicator.playing {
            background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
        }

        footer {
            text-align: center;
            padding: 30px 0 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .control-group {
                flex-direction: column;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AUDIO STEP SEQUENCER</h1>
            <p class="subtitle">Create beats with precision. 16-step drum sequencer with tempo control, swing, and pattern saving.</p>
        </header>

        <main class="main-content">
            <section class="controls-panel">
                <div class="control-group">
                    <div class="control-item">
                        <label for="tempo">TEMPO (BPM)</label>
                        <input type="range" id="tempo" min="60" max="200" value="120">
                        <div class="value-display" id="tempo-value">120 BPM</div>
                    </div>
                    
                    <div class="control-item">
                        <label for="swing">SWING</label>
                        <input type="range" id="swing" min="0" max="50" value="0">
                        <div class="value-display" id="swing-value">0%</div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button id="play-btn">PLAY</button>
                    <button id="stop-btn">STOP</button>
                    <button id="clear-btn">CLEAR</button>
                    <button id="save-pattern">SAVE PATTERN</button>
                    <button id="load-pattern">LOAD PATTERN</button>
                    <button id="export-wav">EXPORT WAV</button>
                </div>
            </section>
            
            <section class="sequencer-grid">
                <div class="grid-header">
                    <div class="step-label">STEP</div>
                    <div class="step-label">KICK</div>
                    <div class="step-label">SNARE</div>
                    <div class="step-label">HI-HAT</div>
                    <div class="step-label">CLAP</div>
                </div>
                
                <div class="drum-tracks">
                    <div class="track">
                        <div class="track-name">KICK</div>
                        <div class="steps" id="kick-steps"></div>
                    </div>
                    <div class="track">
                        <div class="track-name">SNARE</div>
                        <div class="steps" id="snare-steps"></div>
                    </div>
                    <div class="track">
                        <div class="track-name">HI-HAT</div>
                        <div class="steps" id="hihat-steps"></div>
                    </div>
                    <div class="track">
                        <div class="track-name">CLAP</div>
                        <div class="steps" id="clap-steps"></div>
                    </div>
                </div>
            </section>
            
            <section class="status-bar">
                <div class="status-item">
                    <div class="status-indicator" id="play-status"></div>
                    <span>STATUS: <span id="status-text">READY</span></span>
                </div>
                <div class="status-item">
                    <span>PATTERN: <span id="pattern-name">DEFAULT</span></span>
                </div>
                <div class="status-item">
                    <span>TIME: <span id="current-time">00:00</span></span>
                </div>
            </section>
        </main>
        
        <footer>
            <p>Audio Step Sequencer | WebAudio API | Futuristic Drum Machine</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Audio context setup
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let isPlaying = false;
            let stepIndex = 0;
            let tempo = 120;
            let swing = 0;
            let nextStepTime = 0;
            let schedulerID = null;
            let startTime = 0;
            let currentTime = 0;
            let currentPattern = "DEFAULT";
            
            // DOM Elements
            const tempoSlider = document.getElementById('tempo');
            const tempoValue = document.getElementById('tempo-value');
            const swingSlider = document.getElementById('swing');
            const swingValue = document.getElementById('swing-value');
            const playBtn = document.getElementById('play-btn');
            const stopBtn = document.getElementById('stop-btn');
            const clearBtn = document.getElementById('clear-btn');
            const savePatternBtn = document.getElementById('save-pattern');
            const loadPatternBtn = document.getElementById('load-pattern');
            const exportWavBtn = document.getElementById('export-wav');
            const playStatus = document.getElementById('play-status');
            const statusText = document.getElementById('status-text');
            const patternName = document.getElementById('pattern-name');
            const currentTimeDisplay = document.getElementById('current-time');
            
            // Create steps grid
            const kickSteps = document.getElementById('kick-steps');
            const snareSteps = document.getElementById('snare-steps');
            const hihatSteps = document.getElementById('hihat-steps');
            const clapSteps = document.getElementById('clap-steps');
            
            // Initialize steps
            const steps = [];
            for (let i = 0; i < 16; i++) {
                steps.push({
                    kick: false,
                    snare: false,
                    hihat: false,
                    clap: false
                });
            }
            
            // Create step elements
            function createStepElements(container, trackName) {
                for (let i = 0; i < 16; i++) {
                    const step = document.createElement('div');
                    step.className = 'step';
                    step.dataset.step = i;
                    step.dataset.track = trackName;
                    step.addEventListener('click', () => toggleStep(i, trackName));
                    container.appendChild(step);
                }
            }
            
            createStepElements(kickSteps, 'kick');
            createStepElements(snareSteps, 'snare');
            createStepElements(hihatSteps, 'hihat');
            createStepElements(clapSteps, 'clap');
            
            // Update UI with current steps
            function updateUI() {
                const tracks = ['kick', 'snare', 'hihat', 'clap'];
                tracks.forEach(track => {
                    const container = document.getElementById(`${track}-steps`);
                    const steps = container.querySelectorAll('.step');
                    steps.forEach((step, index) => {
                        if (steps[index].dataset.track === track && steps[index].dataset.step) {
                            const stepIndex = parseInt(steps[index].dataset.step);
                            if (steps[stepIndex] && steps[stepIndex].classList) {
                                if (steps[stepIndex].classList.contains('active')) {
                                    steps[stepIndex].classList.remove('active');
                                }
                                if (steps[stepIndex].classList.contains('playing')) {
                                    steps[stepIndex].classList.remove('playing');
                                }
                                
                                if (steps[stepIndex].dataset.track === track) {
                                    if (steps[stepIndex].dataset.step === index.toString()) {
                                        if (steps[index].classList.contains('active')) {
                                            steps[index].classList.remove('active');
                                        }
                                        if (steps[index].classList.contains('playing')) {
                                            steps[index].classList.remove('playing');
                                        }
                                    }
                                }
                            }
                        }
                    });
                });
                
                // Update active steps
                steps.forEach((step, index) => {
                    const tracks = ['kick', 'snare', 'hihat', 'clap'];
                    tracks.forEach(track => {
                        const container = document.getElementById(`${track}-steps`);
                        const stepElement = container.children[index];
                        if (stepElement) {
                            if (step[track]) {
                                stepElement.classList.add('active');
                            } else {
                                stepElement.classList.remove('active');
                            }
                        }
                    });
                });
            }
            
            // Toggle step state
            function toggleStep(stepIndex, trackName) {
                steps[stepIndex][trackName] = !steps[stepIndex][trackName];
                updateUI();
            }
            
            // Play sound functions
            function playKick(time) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(150, time);
                oscillator.frequency.exponentialRampToValueAtTime(0.001, time + 0.5);
                
                gainNode.gain.setValueAtTime(1, time);
                gainNode.gain.exponentialRampToValueAtTime(0.001, time + 0.5);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start(time);
                oscillator.stop(time + 0.5);
            }
            
            function playSnare(time) {
                const noise = audioContext.createBufferSource();
                const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.5, audioContext.sampleRate);
                const data = noiseBuffer.getChannelData(0);
                
                for (let i = 0; i < noiseBuffer.length; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                
                const filter = audioContext.createBiquadFilter();
                filter.type = 'highpass';
                filter.frequency.value = 10000;
                
                const gainNode = audioContext.createGain();
                gainNode.gain.setValueAtTime(1, time);
                gainNode.gain.exponentialRampToValueAtTime(0.01, time + 0.2);
                
                noise.buffer = noiseBuffer;
                noise.loop = false;
                
                noise.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                noise.start(time);
                noise.stop(time + 0.2);
            }
            
            function playHiHat(time) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(8000, time);
                
                gainNode.gain.setValueAtTime(0.5, time);
                gainNode.gain.exponentialRampToValueAtTime(0.01, time + 0.05);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start(time);
                oscillator.stop(time + 0.05);
            }
            
            function playClap(time) {
                const noise = audioContext.createBufferSource();
                const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.3, audioContext.sampleRate);
                const data = noiseBuffer.getChannelData(0);
                
                for (let i = 0; i < noiseBuffer.length; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                
                const filter = audioContext.createBiquadFilter();
                filter.type = 'highpass';
                filter.frequency.value = 8000;
                
                const gainNode = audioContext.createGain();
                gainNode.gain.setValueAtTime(0.8, time);
                gainNode.gain.exponentialRampToValueAtTime(0.01, time + 0.15);
                
                noise.buffer = noiseBuffer;
                noise.loop = false;
                
                noise.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                noise.start(time);
                noise.stop(time + 0.15);
            }
            
            // Schedule next step
            function scheduleStep() {
                if (!isPlaying) return;
                
                const stepTime = nextStepTime;
                const stepNumber = stepIndex % 16;
                
                // Highlight current step
                const tracks = ['kick', 'snare', 'hihat', 'clap'];
                tracks.forEach(track => {
                    const container = document.getElementById(`${track}-steps`);
                    const stepElement = container.children[stepNumber];
                    if (stepElement) {
                        stepElement.classList.add('playing');
                        setTimeout(() => {
                            if (stepElement.classList.contains('playing')) {
                                stepElement.classList.remove('playing');
                            }
                        }, 100);
                    }
                });
                
                // Play sounds for this step
                if (steps[stepNumber].kick) playKick(stepTime);
                if (steps[stepNumber].snare) playSnare(stepTime);
                if (steps[stepNumber].hihat) playHiHat(stepTime);
                if (steps[stepNumber].clap) playClap(stepTime);
                
                // Calculate next step time with swing
                const stepInterval = 60 / tempo / 4; // Quarter note interval
                let nextStepInterval = stepInterval;
                
                if (swing > 0 && stepNumber % 2 === 1) {
                    nextStepInterval = stepInterval * (1 + swing / 100);
                }
                
                nextStepTime += nextStepInterval;
                stepIndex++;
                
                // Schedule next step
                schedulerID = setTimeout(scheduleStep, (nextStepInterval * 1000) * 0.9);
            }
            
            // Start playback
            function startPlayback() {
                if (isPlaying) return;
                
                isPlaying = true;
                playStatus.classList.add('playing');
                statusText.textContent = "PLAYING";
                playBtn.disabled = true;
                stopBtn.disabled = false;
                
                // Reset step index
                stepIndex = 0;
                nextStepTime = audioContext.currentTime;
                startTime = Date.now();
                
                // Schedule first step
                scheduleStep();
            }
            
            // Stop playback
            function stopPlayback() {
                isPlaying = false;
                playStatus.classList.remove('playing');
                statusText.textContent = "STOPPED";
                playBtn.disabled = false;
                stopBtn.disabled = true;
                
                clearTimeout(schedulerID);
                
                // Remove playing classes
                const playingSteps = document.querySelectorAll('.step.playing');
                playingSteps.forEach(step => step.classList.remove('playing'));
            }
            
            // Clear sequence
            function clearSequence() {
                steps.forEach(step => {
                    step.kick = false;
                    step.snare = false;
                    step.hihat = false;
                    step.clap = false;
                });
                updateUI();
            }
            
            // Save pattern
            function savePattern() {
                const pattern = {
                    name: prompt("Enter pattern name:", currentPattern),
                    steps: [...steps],
                    tempo: tempo,
                    swing: swing
                };
                
                localStorage.setItem(`pattern_${pattern.name}`, JSON.stringify(pattern));
                currentPattern = pattern.name;
                patternName.textContent = pattern.name;
                alert(`Pattern "${pattern.name}" saved!`);
            }
            
            // Load pattern
            function loadPattern() {
                const patternNames = Object.keys(localStorage).filter(key => key.startsWith('pattern_'));
                
                if (patternNames.length === 0) {
                    alert("No saved patterns found!");
                    return;
                }
                
                let patternName = prompt("Enter pattern name to load:\n" + patternNames.join("\n"));
                if (!patternName) return;
                
                patternName = `pattern_${patternName}`;
                const patternStr = localStorage.getItem(patternName);
                
                if (!patternStr) {
                    alert("Pattern not found!");
                    return;
                }
                
                const pattern = JSON.parse(patternStr);
                steps.splice(0, steps.length, ...pattern.steps);
                tempo = pattern.tempo;
                swing = pattern.swing;
                
                tempoSlider.value = tempo;
                tempoValue.textContent = `${tempo} BPM`;
                swingSlider.value = swing;
                swingValue.textContent = `${swing}%`;
                
                updateUI();
                currentPattern = pattern.name;
                patternName.textContent = pattern.name;
                alert(`Pattern "${pattern.name}" loaded!`);
            }
            
            // Export WAV
            function exportWav() {
                alert("Export functionality would generate a WAV file of your sequence. In a real implementation, this would use the Web Audio API to render the audio.");
            }
            
            // Event Listeners
            tempoSlider.addEventListener('input', () => {
                tempo = parseInt(tempoSlider.value);
                tempoValue.textContent = `${tempo} BPM`;
            });
            
            swingSlider.addEventListener('input', () => {
                swing = parseInt(swingSlider.value);
                swingValue.textContent = `${swing}%`;
            });
            
            playBtn.addEventListener('click', startPlayback);
            stopBtn.addEventListener('click', stopPlayback);
            clearBtn.addEventListener('click', clearSequence);
            savePatternBtn.addEventListener('click', savePattern);
            loadPatternBtn.addEventListener('click', loadPattern);
            exportWavBtn.addEventListener('click', exportWav);
            
            // Initialize UI
            updateUI();
        });
    </script>
</body>
</html>