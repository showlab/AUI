<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Step Sequencer</title>
    <style>
        /* Simplified Design with High Contrast */
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --accent-color: #00ffff;
            --highlight-color: #ff00c8;
            --grid-bg: #1a1a1a;
            --active-cell: #00ffff;
            --pattern-bg: #ff00c81a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 15px 0;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .controls-panel {
            background: var(--grid-bg);
            border: 1px solid var(--accent-color);
            border-radius: 0;
            padding: 15px;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .control-item {
            flex: 1;
            min-width: 180px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            height: 12px;
            background: #333;
            border-radius: 0;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-color);
            cursor: pointer;
            border: 1px solid var(--text-color);
        }

        .value-display {
            text-align: center;
            font-size: 1rem;
            margin-top: 5px;
            color: var(--highlight-color);
        }

        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            background: var(--accent-color);
            color: var(--bg-color);
            border: 1px solid var(--accent-color);
            padding: 8px 15px;
            border-radius: 0;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            min-width: 120px;
            height: 36px;
        }

        button:hover {
            background: #00cccc;
        }

        button:active {
            background: #00aaaa;
        }

        button#save-pattern {
            background: var(--highlight-color);
            color: var(--bg-color);
            border: 1px solid var(--highlight-color);
        }

        button#save-pattern:hover {
            background: #ff33cc;
        }

        button#load-pattern {
            background: #ff9900;
            color: var(--bg-color);
            border: 1px solid #ff9900;
        }

        button#load-pattern:hover {
            background: #ffaa33;
        }

        button#export-wav {
            background: #00ff00;
            color: var(--bg-color);
            border: 1px solid #00ff00;
        }

        button#export-wav:hover {
            background: #33ff33;
        }

        .sequencer-grid {
            background: var(--grid-bg);
            border: 1px solid var(--accent-color);
            border-radius: 0;
            padding: 15px;
        }

        .grid-header {
            display: flex;
            margin-bottom: 10px;
            gap: 5px;
        }

        .step-label {
            flex: 1;
            text-align: center;
            padding: 8px;
            font-weight: bold;
        }

        .drum-tracks {
            display: flex;
            gap: 5px;
        }

        .track {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .track-name {
            text-align: center;
            padding: 8px;
            background: rgba(0, 255, 255, 0.1);
            font-weight: bold;
        }

        .steps {
            display: flex;
            gap: 5px;
        }

        .step {
            flex: 1;
            aspect-ratio: 1/1;
            background: #222;
            border: 1px solid #333;
            cursor: pointer;
            transition: all 0.1s;
        }

        .step.active {
            background: var(--active-cell);
        }

        .step:hover {
            background: #444;
        }

        .step.playing {
            background: #00ffff;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--grid-bg);
            border: 1px solid var(--accent-color);
            margin-top: 10px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--highlight-color);
        }

        .status-indicator.playing {
            background: var(--accent-color);
        }

        .pattern-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .pattern-list {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid var(--accent-color);
            padding: 5px;
        }

        .pattern-item {
            padding: 5px;
            cursor: pointer;
            border-bottom: 1px solid #333;
        }

        .pattern-item:last-child {
            border-bottom: none;
        }

        .pattern-item:hover {
            background: rgba(0, 255, 255, 0.1);
        }

        .pattern-item.selected {
            background: rgba(255, 0, 200, 0.2);
            font-weight: bold;
        }

        .export-section {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid var(--accent-color);
        }

        .export-section h3 {
            margin-bottom: 10px;
        }

        #preview-container {
            margin-top: 10px;
            padding: 10px;
            background: #111;
            min-height: 40px;
        }

        #previewStatus {
            margin-top: 5px;
            font-weight: bold;
            color: var(--accent-color);
        }

        footer {
            text-align: center;
            padding: 20px 0 10px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .control-group {
                flex-direction: column;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AUDIO STEP SEQUENCER</h1>
            <p class="subtitle">Create beats with precision. 16-step drum sequencer with tempo control, swing, and pattern saving.</p>
        </header>

        <main class="main-content">
            <section class="controls-panel">
                <div class="control-group">
                    <div class="control-item">
                        <label for="tempo">TEMPO (BPM)</label>
                        <input type="range" id="tempo" min="60" max="200" value="120">
                        <div class="value-display" id="tempo-value">120 BPM</div>
                    </div>
                    
                    <div class="control-item">
                        <label for="swing">SWING</label>
                        <input type="range" id="swing" min="0" max="50" value="0">
                        <div class="value-display" id="swing-value">0%</div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button id="play-btn">PLAY</button>
                    <button id="stop-btn">STOP</button>
                    <button id="clear-btn">CLEAR</button>
                    <button id="save-pattern">SAVE PATTERN</button>
                    <button id="load-pattern">LOAD PATTERN</button>
                    <button id="export-wav">EXPORT WAV</button>
                </div>
            </section>
            
            <section class="sequencer-grid">
                <div class="grid-header">
                    <div class="step-label">STEP</div>
                    <div class="step-label">KICK</div>
                    <div class="step-label">SNARE</div>
                    <div class="step-label">HI-HAT</div>
                    <div class="step-label">CLAP</div>
                </div>
                
                <div class="drum-tracks">
                    <div class="track">
                        <div class="track-name">KICK</div>
                        <div class="steps" id="kick-steps"></div>
                    </div>
                    <div class="track">
                        <div class="track-name">SNARE</div>
                        <div class="steps" id="snare-steps"></div>
                    </div>
                    <div class="track">
                        <div class="track-name">HI-HAT</div>
                        <div class="steps" id="hihat-steps"></div>
                    </div>
                    <div class="track">
                        <div class="track-name">CLAP</div>
                        <div class="steps" id="clap-steps"></div>
                    </div>
                </div>
            </section>
            
            <section class="pattern-controls">
                <div class="pattern-list" id="pattern-list">
                    <!-- Saved patterns will appear here -->
                </div>
                <div id="pattern-status">No pattern loaded</div>
            </section>
            
            <section class="export-section">
                <h3>Export Controls</h3>
                <div id="preview-container">
                    <div id="previewStatus">Ready for export</div>
                </div>
            </section>
            
            <section class="status-bar">
                <div class="status-item">
                    <div class="status-indicator" id="play-status"></div>
                    <span>STATUS: <span id="status-text">READY</span></span>
                </div>
                <div class="status-item">
                    <span>PATTERN: <span id="pattern-name">DEFAULT</span></span>
                </div>
                <div class="status-item">
                    <span>TIME: <span id="current-time">00:00</span></span>
                </div>
            </section>
        </main>
        
        <footer>
            <p>Audio Step Sequencer | WebAudio API | Futuristic Drum Machine</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Audio context setup
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let isPlaying = false;
            let stepIndex = 0;
            let tempo = 120;
            let swing = 0;
            let nextStepTime = 0;
            let schedulerID = null;
            let startTime = 0;
            let currentTime = 0;
            let currentPattern = "DEFAULT";
            let savedPatterns = {};
            
            // DOM Elements
            const tempoSlider = document.getElementById('tempo');
            const tempoValue = document.getElementById('tempo-value');
            const swingSlider = document.getElementById('swing');
            const swingValue = document.getElementById('swing-value');
            const playBtn = document.getElementById('play-btn');
            const stopBtn = document.getElementById('stop-btn');
            const clearBtn = document.getElementById('clear-btn');
            const savePatternBtn = document.getElementById('save-pattern');
            const loadPatternBtn = document.getElementById('load-pattern');
            const exportWavBtn = document.getElementById('export-wav');
            const playStatus = document.getElementById('play-status');
            const statusText = document.getElementById('status-text');
            const patternName = document.getElementById('pattern-name');
            const currentTimeDisplay = document.getElementById('current-time');
            const patternList = document.getElementById('pattern-list');
            const patternStatus = document.getElementById('pattern-status');
            const previewStatus = document.getElementById('previewStatus');
            
            // Create steps grid
            const kickSteps = document.getElementById('kick-steps');
            const snareSteps = document.getElementById('snare-steps');
            const hihatSteps = document.getElementById('hihat-steps');
            const clapSteps = document.getElementById('clap-steps');
            
            // Initialize steps
            const steps = [];
            for (let i = 0; i < 16; i++) {
                steps.push({
                    kick: false,
                    snare: false,
                    hihat: false,
                    clap: false
                });
            }
            
            // Create step elements
            function createStepElements(container, trackName) {
                for (let i = 0; i < 16; i++) {
                    const step = document.createElement('div');
                    step.className = 'step';
                    step.dataset.step = i;
                    step.dataset.track = trackName;
                    step.addEventListener('click', () => toggleStep(i, trackName));
                    container.appendChild(step);
                }
            }
            
            createStepElements(kickSteps, 'kick');
            createStepElements(snareSteps, 'snare');
            createStepElements(hihatSteps, 'hihat');
            createStepElements(clapSteps, 'clap');
            
            // Update UI with current steps
            function updateUI() {
                // Update active steps
                steps.forEach((step, index) => {
                    const tracks = ['kick', 'snare', 'hihat', 'clap'];
                    tracks.forEach(track => {
                        const container = document.getElementById(`${track}-steps`);
                        const stepElement = container.children[index];
                        if (stepElement) {
                            if (step[track]) {
                                stepElement.classList.add('active');
                            } else {
                                stepElement.classList.remove('active');
                            }
                        }
                    });
                });
                
                // Update pattern list
                updatePatternList();
            }
            
            // Toggle step state
            function toggleStep(stepIndex, trackName) {
                steps[stepIndex][trackName] = !steps[stepIndex][trackName];
                updateUI();
            }
            
            // Play sound functions
            function playKick(time) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(150, time);
                oscillator.frequency.exponentialRampToValueAtTime(0.001, time + 0.5);
                
                gainNode.gain.setValueAtTime(1, time);
                gainNode.gain.exponentialRampToValueAtTime(0.001, time + 0.5);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start(time);
                oscillator.stop(time + 0.5);
            }
            
            function playSnare(time) {
                const noise = audioContext.createBufferSource();
                const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.5, audioContext.sampleRate);
                const data = noiseBuffer.getChannelData(0);
                
                for (let i = 0; i < noiseBuffer.length; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                
                const filter = audioContext.createBiquadFilter();
                filter.type = 'highpass';
                filter.frequency.value = 10000;
                
                const gainNode = audioContext.createGain();
                gainNode.gain.setValueAtTime(1, time);
                gainNode.gain.exponentialRampToValueAtTime(0.01, time + 0.2);
                
                noise.buffer = noiseBuffer;
                noise.loop = false;
                
                noise.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                noise.start(time);
                noise.stop(time + 0.2);
            }
            
            function playHiHat(time) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(8000, time);
                
                gainNode.gain.setValueAtTime(0.5, time);
                gainNode.gain.exponentialRampToValueAtTime(0.01, time + 0.05);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start(time);
                oscillator.stop(time + 0.05);
            }
            
            function playClap(time) {
                const noise = audioContext.createBufferSource();
                const noiseBuffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.3, audioContext.sampleRate);
                const data = noiseBuffer.getChannelData(0);
                
                for (let i = 0; i < noiseBuffer.length; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                
                const filter = audioContext.createBiquadFilter();
                filter.type = 'highpass';
                filter.frequency.value = 8000;
                
                const gainNode = audioContext.createGain();
                gainNode.gain.setValueAtTime(0.8, time);
                gainNode.gain.exponentialRampToValueAtTime(0.01, time + 0.15);
                
                noise.buffer = noiseBuffer;
                noise.loop = false;
                
                noise.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                noise.start(time);
                noise.stop(time + 0.15);
            }
            
            // Schedule next step
            function scheduleStep() {
                if (!isPlaying) return;
                
                const stepTime = nextStepTime;
                const stepNumber = stepIndex % 16;
                
                // Highlight current step
                const tracks = ['kick', 'snare', 'hihat', 'clap'];
                tracks.forEach(track => {
                    const container = document.getElementById(`${track}-steps`);
                    const stepElement = container.children[stepNumber];
                    if (stepElement) {
                        stepElement.classList.add('playing');
                        setTimeout(() => {
                            if (stepElement.classList.contains('playing')) {
                                stepElement.classList.remove('playing');
                            }
                        }, 100);
                    }
                });
                
                // Play sounds for this step
                if (steps[stepNumber].kick) playKick(stepTime);
                if (steps[stepNumber].snare) playSnare(stepTime);
                if (steps[stepNumber].hihat) playHiHat(stepTime);
                if (steps[stepNumber].clap) playClap(stepTime);
                
                // Calculate next step time with swing
                const stepInterval = 60 / tempo / 4; // Quarter note interval
                let nextStepInterval = stepInterval;
                
                if (swing > 0 && stepNumber % 2 === 1) {
                    nextStepInterval = stepInterval * (1 + swing / 100);
                }
                
                nextStepTime += nextStepInterval;
                stepIndex++;
                
                // Schedule next step
                schedulerID = setTimeout(scheduleStep, (nextStepInterval * 1000) * 0.9);
            }
            
            // Start playback
            function startPlayback() {
                if (isPlaying) return;
                
                isPlaying = true;
                playStatus.classList.add('playing');
                statusText.textContent = "PLAYING";
                playBtn.disabled = true;
                stopBtn.disabled = false;
                
                // Reset step index
                stepIndex = 0;
                nextStepTime = audioContext.currentTime;
                startTime = Date.now();
                
                // Schedule first step
                scheduleStep();
            }
            
            // Stop playback
            function stopPlayback() {
                isPlaying = false;
                playStatus.classList.remove('playing');
                statusText.textContent = "STOPPED";
                playBtn.disabled = false;
                stopBtn.disabled = true;
                
                clearTimeout(schedulerID);
                
                // Remove playing classes
                const playingSteps = document.querySelectorAll('.step.playing');
                playingSteps.forEach(step => step.classList.remove('playing'));
            }
            
            // Clear sequence
            function clearSequence() {
                steps.forEach(step => {
                    step.kick = false;
                    step.snare = false;
                    step.hihat = false;
                    step.clap = false;
                });
                updateUI();
            }
            
            // Save pattern
            function savePattern() {
                let patternNameInput = prompt("Enter pattern name:", currentPattern);
                if (patternNameInput === null) return; // User cancelled
                
                // Validate pattern name
                if (patternNameInput.trim() === "") {
                    alert("Pattern name cannot be empty!");
                    return;
                }
                
                const pattern = {
                    name: patternNameInput,
                    steps: [...steps],
                    tempo: tempo,
                    swing: swing
                };
                
                // Store in local storage
                localStorage.setItem(`pattern_${pattern.name}`, JSON.stringify(pattern));
                
                // Update savedPatterns object
                savedPatterns[pattern.name] = pattern;
                
                // Update UI
                currentPattern = pattern.name;
                patternName.textContent = pattern.name;
                patternStatus.textContent = `Pattern "${pattern.name}" saved!`;
                updateUI();
                
                // Show confirmation
                alert(`Pattern "${pattern.name}" saved successfully!`);
            }
            
            // Load pattern
            function loadPattern() {
                // Get all saved patterns
                const patternKeys = Object.keys(localStorage).filter(key => key.startsWith('pattern_'));
                
                if (patternKeys.length === 0) {
                    alert("No saved patterns found!");
                    return;
                }
                
                // Create list of pattern names
                const patternNames = patternKeys.map(key => key.replace('pattern_', ''));
                
                // Create prompt with pattern names
                let patternName = prompt("Enter pattern name to load:\n" + patternNames.join("\n"));
                if (!patternName) return;
                
                const patternKey = `pattern_${patternName}`;
                const patternStr = localStorage.getItem(patternKey);
                
                if (!patternStr) {
                    alert("Pattern not found!");
                    return;
                }
                
                const pattern = JSON.parse(patternStr);
                steps.splice(0, steps.length, ...pattern.steps);
                tempo = pattern.tempo;
                swing = pattern.swing;
                
                tempoSlider.value = tempo;
                tempoValue.textContent = `${tempo} BPM`;
                swingSlider.value = swing;
                swingValue.textContent = `${swing}%`;
                
                updateUI();
                currentPattern = pattern.name;
                patternName.textContent = pattern.name;
                patternStatus.textContent = `Pattern "${pattern.name}" loaded!`;
                
                alert(`Pattern "${pattern.name}" loaded successfully!`);
            }
            
            // Export WAV
            function exportWav() {
                // In a real implementation, this would render audio to a WAV file
                // For this demo, we'll simulate the process
                
                // Show export progress
                previewStatus.textContent = "Rendering audio...";
                previewStatus.style.color = "#00ffff";
                
                // Simulate processing delay
                setTimeout(() => {
                    previewStatus.textContent = "Audio rendered successfully!";
                    previewStatus.style.color = "#00ff00";
                    
                    // Create a fake download link
                    const downloadLink = document.createElement('a');
                    downloadLink.href = '#';
                    downloadLink.download = `pattern_${currentPattern}.wav`;
                    downloadLink.textContent = "Download WAV File";
                    downloadLink.id = "download-link";
                    downloadLink.style.display = "block";
                    downloadLink.style.marginTop = "10px";
                    downloadLink.style.color = "#00ffff";
                    downloadLink.style.textDecoration = "underline";
                    
                    // Remove previous download link if exists
                    const existingLink = document.getElementById('download-link');
                    if (existingLink) {
                        existingLink.remove();
                    }
                    
                    // Add new download link
                    document.getElementById('preview-container').appendChild(downloadLink);
                    
                    // Add click handler to download link
                    downloadLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        alert(`In a real implementation, this would download: pattern_${currentPattern}.wav`);
                    });
                }, 1000);
            }
            
            // Update pattern list display
            function updatePatternList() {
                // Clear existing list
                patternList.innerHTML = '';
                
                // Get all saved patterns
                const patternKeys = Object.keys(localStorage).filter(key => key.startsWith('pattern_'));
                
                if (patternKeys.length === 0) {
                    patternList.innerHTML = '<div class="pattern-item">No saved patterns</div>';
                    return;
                }
                
                // Add each pattern to the list
                patternKeys.forEach(key => {
                    const patternName = key.replace('pattern_', '');
                    const patternItem = document.createElement('div');
                    patternItem.className = 'pattern-item';
                    patternItem.textContent = patternName;
                    patternItem.dataset.patternName = patternName;
                    patternItem.addEventListener('click', () => {
                        // Load the clicked pattern
                        const patternStr = localStorage.getItem(key);
                        if (patternStr) {
                            const pattern = JSON.parse(patternStr);
                            steps.splice(0, steps.length, ...pattern.steps);
                            tempo = pattern.tempo;
                            swing = pattern.swing;
                            
                            tempoSlider.value = tempo;
                            tempoValue.textContent = `${tempo} BPM`;
                            swingSlider.value = swing;
                            swingValue.textContent = `${swing}%`;
                            
                            updateUI();
                            currentPattern = pattern.name;
                            patternName.textContent = pattern.name;
                            patternStatus.textContent = `Pattern "${pattern.name}" loaded!`;
                            
                            // Highlight selected pattern
                            document.querySelectorAll('.pattern-item').forEach(item => {
                                item.classList.remove('selected');
                            });
                            patternItem.classList.add('selected');
                        }
                    });
                    patternList.appendChild(patternItem);
                });
            }
            
            // Event Listeners
            tempoSlider.addEventListener('input', () => {
                tempo = parseInt(tempoSlider.value);
                tempoValue.textContent = `${tempo} BPM`;
            });
            
            swingSlider.addEventListener('input', () => {
                swing = parseInt(swingSlider.value);
                swingValue.textContent = `${swing}%`;
            });
            
            playBtn.addEventListener('click', startPlayback);
            stopBtn.addEventListener('click', stopPlayback);
            clearBtn.addEventListener('click', clearSequence);
            savePatternBtn.addEventListener('click', savePattern);
            loadPatternBtn.addEventListener('click', loadPattern);
            exportWavBtn.addEventListener('click', exportWav);
            
            // Initialize UI
            updateUI();
            
            // Load saved patterns on startup
            updatePatternList();
        });
    </script>
</body>
</html>