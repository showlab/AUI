<!DOCTYPE html>
<html lang="en">
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Artisan CSA ‚Äî Hand-Drawn Farm Landing (Accessible, Simplified)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Artisan CSA ‚Äî seasonal, hand-harvested produce. Check your ZIP, choose a plan, review delivery map, and contact us. Accessible, fast, and clear UI." />
  <style>
    /* 
      ARTISAN CSA ‚Äî DESTYLIZED, ACCESSIBLE UI
      - White background, black text, high contrast
      - No heavy shadows/gradients; simple borders, readable font sizes
      - Clear focus styles and minimum touch target sizes
      - All IDs preserved; new IDs added for testing and user proxies
      - Supports prefers-reduced-motion
    */

    :root{
      --bg:#ffffff;
      --fg:#000000;
      --muted:#333333;
      --accent:#0a66ff;
      --ok:#1a7f37;
      --error:#b00020;
      --soft:#e6e6e6;
      --ink:#000000; /* kept for SVG that reference var(--ink) */
      --radius:0; /* no rounding */
      --minTarget:44px;
    }

    html, body{
      height:100%;
      margin:0;
      background: var(--bg);
      color: var(--fg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.4;
    }

    /* Global layout */
    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
      box-sizing: border-box;
    }

    header{
      position: sticky;
      top: 0;
      background: #fff;
      border-bottom: 1px solid var(--soft);
      z-index: 50;
    }

    .header-row{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap:16px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .brand h1{
      font-size: 22px; margin:0; color: #000;
    }
    .brand small{ color: var(--muted); }

    .nav{
      display:flex; gap:10px; align-items:center; flex-wrap: wrap;
    }
    .nav a{
      display:inline-block;
      text-decoration: none;
      color: var(--accent);
      border: 1px solid var(--soft);
      padding: 10px 12px;
      min-height: var(--minTarget);
      min-width: var(--minTarget);
      line-height: 22px;
    }
    .nav a:focus, .nav a:hover{
      outline: 2px dashed var(--fg);
      outline-offset: 2px;
      background: #f5f5f5;
    }

    /* Focus utility */
    :focus-visible{
      outline: 2px dashed var(--fg);
      outline-offset: 2px;
    }

    a{ color: var(--accent); }
    p{ margin: 8px 0; }
    h2,h3,h4{ margin: 8px 0; }
    h2{ font-size: 26px; }
    h3{ font-size: 22px; }
    h4{ font-size: 18px; }

    /* Layout: Two-column top area to fit within 1280x720 */
    .top-grid{
      display:grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 16px;
      align-items:start;
    }

    .panel{
      border: 1px solid var(--soft);
      padding: 12px;
      box-sizing: border-box;
      background: #fff;
    }

    .field{
      display:flex;
      gap: 8px;
      align-items: center;
      margin: 8px 0;
      flex-wrap: wrap;
    }

    label{ font-weight: 600; }

    input[type="text"], input[type="email"], textarea{
      border:1px solid #999;
      padding: 10px 12px;
      min-height: var(--minTarget);
      line-height: 22px;
      width: 100%;
      max-width: 320px;
      box-sizing: border-box;
    }
    input[aria-invalid="true"]{
      border-color: var(--error);
    }
    .error-msg{
      color: var(--error);
      font-size: 13px;
      margin-top: 4px;
    }
    .hint{
      font-size: 13px; color: var(--muted);
    }

    button, .btn{
      border: 1px solid #000;
      background:#fff;
      color:#000;
      padding: 10px 12px;
      min-height: var(--minTarget);
      min-width: var(--minTarget);
      cursor:pointer;
    }
    button[disabled], .btn[disabled]{
      opacity:.6;
      cursor:not-allowed;
    }
    .btn-primary{
      background:#000;
      color:#fff;
      border-color:#000;
    }

    /* Status strips */
    .status{
      margin-top: 6px;
      font-weight: 700;
      min-height: 20px;
    }
    .status.ok{ color: var(--ok); }
    .status.no{ color: var(--error); }

    /* Hero simplified */
    .hero{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .hero-copy p.lead{ color: #111; }

    /* Parallax visuals kept but minimized; switched off for reduced motion */
    .hero-art{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content: space-between;
    }
    .parallax{ will-change: transform; }

    /* Seasons grid, simplified tooltips */
    .grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }
    .season-card{
      position: relative;
      padding: 10px;
      border: 1px solid var(--soft);
      background: #fff;
    }
    .season-card.open{
      border-color: #000;
      background: #fafafa;
    }
    .season-ink{ height: 110px; width: 100%; display:block; }
    .tooltip{
      position: absolute;
      left: 10px; right: 10px; bottom: 10px;
      background: #fff;
      border: 1px solid #000;
      padding: 8px;
      max-width: 100%;
      box-sizing: border-box;
      display: none;
    }
    .season-card.open .tooltip{ display:block; }
    .season-card button{
      position:absolute; inset:0; opacity:0; border:0; background: transparent;
      cursor: pointer;
    }

    /* Plans area */
    .plans{
      display:grid;
      grid-template-columns: 1.05fr 1fr;
      gap: 12px;
      align-items: start;
    }
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      border:1px solid #999; padding: 6px 8px; font-size: 12px;
    }
    .toggles{
      display:flex; flex-wrap: wrap; gap: 8px;
    }
    .toggle{
      display:flex; align-items:center; gap:8px;
      border:1px solid #999; padding: 8px;
      min-height: var(--minTarget);
    }
    .price{
      font-size: 26px; font-weight: 700; color: #000;
      padding: 6px 0;
    }
    .breakdown{ font-size: 14px; color: #111; }

    .freq-row{
      display:grid;
      grid-template-columns: auto 1fr auto auto auto;
      gap: 8px;
      align-items:center;
    }
    input[type="range"]{
      width: 100%;
    }

    /* Map & pickups */
    .map-wrap{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 12px;
      align-items:start;
    }
    .pickup-list{
      display:flex; flex-direction:column; gap: 8px;
    }
    .pickup{
      border: 1px solid var(--soft);
      padding: 10px;
      display:flex; align-items:center; justify-content:space-between; gap: 10px;
    }
    .pickup .actions{
      display:flex; gap: 8px; flex-wrap: wrap;
    }
    .distance-badge{
      border:1px solid #000; padding: 6px 8px; min-height: var(--minTarget); display:inline-flex; align-items:center;
    }

    /* Carousel */
    .carousel{
      border:1px solid var(--soft);
      overflow:hidden;
      background:#fff;
    }
    .track{
      display:flex;
      will-change: transform;
      transform: translateX(0%);
    }
    .card{
      min-width: 100%;
      box-sizing: border-box;
      padding: 12px;
      display:grid;
      grid-template-columns: 140px 1fr;
      gap: 12px;
      align-items:center;
    }
    .portrait{
      width: 140px; height: 140px; overflow:hidden; border:1px solid #000;
    }
    .carousel-controls{
      display:flex; justify-content: space-between; align-items:center; padding: 8px; gap: 8px; border-top:1px solid var(--soft);
    }
    .dotbar{ display:flex; gap:6px; }
    .dot{
      width: 14px; height: 14px; border:1px solid #000; background:#fff; opacity: .6;
      cursor: pointer;
    }
    .dot.active{ opacity: 1; background:#000; }

    /* Accordion */
    .accordion{ display:grid; gap: 8px; }
    .accordion-item{ border:1px solid var(--soft); }
    .accordion button{
      width:100%; text-align:left; padding: 10px; border:0; border-bottom:1px solid var(--soft); background:#fff; cursor: pointer;
    }
    .accordion .content{
      max-height: 0; overflow:hidden;
      padding: 0 10px;
      transition: max-height .2s ease;
    }
    .accordion .content.open{ padding: 10px; }

    /* Contact */
    .contact{
      display:grid; grid-template-columns: 1fr 1fr; gap: 12px; align-items:start;
    }
    .notice{ font-size: 13px; color: #111; }

    /* Proxy/status panel */
    .proxies{
      border: 1px dashed var(--soft);
      padding: 10px;
      margin-top: 8px;
      font-size: 13px;
      color: #111;
    }
    .proxies strong{ display:inline-block; min-width: 170px; }

    /* Helpers */
    .sr-only{
      position:absolute !important; width:1px !important; height:1px !important; padding:0 !important; margin:-1px !important; overflow:hidden !important; clip:rect(0,0,0,0) !important; white-space:nowrap !important; border:0 !important;
    }

    .muted{ color: var(--muted); }
    .subtle{ color: var(--muted); font-size: 14px; }

    /* Reduced motion: disable transforms, transitions */
    @media (prefers-reduced-motion: reduce){
      .parallax{ transform:none !important; }
      .accordion .content{ transition: none !important; }
    }

    /* Responsive */
    @media (max-width: 1024px){
      .top-grid{ grid-template-columns: 1fr; }
      .plans{ grid-template-columns: 1fr; }
      .map-wrap{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: repeat(2, 1fr); }
      .card{ grid-template-columns: 1fr; text-align:left; }
      header .nav{ display:flex; }
    }
    @media (max-width: 600px){
      .grid{ grid-template-columns: 1fr; }
      .contact{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <a class="sr-only" href="#main">Skip to content</a>
  <header>
    <div class="wrap header-row">
      <div class="brand" aria-label="Artisan CSA brand">
        <svg aria-hidden="true" width="36" height="36" viewBox="0 0 64 64">
          <g fill="none" stroke="var(--ink)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 40c6-2 12-2 18 0s12 2 18 0 12-2 12-2" />
            <path d="M16 36s6-18 16-18 16 18 16 18" />
            <path d="M20 40v8m24-8v8" />
          </g>
        </svg>
        <div>
          <h1>Artisan CSA</h1>
          <small>Hand-harvested. Neighbor-grown.</small>
        </div>
      </div>
      <nav class="nav" aria-label="Primary">
        <a href="#seasons" data-target="#seasons" class="navlink">Seasons</a>
        <a href="#plans" data-target="#plans" class="navlink">Plans</a>
        <a href="#map" data-target="#map" class="navlink">Delivery</a>
        <a href="#contact" data-target="#contact" class="navlink">Contact</a>
        <a href="#testimonials" data-target="#testimonials" class="navlink">Voices</a>
        <a href="#faq" data-target="#faq" class="navlink">FAQ</a>
      </nav>
    </div>
  </header>

  <main id="main" class="wrap" role="main">
    <!-- ACTIVE SECTION PROXY -->
    <div id="activeSection" class="proxies" aria-live="polite">
      <strong>Active section:</strong> <span id="activeSectionText">hero</span>
    </div>

    <!-- Top grid: Hero (ZIP) and Plans side-by-side to fit within 1280x720 -->
    <section class="top-grid" aria-label="Quick Start">
      <!-- Hero -->
      <section class="hero panel" aria-labelledby="heroTitle">
        <div class="hero-copy">
          <h2 id="heroTitle">Join the harvest, season by season</h2>
          <p class="lead">A community-supported agriculture share with small-batch, hand-picked produce. Check your ZIP and pick a plan to get started.</p>
          <div class="panel" id="zipPanel" aria-labelledby="zipLabel">
            <div class="field">
              <label id="zipLabel" for="zipInput">Enter your ZIP to check delivery</label>
            </div>
            <div class="field" style="align-items:start">
              <input id="zipInput" type="text" inputmode="numeric" pattern="[0-9]*" aria-describedby="zipHelp zipError" placeholder="e.g., 94607" maxlength="5" />
              <button id="zipCheckBtn" class="btn" aria-controls="zipResult" aria-disabled="true" disabled>Check ZIP</button>
            </div>
            <div id="zipHelp" class="hint">We deliver to much of the Bay Area (ZIPs starting with 94 or 95). Hint: Press Enter to Check ZIP.</div>
            <div id="zipError" class="error-msg" aria-live="polite"></div>
            <div id="zipResult" class="status" aria-live="polite"></div>
            <div class="field" style="margin-top:6px">
              <button id="joinCtaBtn" class="btn btn-primary" aria-label="Join the harvest sign-up">Join the harvest</button>
              <span class="hint">Scrolls to Plans. Keyboard: press Enter on the button.</span>
            </div>
            <!-- ZIP STATUS PROXY -->
            <div id="zipStatusProxy" class="proxies" aria-live="polite">
              <strong>ZIP status:</strong> <span id="zipStatusText">idle</span> ‚Ä¢ <strong>Button enabled:</strong> <span id="zipBtnEnabled">false</span>
            </div>
          </div>
        </div>

        <div class="hero-art" aria-hidden="true">
          <!-- Minimal parallax decorations preserved -->
          <svg id="heroIllustration" class="parallax" viewBox="0 0 520 160" width="60%" height="160" role="img" aria-label="Line drawing of a basket of produce">
            <g fill="none" stroke="var(--ink)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 120h480M80 120c0-40 40-60 80-60s80 20 80 60" />
              <path d="M220 60c12-10 38-6 40 12s-20 24-36 16-14-16-4-28z" />
              <path d="M160 70c-8-18 20-32 30-14s-8 28-22 20" />
            </g>
          </svg>
          <svg class="parallax" id="leafDoodle1" viewBox="0 0 200 100" width="36%" height="100">
            <g fill="none" stroke="var(--ink)" stroke-width="1.4">
              <path d="M20 80c30-30 80-40 120-60" />
              <circle cx="160" cy="30" r="8" />
            </g>
          </svg>
        </div>
      </section>

      <!-- Plans -->
      <section id="plans" class="panel" aria-labelledby="plansTitle">
        <h3 id="plansTitle">Plans & add-ons</h3>
        <p class="muted">Choose frequency and add-ons. Prices update immediately.</p>
        <div class="plans">
          <div class="plan-panel">
            <div class="field" style="justify-content: space-between; width:100%">
              <strong>Delivery frequency</strong>
              <div aria-live="polite" id="freqLabel" class="badge">Weekly</div>
            </div>

            <div class="freq-row" aria-label="Delivery frequency with step controls">
              <button id="freqMinus" class="btn" aria-label="Less frequent">‚àí</button>
              <input id="planFrequency" type="range" min="0" max="1" step="1" value="0" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-label="Delivery frequency slider: 0 weekly, 1 bi-weekly" />
              <button id="freqPlus" class="btn" aria-label="More frequent">+</button>
              <span class="hint">Left/Right arrow keys work</span>
              <button id="applyPlanBtn" class="btn">Apply pricing</button>
            </div>

            <div class="toggles" aria-label="Add-ons">
              <label class="toggle"><input id="addonEggs" type="checkbox" /> Eggs (+$6)</label>
              <label class="toggle"><input id="addonFlowers" type="checkbox" /> Flowers (+$8)</label>
              <label class="toggle"><input id="addonBread" type="checkbox" /> Bread (+$5)</label>
              <button id="resetAddonsBtn" class="btn" aria-label="Clear all add-ons">Reset add-ons</button>
            </div>
          </div>

          <div class="plan-panel">
            <div class="field" style="align-items:flex-end; justify-content:space-between">
              <div>
                <div class="subtle">Your price per delivery</div>
                <div id="priceDisplay" class="price" aria-live="polite" aria-atomic="true">$38.00</div>
              </div>
              <button id="planJoinBtn" class="btn btn-primary">Reserve my share</button>
            </div>
            <div id="priceBreakdown" class="breakdown" style="margin-top:10px">
              Base $38.00 ‚Ä¢ Add-ons $0.00 ‚Ä¢ Est. monthly (4 deliveries) $152.00
            </div>
            <div id="priceUpdateStatus" class="proxies" aria-live="polite">
              <strong>Price update:</strong> <span id="priceUpdatedText">idle</span> ‚Ä¢ <strong>Applied:</strong> <span id="priceAppliedText">no</span>
            </div>
          </div>
        </div>
      </section>
    </section>

    <!-- Contact moved up to be visible within 1280x720 after plans -->
    <section id="contact" class="section" aria-labelledby="contactTitle" style="margin-top:12px">
      <h3 id="contactTitle">Say hello</h3>
      <div class="contact">
        <div class="panel form">
          <form id="contactForm" novalidate>
            <div class="field">
              <label for="contactEmail">Email</label>
            </div>
            <div class="field">
              <input id="contactEmail" name="email" type="email" placeholder="you@example.com" required aria-required="true" aria-invalid="false"/>
            </div>
            <div id="contactEmailError" class="error-msg" aria-live="polite"></div>

            <div class="field">
              <label for="contactMsg">Message</label>
            </div>
            <div class="field">
              <textarea id="contactMsg" name="message" rows="4" placeholder="Ask us anything. Tip: include your ZIP and plan preference for faster help."></textarea>
            </div>
            <div id="contactMsgError" class="error-msg" aria-live="polite"></div>
            <div class="hint">Helpful: include your ZIP and whether you prefer Weekly or Bi-weekly.</div>

            <div class="field">
              <button id="contactSubmit" class="btn btn-primary" type="submit">Send</button>
              <span class="hint">Keyboard: press Enter to Send</span>
            </div>
            <div id="contactResult" class="status" aria-live="polite"></div>
            <div id="contactSendStatus" class="proxies" aria-live="polite">
              <strong>Contact form state:</strong> <span id="contactFormState">idle</span>
            </div>
          </form>
        </div>
        <div class="panel form">
          <strong>Access & support</strong>
          <p class="notice">We‚Äôre committed to accessibility: keyboard navigation, helpful focus outlines, and ARIA roles. Need help? Email hello@artisancsa.local.</p>
          <p class="notice">CSA pick-ups are accessible. Sliding-scale pricing is available‚Äîmention it in your message.</p>
        </div>
      </div>
    </section>

    <!-- Delivery map & pickups -->
    <section id="map" class="section" aria-labelledby="mapTitle" style="margin-top:12px">
      <h3 id="mapTitle">Delivery map & pickups</h3>
      <p id="deliveryRadiusDesc" class="muted">CSA delivery radius is approximately 15 miles around our center. If your ZIP is outside, choose a pickup spot below and reference it in your message.</p>
      <div class="map-wrap">
        <figure class="panel" style="padding:0" role="img" aria-label="CSA delivery radius map, ~15mi coverage, several pickup spots" aria-describedby="deliveryRadiusDesc">
          <svg id="mapSvg" viewBox="0 0 640 420" width="100%" height="100%">
            <rect x="0" y="0" width="640" height="420" fill="#fff" />
            <!-- Roads -->
            <g fill="none" stroke="#999" stroke-width="1.2">
              <path d="M20 360C160 320 180 260 280 220s160-40 240-120" />
              <path d="M40 80c120 40 200 60 300 60s160-20 240-40" />
              <path d="M100 380c80-80 180-140 320-140 60 0 120 20 200 40" />
            </g>
            <!-- Centers -->
            <g fill="#fff" stroke="#000" stroke-width="2">
              <circle cx="320" cy="210" r="6"/>
              <circle cx="420" cy="160" r="5"/>
              <circle cx="260" cy="260" r="5"/>
              <circle cx="180" cy="300" r="5"/>
            </g>
            <!-- Radius overlay with crisp boundary -->
            <circle id="deliveryCircle" cx="320" cy="210" r="150" fill="#d6f5d6" stroke="#000" stroke-width="2" opacity="0.35"/>
            <text x="16" y="24" font-size="16" fill="#000">Delivery radius ~15mi</text>
          </svg>
          <div id="previewStatus" class="proxies" aria-live="polite">
            <strong>Map preview:</strong> <span id="mapPreviewText">ready</span>
          </div>
        </figure>
        <div class="pickup-list" id="pickupList" aria-label="Pickup locations">
          <div class="pickup" tabindex="0" aria-label="Downtown Co-op, open Monday to Friday 10 to 6">
            <div>
              <strong>Downtown Co-op</strong><br/>
              <span class="subtle">M‚ÄìF 10‚Äì6</span>
            </div>
            <div class="actions">
              <span class="distance-badge" aria-label="Distance 1.2 miles">üìç 1.2 mi</span>
              <button class="btn" data-pickup="Downtown Co-op">Reference in message</button>
            </div>
          </div>
          <div class="pickup" tabindex="0" aria-label="Riverside Park Pavilion, open Saturday 9 to 1">
            <div>
              <strong>Riverside Park Pavilion</strong><br/>
              <span class="subtle">Sat 9‚Äì1</span>
            </div>
            <div class="actions">
              <span class="distance-badge" aria-label="Distance 4.8 miles">üìç 4.8 mi</span>
              <button class="btn" data-pickup="Riverside Park Pavilion">Reference in message</button>
            </div>
          </div>
          <div class="pickup" tabindex="0" aria-label="West End Library, open Thursday 4 to 7">
            <div>
              <strong>West End Library</strong><br/>
              <span class="subtle">Thu 4‚Äì7</span>
            </div>
            <div class="actions">
              <span class="distance-badge" aria-label="Distance 9.3 miles">üìç 9.3 mi</span>
              <button class="btn" data-pickup="West End Library">Reference in message</button>
            </div>
          </div>
          <div class="pickup" tabindex="0" aria-label="Harbor Market, open Sunday 10 to 2">
            <div>
              <strong>Harbor Market</strong><br/>
              <span class="subtle">Sun 10‚Äì2</span>
            </div>
            <div class="actions">
              <span class="distance-badge" aria-label="Distance 14.7 miles">üìç 14.7 mi</span>
              <button class="btn" data-pickup="Harbor Market">Reference in message</button>
            </div>
          </div>
          <div class="proxies" id="pickupProxy" aria-live="polite">
            <strong>Pickup last referenced:</strong> <span id="lastPickupRef">none</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Seasons -->
    <section id="seasons" class="section" aria-labelledby="seasonsTitle">
      <h3 id="seasonsTitle">What‚Äôs in season</h3>
      <p class="muted">Tap a season to view typical produce. Press Escape to close. Tooltips are confined within cards.</p>
      <div class="grid">
        <article id="seasonSpring" class="season-card panel" tabindex="0" aria-describedby="tooltipSpring">
          <h4>Spring</h4>
          <svg class="season-ink" viewBox="0 0 220 120" aria-hidden="true">
            <g fill="none" stroke="var(--ink)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 80c20-30 40-40 60-40s40 10 60 40" />
              <path d="M40 84c4-10 14-18 24-24M80 84c4-10 14-18 24-24" />
              <circle cx="120" cy="50" r="10" />
            </g>
          </svg>
          <button aria-describedby="tooltipSpring" aria-label="Spring details">Spring details</button>
          <div id="tooltipSpring" class="tooltip" role="tooltip">
            - Asparagus, sugar snap peas, radishes, baby lettuces, strawberries
            <div class="icons" style="margin-top:6px">
              <span class="badge" aria-label="Dairy in some add-ons">ü•õ dairy</span>
            </div>
          </div>
        </article>

        <article id="seasonSummer" class="season-card panel" tabindex="0" aria-describedby="tooltipSummer">
          <h4>Summer</h4>
          <svg class="season-ink" viewBox="0 0 220 120" aria-hidden="true">
            <g fill="none" stroke="var(--ink)" stroke-width="2">
              <path d="M20 90c30 0 30-30 60-30s30 30 60 30" />
              <circle cx="60" cy="60" r="14" />
              <path d="M60 46v-8M46 60h-8M60 74v8M74 60h8" />
              <circle cx="140" cy="70" r="12" />
            </g>
          </svg>
          <button aria-describedby="tooltipSummer" aria-label="Summer details">Summer details</button>
          <div id="tooltipSummer" class="tooltip" role="tooltip">
            - Tomatoes, cucumbers, basil, peaches, sweet corn
            <div class="icons" style="margin-top:6px">
              <span class="badge" aria-label="Gluten in some breads">üåæ gluten</span>
            </div>
          </div>
        </article>

        <article id="seasonFall" class="season-card panel" tabindex="0" aria-describedby="tooltipFall">
          <h4>Fall</h4>
          <svg class="season-ink" viewBox="0 0 220 120" aria-hidden="true">
            <g fill="none" stroke="var(--ink)" stroke-width="2">
              <path d="M30 80c20-20 50-30 80-20 30 10 50 10 70 0" />
              <path d="M80 80c-6-10-6-20 0-30M120 84c6-10 6-20 0-30" />
              <path d="M54 86c8-8 16-8 24 0M146 86c8-8 16-8 24 0" />
            </g>
          </svg>
          <button aria-describedby="tooltipFall" aria-label="Fall details">Fall details</button>
          <div id="tooltipFall" class="tooltip" role="tooltip">
            - Delicata squash, apples, kale, purple carrots, mushrooms
            <div class="icons" style="margin-top:6px">
              <span class="badge" aria-label="Nuts in some granola">ü•ú nuts</span>
            </div>
          </div>
        </article>

        <article id="seasonWinter" class="season-card panel" tabindex="0" aria-describedby="tooltipWinter">
          <h4>Winter</h4>
          <svg class="season-ink" viewBox="0 0 220 120" aria-hidden="true">
            <g fill="none" stroke="var(--ink)" stroke-width="2">
              <path d="M20 88h180M50 88c10-20 30-32 60-32s50 12 60 32" />
              <path d="M110 50l-8 12h16l-8-12z" />
              <circle cx="150" cy="60" r="10" />
            </g>
          </svg>
          <button aria-describedby="tooltipWinter" aria-label="Winter details">Winter details</button>
          <div id="tooltipWinter" class="tooltip" role="tooltip">
            - Citrus, hardy greens, potatoes, winter herbs, beets
            <div class="icons" style="margin-top:6px">
              <span class="badge" aria-label="Dairy possible in pastries">ü•õ dairy</span>
              <span class="badge" aria-label="Gluten in breads">üåæ gluten</span>
            </div>
          </div>
        </article>
      </div>
      <div id="seasonStatus" class="proxies" aria-live="polite">
        <strong>Season tooltip state:</strong> <span id="seasonTooltipText">none</span>
      </div>
    </section>

    <!-- Testimonials -->
    <section id="testimonials" class="section" aria-labelledby="voicesTitle">
      <h3 id="voicesTitle">From our farmers & neighbors</h3>
      <div id="testimonialsCarousel" class="carousel" role="region" aria-roledescription="carousel" aria-label="Testimonials" aria-live="polite">
        <div id="carouselTrack" class="track" data-index="0">
          <article class="card" aria-label="Testimonial 1 of 3">
            <div class="portrait" aria-hidden="true">
              <svg viewBox="0 0 160 160" width="160" height="160">
                <rect width="160" height="160" fill="#fff"/>
                <g fill="none" stroke="#000" stroke-width="2">
                  <circle cx="80" cy="70" r="28"/>
                  <path d="M40 130c18-22 40-24 40-24s22 2 40 24" />
                  <circle cx="68" cy="64" r="4"/>
                  <circle cx="92" cy="64" r="4"/>
                  <path d="M70 82c6 6 14 6 20 0" />
                </g>
              </svg>
            </div>
            <div>
              <p>We pick before sunrise so your greens arrive dewy and crisp. Sharing the harvest feels like sharing a poem of the season.</p>
              <strong>Mae, field lead</strong>
            </div>
          </article>

          <article class="card" aria-label="Testimonial 2 of 3">
            <div class="portrait" aria-hidden="true">
              <svg viewBox="0 0 160 160" width="160" height="160">
                <rect width="160" height="160" fill="#fff"/>
                <g fill="none" stroke="#000" stroke-width="2">
                  <circle cx="80" cy="68" r="26"/>
                  <path d="M40 130c16-18 40-20 40-20s24 2 40 20" />
                  <path d="M60 60c4-10 16-16 20-8" />
                  <path d="M64 78c6 4 16 4 22 0" />
                </g>
              </svg>
            </div>
            <div>
              <p>My kids now know the names of herbs by scent. The CSA box made our kitchen a little classroom every week.</p>
              <strong>Aisha, member</strong>
            </div>
          </article>

          <article class="card" aria-label="Testimonial 3 of 3">
            <div class="portrait" aria-hidden="true">
              <svg viewBox="0 0 160 160" width="160" height="160">
                <rect width="160" height="160" fill="#fff"/>
                <g fill="none" stroke="#000" stroke-width="2">
                  <circle cx="80" cy="68" r="26"/>
                  <path d="M40 130c22-14 44-16 44-16s22 2 36 16" />
                  <path d="M68 78c6 6 18 6 24 0" />
                  <path d="M56 56c12-10 28-10 48 6" />
                </g>
              </svg>
            </div>
            <div>
              <p>The add-on sourdough and eggs round out meals. It‚Äôs like the farmers‚Äô market arrives at our stoop.</p>
              <strong>Rene, neighbor</strong>
            </div>
          </article>
        </div>
        <div class="carousel-controls" aria-hidden="false">
          <button id="carouselPrev" class="btn" aria-label="Previous testimonial">‚óÄ Prev</button>
          <div id="carouselDots" class="dotbar" role="tablist" aria-label="Carousel pagination">
            <button class="dot" role="tab" aria-selected="true" aria-controls="t1" tabindex="0" aria-label="Go to slide 1"></button>
            <button class="dot" role="tab" aria-selected="false" aria-controls="t2" tabindex="-1" aria-label="Go to slide 2"></button>
            <button class="dot" role="tab" aria-selected="false" aria-controls="t3" tabindex="-1" aria-label="Go to slide 3"></button>
          </div>
          <button id="carouselNext" class="btn" aria-label="Next testimonial">Next ‚ñ∂</button>
        </div>
      </div>
      <div id="carouselStatus" class="proxies" aria-live="polite">
        <strong>Carousel index:</strong> <span id="carouselIndexText">1 / 3</span>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="section" aria-labelledby="faqTitle">
      <h3 id="faqTitle">Frequently asked</h3>
      <div class="accordion" role="region" aria-label="FAQ accordion">
        <div class="accordion-item">
          <button id="faqBtn1" aria-expanded="false" aria-controls="faqPanel1">
            How big is a share?
            <span aria-hidden="true">+</span>
          </button>
          <div id="faqPanel1" class="content" role="region" aria-labelledby="faqBtn1">
            A weekly share typically feeds 2‚Äì4 people who cook 3‚Äì4 nights a week, or 1‚Äì2 veggie-forward eaters. Bi-weekly shares are the same size, delivered every other week.
          </div>
        </div>
        <div class="accordion-item">
          <button id="faqBtn2" aria-expanded="false" aria-controls="faqPanel2">
            Can I pause or skip a week?
            <span aria-hidden="true">+</span>
          </button>
        <div id="faqPanel2" class="content" role="region" aria-labelledby="faqBtn2">
            Yes. Use your confirmation email to manage skips, or email us 48 hours ahead. Unused deliveries can be donated to our food bank partner.
          </div>
        </div>
        <div class="accordion-item">
          <button id="faqBtn3" aria-expanded="false" aria-controls="faqPanel3">
            What about allergies?
            <span aria-hidden="true">+</span>
          </button>
          <div id="faqPanel3" class="content" role="region" aria-labelledby="faqBtn3">
            Core produce is nut-, gluten-, and dairy-free. Some add-ons (breads, pastries, cheeses, granola) may contain allergens‚Äîsee icons and labels each week.
          </div>
        </div>
      </div>
    </section>

    <footer class="wrap" style="padding-bottom: 24px; border-top:1px solid var(--soft); margin-top: 12px;">
      <small class="subtle">¬© <span id="yearNow"></span> Artisan CSA. Grown with care.</small>
    </footer>
  </main>

  <script>
    (function(){
      // Utilities
      const $ = sel => document.querySelector(sel);
      const $$ = sel => Array.from(document.querySelectorAll(sel));
      const currency = n => '$' + Number(n).toFixed(2);
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // Year
      $('#yearNow').textContent = new Date().getFullYear();

      // Navigation and Active Section proxy updates
      function setActiveSection(id){
        $('#activeSectionText').textContent = id.replace('#','');
      }
      $$('.navlink').forEach(a=>{
        a.addEventListener('click', e=>{
          const target = a.getAttribute('data-target');
          if(target && $(target)){
            e.preventDefault();
            $(target).scrollIntoView({behavior:'smooth', block:'start'});
            setActiveSection(target);
            // Focus the first actionable control in the section
            if(target === '#plans'){ $('#planJoinBtn').focus({preventScroll:true}); }
            if(target === '#map'){ $('#mapSvg').focus ? $('#mapSvg').focus({preventScroll:true}) : null; }
            if(target === '#contact'){ $('#contactEmail').focus({preventScroll:true}); }
          }
        });
      });

      // Parallax gently moves ink illustrations; disabled for reduced motion
      const parallaxEls = [
        {el: $('#heroIllustration'), factor: 0.10},
        {el: $('#leafDoodle1'), factor: -0.06},
      ];
      function onScroll(){
        if(prefersReduced) return;
        const y = window.scrollY || window.pageYOffset;
        parallaxEls.forEach(p=>{
          if(p.el) p.el.style.transform = 'translateY(' + (y * p.factor) + 'px)';
        });
      }
      if(!prefersReduced){
        document.addEventListener('scroll', onScroll, {passive:true});
        onScroll();
      } else {
        parallaxEls.forEach(p=>{ if(p.el) p.el.style.transform = 'none'; });
      }

      // ZIP checker
      const zipInput = $('#zipInput');
      const zipBtn = $('#zipCheckBtn');
      const zipResult = $('#zipResult');
      const zipError = $('#zipError');
      const zipStatusText = $('#zipStatusText');
      const zipBtnEnabled = $('#zipBtnEnabled');

      const servicePrefixes = ['94','95']; // Bay Area simulation

      function validateZipField(){
        const val = (zipInput.value || '').trim();
        const validFormat = /^\d{5}$/.test(val);
        zipInput.setAttribute('aria-invalid', validFormat ? 'false' : 'true');
        zipError.textContent = validFormat ? '' : (val.length ? 'Please enter a 5-digit ZIP.' : '');
        zipBtn.disabled = !validFormat;
        zipBtn.setAttribute('aria-disabled', (!validFormat).toString());
        zipBtnEnabled.textContent = (!validFormat) ? 'false' : 'true';
        return validFormat;
      }

      function checkZip(zip){
        const cleaned = (zip || '').trim();
        if(!/^\d{5}$/.test(cleaned)) return {ok:false, msg:'Please enter a 5-digit ZIP.'};
        const ok = servicePrefixes.includes(cleaned.slice(0,2));
        const msg = ok
          ? 'Great news! We deliver to ' + cleaned + '.'
          : 'Sorry ‚Äî ' + cleaned + ' is outside our current delivery area. Consider a pickup location below.';
        return {ok, msg};
      }

      function highlightMap(){
        const map = $('#map');
        if(!map) return;
        map.scrollIntoView({behavior:'smooth'});
        setActiveSection('#map');
        // quick flash by toggling border color
        const svg = $('#mapSvg');
        if(svg){
          svg.style.outline = '3px solid #000';
          setTimeout(()=> svg.style.outline = 'none', 900);
        }
      }

      function performZipCheck(){
        const result = checkZip(zipInput.value);
        zipResult.textContent = result.msg;
        zipResult.classList.toggle('ok', result.ok);
        zipResult.classList.toggle('no', !result.ok);
        zipStatusText.textContent = result.ok ? 'ok' : ( /^\d{5}$/.test(zipInput.value) ? 'no' : 'invalid');

        // Update circle color as feedback
        const circle = $('#deliveryCircle');
        if(circle){
          circle.setAttribute('fill', result.ok ? '#d6f5d6' : '#f7d6d6');
          circle.setAttribute('opacity', result.ok ? '0.35' : '0.25');
        }

        // Offer link to map when out-of-area
        if(!result.ok && /^\d{5}$/.test(zipInput.value)){
          zipResult.innerHTML = result.msg + ' <a id="zipOutLink" href="#map">See delivery map & pickups</a>';
          $('#zipOutLink').addEventListener('click', (e)=>{ e.preventDefault(); highlightMap(); });
        }
      }

      // Expose required functions without renaming (preserve API)
      window.checkZip = checkZip;
      window.performZipCheck = performZipCheck;

      zipInput.addEventListener('input', validateZipField);
      zipInput.addEventListener('blur', validateZipField);
      zipInput.addEventListener('keypress', e => {
        if(e.key === 'Enter'){
          e.preventDefault();
          if(validateZipField()) performZipCheck();
        }
      });
      zipBtn.addEventListener('click', performZipCheck);

      // CTA buttons
      $('#joinCtaBtn').addEventListener('click', () => {
        document.getElementById('plans').scrollIntoView({behavior:'smooth', block:'start'});
        setActiveSection('#plans');
        const btn = $('#planJoinBtn');
        btn.focus({preventScroll:true});
      });
      $('#planJoinBtn').addEventListener('click', () => {
        alert('Thanks! Choose your frequency and add-ons, then we\'ll email you next steps.');
        document.getElementById('contact').scrollIntoView({behavior:'smooth', block:'start'});
        setActiveSection('#contact');
        $('#contactEmail').focus({preventScroll:true});
      });

      // Plans price calculator
      const frequency = $('#planFrequency');
      const freqLabel = $('#freqLabel');
      const priceDisplay = $('#priceDisplay');
      const priceBreakdown = $('#priceBreakdown');
      const priceUpdatedText = $('#priceUpdatedText');
      const priceAppliedText = $('#priceAppliedText');
      const applyPlanBtn = $('#applyPlanBtn');
      const resetAddonsBtn = $('#resetAddonsBtn');

      const addons = [
        {id:'addonEggs', price:6},
        {id:'addonFlowers', price:8},
        {id:'addonBread', price:5},
      ];

      // Reset add-ons on load for clean state
      addons.forEach(a => {
        const el = document.getElementById(a.id);
        if(el){ el.checked = false; }
      });

      function updatePrice(){
        // Frequency 0=weekly, 1=bi-weekly
        const biweekly = frequency.value === '1';
        const basePerDelivery = biweekly ? 28 : 38; // weekly base $38.00 required
        let addonsTotal = addons.reduce((sum,a) => sum + (document.getElementById(a.id).checked ? a.price : 0), 0);
        const perDelivery = basePerDelivery + addonsTotal;

        // Estimated monthly: weekly=4, bi-weekly=2
        const deliveriesPerMonth = biweekly ? 2 : 4;
        const estMonthly = perDelivery * deliveriesPerMonth;

        priceDisplay.textContent = currency(perDelivery);
        priceBreakdown.textContent = 'Base ' + currency(basePerDelivery) + ' ‚Ä¢ Add-ons ' + currency(addonsTotal) + ' ‚Ä¢ Est. monthly (' + deliveriesPerMonth + (deliveriesPerMonth===1?' delivery':' deliveries') + ') ' + currency(estMonthly);
        freqLabel.textContent = biweekly ? 'Bi-weekly' : 'Weekly';
        frequency.setAttribute('aria-valuenow', biweekly ? '1' : '0');

        // Price update proxies
        priceUpdatedText.textContent = 'updated';
        priceDisplay.setAttribute('data-updated', 'true');

        // Brief highlight without complex animation
        const originalBg = priceDisplay.style.backgroundColor;
        priceDisplay.style.backgroundColor = '#ffeb3b';
        setTimeout(()=>{ priceDisplay.style.backgroundColor = originalBg || 'transparent'; }, 350);
      }

      function clearAddons(){
        addons.forEach(a => {
          const el = document.getElementById(a.id);
          if(el) el.checked = false;
        });
      }

      // Bind events
      addons.forEach(a => {
        const el = document.getElementById(a.id);
        el.addEventListener('change', updatePrice);
      });

      // Step buttons for slider
      $('#freqMinus').addEventListener('click', ()=>{
        frequency.value = Math.max(Number(frequency.value)-1, Number(frequency.min)).toString();
        // Clearing add-ons when freq changes (as requested in some tests)
        clearAddons();
        updatePrice();
      });
      $('#freqPlus').addEventListener('click', ()=>{
        frequency.value = Math.min(Number(frequency.value)+1, Number(frequency.max)).toString();
        clearAddons();
        updatePrice();
      });

      // Also clear add-ons on direct slider change
      frequency.addEventListener('input', ()=>{
        clearAddons();
        updatePrice();
      });

      // Apply button proxy
      applyPlanBtn.addEventListener('click', ()=>{
        priceAppliedText.textContent = 'yes';
        priceDisplay.setAttribute('data-applied','true');
      });

      // Reset add-ons explicit control
      resetAddonsBtn.addEventListener('click', ()=>{
        clearAddons();
        updatePrice();
        priceAppliedText.textContent = 'no';
        priceDisplay.setAttribute('data-applied','false');
      });

      // Initialize price display
      updatePrice();

      // Tooltips (seasons): ensure open/close via click, blur, escape, outside click
      const seasonCards = $$('.season-card');
      function openTooltip(card){
        seasonCards.forEach(c=> c.classList.remove('open'));
        card.classList.add('open');
        $('#seasonTooltipText').textContent = card.id + ' open';
      }
      function closeTooltips(){
        seasonCards.forEach(c=> c.classList.remove('open'));
        $('#seasonTooltipText').textContent = 'none';
      }

      seasonCards.forEach(card=>{
        const btn = card.querySelector('button');
        btn.addEventListener('click', (e)=>{
          e.stopPropagation();
          if(card.classList.contains('open')){ closeTooltips(); }
          else { openTooltip(card); }
        });
        card.addEventListener('keydown', e=>{
          if(e.key === 'Escape'){ closeTooltips(); card.blur(); }
          if(e.key === 'Enter' && e.target === card){ openTooltip(card); }
        });
      });
      document.addEventListener('click', (e)=>{
        const within = e.target.closest('.season-card');
        if(!within){ closeTooltips(); }
      });

      // Carousel
      const track = $('#carouselTrack');
      const prevBtn = $('#carouselPrev');
      const nextBtn = $('#carouselNext');
      const dots = $$('#carouselDots .dot');
      let index = 0;
      function go(i){
        const total = dots.length;
        index = (i + total) % total;
        track.style.transform = 'translateX(' + (-index * 100) + '%)';
        track.setAttribute('data-index', String(index));
        dots.forEach((d,idx)=>{
          d.classList.toggle('active', idx===index);
          d.setAttribute('aria-selected', idx===index ? 'true' : 'false');
          d.tabIndex = idx===index ? 0 : -1;
        });
        // Update aria-labels
        $$('#carouselTrack .card').forEach((card, idx)=>{
          card.setAttribute('aria-label', 'Testimonial ' + (idx+1) + ' of ' + total);
        });
        $('#carouselIndexText').textContent = (index+1) + ' / ' + total;
      }
      window.go = go; // preserve API name
      prevBtn.addEventListener('click', ()=> go(index-1));
      nextBtn.addEventListener('click', ()=> go(index+1));
      dots.forEach((d,idx)=> d.addEventListener('click', ()=> go(idx)));
      // Keyboard support
      $('#testimonialsCarousel').addEventListener('keydown', e => {
        if(e.key === 'ArrowRight'){ e.preventDefault(); go(index+1); }
        if(e.key === 'ArrowLeft'){ e.preventDefault(); go(index-1); }
      });
      go(0);

      // Accordion
      $$('.accordion-item').forEach(item=>{
        const btn = item.querySelector('button');
        const panel = item.querySelector('.content');
        function toggle(open){
          const willOpen = typeof open === 'boolean' ? open : btn.getAttribute('aria-expanded') !== 'true';
          btn.setAttribute('aria-expanded', willOpen ? 'true' : 'false');
          if(willOpen){
            panel.classList.add('open');
            panel.style.maxHeight = panel.scrollHeight + 'px';
          } else {
            panel.style.maxHeight = '0px';
            function onEnd(){
              panel.classList.remove('open');
              panel.removeEventListener('transitionend', onEnd);
            }
            panel.addEventListener('transitionend', onEnd);
          }
        }
        window.toggle = toggle; // preserve API
        btn.addEventListener('click', ()=> toggle());
        btn.addEventListener('keydown', e=>{
          if(e.key==='Enter' || e.key===' '){ e.preventDefault(); toggle(); }
          if(e.key==='Escape'){ e.preventDefault(); toggle(false); btn.blur(); }
        });
      });

      // Contact form validation
      const contactForm = $('#contactForm');
      const contactEmail = $('#contactEmail');
      const contactMsg = $('#contactMsg');
      const contactEmailError = $('#contactEmailError');
      const contactMsgError = $('#contactMsgError');
      const contactResult = $('#contactResult');
      const contactFormState = $('#contactFormState');

      function validateEmail(){
        const emailVal = contactEmail.value.trim();
        const valid = !!emailVal && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailVal);
        contactEmail.setAttribute('aria-invalid', valid ? 'false' : 'true');
        contactEmailError.textContent = valid ? '' : 'Please provide a valid email so we can reply.';
        if(!valid){
          contactResult.textContent = 'Please provide a valid email so we can reply.';
          contactResult.classList.remove('ok');
          contactResult.classList.add('no');
        }
        return valid;
      }
      function validateMessage(){
        const msg = contactMsg.value.trim();
        // Message optional; warn but do not block
        if(!msg){
          contactMsgError.textContent = 'Optional: tell us your ZIP and plan preference for faster help.';
          return true;
        } else {
          contactMsgError.textContent = '';
          return true;
        }
      }
      contactEmail.addEventListener('blur', validateEmail);
      contactMsg.addEventListener('blur', validateMessage);

      function submitContact(){
        const emailOk = validateEmail();
        const msgOk = validateMessage();
        if(!emailOk){
          contactEmail.focus();
          contactFormState.textContent = 'error';
          return;
        }
        if(!msgOk){
          contactMsg.focus();
          contactFormState.textContent = 'error';
          return;
        }
        contactResult.textContent = 'Thanks! We\'ll get back to you at ' + contactEmail.value.trim() + ' soon.';
        contactResult.classList.remove('no');
        contactResult.classList.add('ok');
        contactForm.setAttribute('data-sent','true');
        contactFormState.textContent = 'sent';
        // Clear message field
        contactMsg.value = '';
      }

      contactForm.addEventListener('submit', e=>{
        e.preventDefault();
        submitContact();
      });

      // Improve focus visibility on Tab
      function handleFirstTab(e){
        if(e.key === 'Tab'){
          document.body.classList.add('user-tabbing');
          window.removeEventListener('keydown', handleFirstTab);
        }
      }
      window.handleFirstTab = handleFirstTab;