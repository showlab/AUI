<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Journey Flow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #7f8c8d;
            max-width: 600px;
            margin: 0 auto;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .toolbar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: #ecf0f1;
            color: #2c3e50;
        }

        .btn-secondary:hover {
            background: #d5dbdb;
        }

        .canvas-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            min-height: 500px;
            position: relative;
            overflow: hidden;
        }

        #journeyCanvas {
            width: 100%;
            height: 500px;
            background: #f8f9fa;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .stage {
            position: absolute;
            min-width: 180px;
            min-height: 80px;
            background: white;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            cursor: move;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 10;
        }

        .stage:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .stage-header {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .stage-content {
            font-size: 0.9rem;
            color: #7f8c8d;
            line-height: 1.4;
        }

        .connection {
            position: absolute;
            pointer-events: none;
            z-index: 1;
        }

        .connection-line {
            stroke: #3498db;
            stroke-width: 3;
            marker-end: url(#arrowhead);
        }

        .connection-label {
            fill: #3498db;
            font-size: 12px;
            font-weight: 600;
        }

        .controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
        }

        .control-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .control-btn:hover {
            background: #2980b9;
        }

        .instructions {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .instructions h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .instructions ul {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .dragging {
            opacity: 0.7;
            z-index: 100;
        }

        .connecting {
            z-index: 20;
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            h1 {
                font-size: 2rem;
            }
        }

        /* Hidden elements for SVG definitions */
        svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .delete-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 20px;
            height: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .delete-btn:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 id="appTitle">Customer Journey Flow</h1>
            <p class="subtitle">Visualize and customize your customer's journey from awareness to purchase</p>
        </header>

        <div class="app-container">
            <div class="toolbar">
                <button id="addStageBtn" class="btn btn-primary">
                    <span>+</span> Add New Stage
                </button>
                <button id="resetBtn" class="btn btn-secondary">
                    Reset Flow
                </button>
            </div>

            <div class="canvas-container">
                <div id="journeyCanvas"></div>
                <div class="controls">
                    <button id="connectBtn" class="control-btn" title="Connect Stages">→</button>
                    <button id="clearConnectionsBtn" class="control-btn" title="Clear Connections">×</button>
                </div>
            </div>

            <div class="instructions">
                <h2>How to Use</h2>
                <ul>
                    <li><strong>Add stages:</strong> Click "Add New Stage" to create new journey steps</li>
                    <li><strong>Move stages:</strong> Drag and drop stages to reposition them</li>
                    <li><strong>Create connections:</strong> Click the arrow button, then select two stages to connect</li>
                    <li><strong>Edit stages:</strong> Double-click any stage to edit its content</li>
                    <li><strong>Delete stages:</strong> Hover over a stage and click the red X button</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const canvas = document.getElementById('journeyCanvas');
            const addStageBtn = document.getElementById('addStageBtn');
            const resetBtn = document.getElementById('resetBtn');
            const connectBtn = document.getElementById('connectBtn');
            const clearConnectionsBtn = document.getElementById('clearConnectionsBtn');

            // State management
            let stages = [];
            let connections = [];
            let selectedStages = [];
            let isConnecting = false;
            let nextId = 1;

            // Initialize SVG for connections
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            canvas.appendChild(svg);

            // Arrow marker definition
            const defs = document.createElementNS(svgNS, "defs");
            const marker = document.createElementNS(svgNS, "marker");
            marker.setAttribute("id", "arrowhead");
            marker.setAttribute("markerWidth", "10");
            marker.setAttribute("markerHeight", "7");
            marker.setAttribute("refX", "0");
            marker.setAttribute("refY", "3.5");
            marker.setAttribute("orient", "auto");
            
            const polygon = document.createElementNS(svgNS, "polygon");
            polygon.setAttribute("points", "0 0, 10 3.5, 0 7");
            polygon.setAttribute("fill", "#3498db");
            
            marker.appendChild(polygon);
            defs.appendChild(marker);
            svg.appendChild(defs);

            // Stage templates
            const stageTemplates = [
                { title: "Awareness", content: "Customer discovers product/service" },
                { title: "Interest", content: "Customer shows interest in details" },
                { title: "Consideration", content: "Customer evaluates options" },
                { title: "Purchase", content: "Customer makes purchase decision" },
                { title: "Retention", content: "Customer continues engagement" }
            ];

            // Initialize with sample stages
            function init() {
                resetFlow();
                render();
            }

            // Add a new stage
            function addStage(title = "New Stage", content = "Stage description") {
                const stage = {
                    id: nextId++,
                    title: title,
                    content: content,
                    x: Math.random() * 300 + 50,
                    y: Math.random() * 300 + 50
                };
                stages.push(stage);
                render();
            }

            // Remove a stage
            function removeStage(id) {
                stages = stages.filter(stage => stage.id !== id);
                connections = connections.filter(conn => 
                    conn.from !== id && conn.to !== id
                );
                render();
            }

            // Update stage content
            function updateStage(id, title, content) {
                const stage = stages.find(s => s.id === id);
                if (stage) {
                    stage.title = title;
                    stage.content = content;
                    render();
                }
            }

            // Connect two stages
            function connectStages(fromId, toId) {
                // Prevent self-connections
                if (fromId === toId) return;
                
                // Check if connection already exists
                const existing = connections.find(conn => 
                    conn.from === fromId && conn.to === toId
                );
                if (!existing) {
                    connections.push({
                        from: fromId,
                        to: toId,
                        label: "Next"
                    });
                    render();
                }
            }

            // Clear all connections
            function clearConnections() {
                connections = [];
                render();
            }

            // Reset flow to initial state
            function resetFlow() {
                stages = [];
                connections = [];
                selectedStages = [];
                isConnecting = false;
                nextId = 1;
                
                // Add initial stages
                stageTemplates.forEach(template => {
                    addStage(template.title, template.content);
                });
            }

            // Render all elements
            function render() {
                // Clear canvas
                while (canvas.firstChild) {
                    if (canvas.firstChild !== svg) {
                        canvas.removeChild(canvas.firstChild);
                    }
                }

                // Render connections
                connections.forEach(conn => {
                    const fromStage = stages.find(s => s.id === conn.from);
                    const toStage = stages.find(s => s.id === conn.to);
                    
                    if (fromStage && toStage) {
                        const line = document.createElementNS(svgNS, "line");
                        line.setAttribute("x1", fromStage.x + 90);
                        line.setAttribute("y1", fromStage.y + 40);
                        line.setAttribute("x2", toStage.x + 90);
                        line.setAttribute("y2", toStage.y + 40);
                        line.setAttribute("class", "connection-line");
                        
                        const label = document.createElementNS(svgNS, "text");
                        label.setAttribute("x", (fromStage.x + toStage.x) / 2 + 90);
                        label.setAttribute("y", (fromStage.y + toStage.y) / 2 + 40);
                        label.setAttribute("class", "connection-label");
                        label.textContent = conn.label;
                        
                        svg.appendChild(line);
                        svg.appendChild(label);
                    }
                });

                // Render stages
                stages.forEach(stage => {
                    const stageElement = document.createElement('div');
                    stageElement.className = 'stage';
                    stageElement.id = `stage-${stage.id}`;
                    stageElement.style.left = `${stage.x}px`;
                    stageElement.style.top = `${stage.y}px`;
                    
                    stageElement.innerHTML = `
                        <div class="stage-header">${stage.title}</div>
                        <div class="stage-content">${stage.content}</div>
                        <button class="delete-btn" data-id="${stage.id}">×</button>
                    `;
                    
                    // Add drag functionality
                    makeDraggable(stageElement, stage.id);
                    
                    // Add double-click to edit
                    stageElement.addEventListener('dblclick', () => {
                        const newTitle = prompt('Edit stage title:', stage.title);
                        const newContent = prompt('Edit stage content:', stage.content);
                        if (newTitle !== null && newContent !== null) {
                            updateStage(stage.id, newTitle, newContent);
                        }
                    });
                    
                    // Add delete button event
                    const deleteBtn = stageElement.querySelector('.delete-btn');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        removeStage(stage.id);
                    });
                    
                    canvas.appendChild(stageElement);
                });
            }

            // Make element draggable
            function makeDraggable(element, id) {
                let isDragging = false;
                let offsetX, offsetY;

                element.addEventListener('mousedown', (e) => {
                    if (e.target.classList.contains('delete-btn')) return;
                    
                    isDragging = true;
                    offsetX = e.clientX - element.getBoundingClientRect().left;
                    offsetY = e.clientY - element.getBoundingClientRect().top;
                    element.classList.add('dragging');
                    element.style.zIndex = '100';
                    
                    // Bring to front
                    const parent = element.parentElement;
                    parent.appendChild(element);
                });

                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left - offsetX;
                    const y = e.clientY - rect.top - offsetY;
                    
                    // Constrain to canvas bounds
                    const boundedX = Math.max(0, Math.min(x, canvas.offsetWidth - element.offsetWidth));
                    const boundedY = Math.max(0, Math.min(y, canvas.offsetHeight - element.offsetHeight));
                    
                    element.style.left = `${boundedX}px`;
                    element.style.top = `${boundedY}px`;
                    
                    // Update stage position
                    const stage = stages.find(s => s.id === id);
                    if (stage) {
                        stage.x = boundedX;
                        stage.y = boundedY;
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                    element.classList.remove('dragging');
                    element.style.zIndex = '';
                });
            }

            // Event Listeners
            addStageBtn.addEventListener('click', () => {
                addStage();
            });

            resetBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to reset the entire flow?')) {
                    resetFlow();
                }
            });

            connectBtn.addEventListener('click', () => {
                isConnecting = !isConnecting;
                connectBtn.textContent = isConnecting ? '✓' : '→';
                connectBtn.style.background = isConnecting ? '#27ae60' : '#3498db';
                
                if (isConnecting) {
                    selectedStages = [];
                }
            });

            clearConnectionsBtn.addEventListener('click', () => {
                clearConnections();
            });

            // Handle connection selection
            canvas.addEventListener('click', (e) => {
                if (!isConnecting) return;
                
                const clickedElement = e.target.closest('.stage');
                if (clickedElement) {
                    const stageId = parseInt(clickedElement.id.split('-')[1]);
                    
                    if (selectedStages.length === 0) {
                        selectedStages.push(stageId);
                    } else if (selectedStages.length === 1) {
                        if (selectedStages[0] !== stageId) {
                            connectStages(selectedStages[0], stageId);
                        }
                        selectedStages = [];
                        isConnecting = false;
                        connectBtn.textContent = '→';
                        connectBtn.style.background = '#3498db';
                    }
                }
            });

            // Initialize the app
            init();
        });
    </script>
</body>
</html>
