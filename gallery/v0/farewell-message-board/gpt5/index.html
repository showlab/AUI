<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Farewell Wall ‚Äî A Warm Goodbye Board</title>
<meta name="description" content="A warm and fun farewell message board where everyone can leave heartfelt notes.">
<style>
  /* CSS Reset (modern, minimal) */
  *, *::before, *::after { box-sizing: border-box; }
  html, body { height: 100%; }
  body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji"; line-height: 1.4; color: #1b1b1f; background: #0f172a; }
  img, svg, video { max-width: 100%; display: block; }
  button { font: inherit; }
  dialog { border: none; border-radius: 16px; padding: 0; }
  :root {
    --bg: #0f172a;              /* slate-900 */
    --panel: #0b1222;           /* darker slate */
    --card: #0f1b33;            /* deep indigo-ish */
    --muted: #96a0b5;           /* slate-400ish */
    --text: #e6eaf3;            /* near-white */
    --brand: #7c3aed;           /* violet-600 */
    --brand-2: #22d3ee;         /* cyan-400 */
    --positive: #22c55e;        /* green-500 */
    --warn: #f59e0b;            /* amber-500 */
    --danger: #ef4444;          /* red-500 */
    --radius: 16px;
    --radius-sm: 12px;
    --shadow-1: 0 6px 30px rgba(0,0,0,.25);
    --shadow-2: 0 18px 60px rgba(0,0,0,.35);
    --ring: 0 0 0 3px color-mix(in oklab, var(--brand) 25%, transparent);
    --button-h: 44px;
    --gap: 20px;
    --grid-min: 280px;
  }

  /* App Shell */
  header {
    position: sticky; top: 0; z-index: 50;
    background: linear-gradient(180deg, rgba(15,23,42,.9), rgba(15,23,42,.75), rgba(15,23,42,0));
    backdrop-filter: saturate(160%) blur(8px);
    border-bottom: 1px solid rgba(255,255,255,.06);
  }
  .header-inner {
    max-width: 1200px; margin: 0 auto; padding: 14px 20px;
    display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px;
  }
  .brand {
    display: flex; align-items: center; gap: 12px; color: var(--text); text-decoration: none;
  }
  .brand-logo {
    width: 36px; height: 36px; border-radius: 12px;
    background: radial-gradient(100% 100% at 30% 20%, var(--brand-2), transparent 45%), linear-gradient(135deg, var(--brand), #4338ca);
    display: grid; place-items: center; color: #fff; font-weight: 800; letter-spacing: .5px; box-shadow: var(--shadow-1);
  }
  .brand-title { font-weight: 800; font-size: 1.1rem; }
  .brand-sub { color: var(--muted); font-size: .9rem; display: none; }
  @media (min-width: 720px) { .brand-sub { display: inline; } }

  nav.header-actions { display: flex; align-items: center; gap: 10px; }

  /* Buttons (consistent sizing) */
  .btn {
    height: var(--button-h); padding: 0 16px; border: 1px solid transparent;
    border-radius: 999px; display: inline-flex; align-items: center; gap: 10px;
    background: #1f2937; color: var(--text); cursor: pointer; transition: .2s ease;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
  }
  .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.08); }
  .btn:focus-visible { outline: none; box-shadow: var(--ring), inset 0 0 0 1px rgba(255,255,255,.12); }
  .btn:active { transform: translateY(0); }
  .btn--primary {
    background: linear-gradient(135deg, color-mix(in oklab, var(--brand) 85%, #000), color-mix(in oklab, var(--brand-2) 65%, #000));
    color: #0b0f1a;
    border: 1px solid rgba(255,255,255,.08);
  }
  .btn--ghost {
    background: transparent; border-color: rgba(255,255,255,.14);
  }
  .btn-icon {
    width: var(--button-h); padding: 0; justify-content: center;
  }

  /* Main layout */
  main { max-width: 1200px; margin: 0 auto; padding: 16px 20px 120px; }
  .hero {
    padding: 16px; margin: 8px 0 12px; border-radius: var(--radius);
    background: linear-gradient(180deg, rgba(124,58,237,.14), rgba(34,211,238,.08));
    border: 1px solid rgba(255,255,255,.08);
    display: flex; align-items: center; gap: 14px; color: var(--text);
  }
  .hero-emoji { font-size: 28px; }
  .hero h1 { margin: 0; font-size: 1.25rem; }
  .hero p { margin: 2px 0 0; color: var(--muted); font-size: .95rem; }

  /* Board grid */
  #board {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(var(--grid-min), 1fr));
    gap: var(--gap); margin-top: 14px;
  }

  /* Card */
  .card {
    background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.06));
    border: 1px solid rgba(255,255,255,.06); border-radius: var(--radius);
    overflow: clip; box-shadow: var(--shadow-1); color: var(--text);
    display: flex; flex-direction: column; min-height: 260px;
    transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  }
  .card:focus-within, .card:hover { transform: translateY(-2px); box-shadow: var(--shadow-2); border-color: rgba(124,58,237,.5); }
  .thumb {
    height: 160px; position: relative; overflow: hidden;
    background:
      radial-gradient(120% 80% at 60% 0%, rgba(255,255,255,.20), transparent 60%),
      linear-gradient(135deg, hsl(var(--h, 260) 70% 50%), hsl(calc(var(--h, 260) + 60) 70% 45%));
  }
  .thumb::after {
    content: attr(data-emoji);
    position: absolute; inset: 0; display: grid; place-items: center;
    font-size: 68px; filter: drop-shadow(0 8px 24px rgba(0,0,0,.35));
  }
  .card-body { padding: 16px 16px 14px; display: flex; flex-direction: column; gap: 10px; }
  .message {
    margin: 0; font-size: 1rem; line-height: 1.5; color: #f6f7fb;
    display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 6; overflow: hidden;
  }
  .meta {
    margin-top: auto; display: flex; align-items: baseline; justify-content: space-between; gap: 10px;
    color: var(--muted); font-size: .9rem;
    border-top: 1px dashed rgba(255,255,255,.08); padding-top: 10px;
  }
  .author { font-weight: 700; color: #e9eaf3; }
  .avatar {
    width: 28px; height: 28px; border-radius: 50%; display: inline-grid; place-items: center; font-weight: 800;
    background: linear-gradient(135deg, #334155, #0ea5e9); color: #0b0f1a; margin-right: 8px;
  }

  /* Floating Write button */
  .fab {
    position: fixed; right: 24px; bottom: 24px; z-index: 60;
    display: inline-flex; align-items: center; gap: 10px; padding: 0 18px;
    height: 52px; border-radius: 999px; font-weight: 700; letter-spacing: .2px;
  }

  /* Dialogs */
  .dialog {
    width: min(560px, 92vw);
    color: var(--text);
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.4));
    border: 1px solid rgba(255,255,255,.1);
    box-shadow: var(--shadow-2);
  }
  .dialog header {
    position: sticky; top: 0; background: transparent; border: none;
    padding: 16px 18px 6px; backdrop-filter: none;
  }
  .dialog .content { padding: 0 18px 18px; display: grid; gap: 14px; }
  .field { display: grid; gap: 8px; }
  .label { font-size: .9rem; color: var(--muted); }
  .input, textarea {
    width: 100%; min-height: var(--button-h); padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.12);
    color: var(--text); background: rgba(2,6,23,.6); outline: none; transition: .15s ease;
  }
  .input:focus, textarea:focus { box-shadow: var(--ring); border-color: color-mix(in oklab, var(--brand) 35%, rgba(255,255,255,.12)); }
  textarea { min-height: 120px; resize: vertical; }
  .char-counter { font-size: .85rem; color: var(--muted); text-align: right; margin-top: -6px; }
  .emoji-picker {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(48px, 1fr)); gap: 8px;
  }
  .emoji-option {
    position: relative; height: 48px; border-radius: 12px; border: 1px solid rgba(255,255,255,.14);
    background: rgba(2,6,23,.5); display: grid; place-items: center; cursor: pointer; font-size: 22px;
  }
  .emoji-option input { position: absolute; inset: 0; opacity: 0; pointer-events: none; }
  .emoji-option:has(input:checked) { outline: none; border-color: color-mix(in oklab, var(--brand) 60%, rgba(255,255,255,.2)); box-shadow: inset 0 0 0 2px color-mix(in oklab, var(--brand) 40%, transparent); }
  .dialog footer {
    display: flex; justify-content: space-between; gap: 10px; padding: 14px 18px 18px;
  }

  /* Toast */
  #toast {
    position: fixed; left: 50%; bottom: 20px; transform: translateX(-50%) translateY(30px);
    background: #111827; color: var(--text); padding: 12px 16px; border-radius: 10px; border: 1px solid rgba(255,255,255,.12);
    box-shadow: var(--shadow-1); opacity: 0; transition: .25s ease; z-index: 80; pointer-events: none;
  }
  #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* Footer */
  footer {
    max-width: 1200px; margin: 24px auto; padding: 12px 20px; color: var(--muted); font-size: .9rem;
  }

  /* Utilities */
  .hidden { display: none !important; }
  .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
</style>
</head>
<body>
  <header id="appHeader" role="banner" aria-label="Top bar">
    <div class="header-inner">
      <a class="brand" href="#" aria-label="Farewell Wall Home">
        <div class="brand-logo" aria-hidden="true">FW</div>
        <div>
          <div class="brand-title">Farewell Wall</div>
          <div class="brand-sub">Warm notes for a wonderful send-off</div>
        </div>
      </a>
      <nav class="header-actions" aria-label="User">
        <button class="btn btn--ghost" id="loginBtn" aria-haspopup="dialog" title="Sign in">
          <span aria-hidden="true">üë§</span>
          <span id="loginBtnLabel">Sign In</span>
        </button>
        <button class="btn btn--primary" id="writeBtn" aria-haspopup="dialog" title="Write a new message">
          <span aria-hidden="true">‚úçÔ∏è</span>
          Write
        </button>
      </nav>
    </div>
  </header>

  <main role="main">
    <section class="hero" aria-label="Welcome">
      <div class="hero-emoji" aria-hidden="true">üéâ</div>
      <div>
        <h1>Leave a note, share a memory, send your best wishes!</h1>
        <p>Click ‚ÄúWrite‚Äù to add your message. Sign in to post with your name.</p>
      </div>
    </section>

    <section id="boardSection" aria-label="Messages">
      <div id="board"></div>
    </section>
  </main>

  <footer role="contentinfo">
    Built with semantic HTML, modern CSS, and vanilla JavaScript. Consistent, responsive, and warm by design.
  </footer>

  <!-- Floating Write FAB for convenience -->
  <button class="btn btn--primary fab" id="writeFab" aria-haspopup="dialog" title="Write a message (shortcut)">
    <span aria-hidden="true">‚ûï</span> Write
  </button>

  <!-- Login Dialog -->
  <dialog class="dialog" id="loginDialog" aria-labelledby="loginDialogTitle" aria-describedby="loginDialogDesc">
    <header>
      <h2 id="loginDialogTitle" style="margin:0">Sign in</h2>
    </header>
    <div class="content">
      <p id="loginDialogDesc" style="margin:0; color:var(--muted)">This is a simple sign-in to show your name on messages.</p>
      <div class="field">
        <label for="loginNameInput" class="label">Your display name</label>
        <input id="loginNameInput" class="input" type="text" placeholder="e.g., Alex Kim" autocomplete="name" maxlength="40">
      </div>
    </div>
    <footer>
      <button class="btn btn--ghost" id="loginCancelBtn" type="button">Cancel</button>
      <div style="display:flex; gap:10px">
        <button class="btn" id="loginSignOutBtn" type="button" title="Sign out" style="display:none">Sign out</button>
        <button class="btn btn--primary" id="loginSubmitBtn" type="button">Continue</button>
      </div>
    </footer>
  </dialog>

  <!-- Write Dialog -->
  <dialog class="dialog" id="writeDialog" aria-labelledby="writeDialogTitle" aria-describedby="writeDialogDesc">
    <header>
      <h2 id="writeDialogTitle" style="margin:0">Write a message</h2>
    </header>
    <div class="content">
      <p id="writeDialogDesc" style="margin:0; color:var(--muted)">Keep it heartfelt and kind. Your message will appear on the wall.</p>

      <div class="field" id="authorField">
        <label for="authorInput" class="label">Your name</label>
        <input id="authorInput" class="input" type="text" placeholder="Post as Guest if left empty" maxlength="40" autocomplete="name">
      </div>

      <div class="field">
        <label for="messageInput" class="label">Message</label>
        <textarea id="messageInput" placeholder="Share your favorite memory or wish..." maxlength="500"></textarea>
        <div class="char-counter"><span id="charCount">0</span>/500</div>
      </div>

      <div class="field">
        <span class="label">Pick a picture theme</span>
        <div class="emoji-picker" id="emojiPicker" role="group" aria-label="Picture theme">
          <!-- options inserted by JS -->
        </div>
      </div>
    </div>
    <footer>
      <button class="btn btn--ghost" id="postCancelBtn" type="button">Cancel</button>
      <button class="btn btn--primary" id="postSubmitBtn" type="button">Post</button>
    </footer>
  </dialog>

  <div id="toast" role="status" aria-live="polite"></div>

<script>
(() => {
  "use strict";

  // Utilities
  const $ = (sel, root=document) => root.querySelector(sel);
  const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
  const formatDate = (iso) => {
    const d = iso ? new Date(iso) : new Date();
    return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
  };
  const initials = (name) => {
    const n = (name || 'Guest').trim().split(/\s+/).slice(0,2);
    return n.map(x => x[0]?.toUpperCase() || '').join('') || 'G';
  };
  const randomHue = () => Math.floor(Math.random()*360);

  // DOM refs (with required IDs for testing)
  const boardEl = $("#board");
  const loginBtn = $("#loginBtn");
  const loginBtnLabel = $("#loginBtnLabel");
  const writeBtn = $("#writeBtn");
  const writeFab = $("#writeFab");
  const loginDialog = $("#loginDialog");
  const loginNameInput = $("#loginNameInput");
  const loginSubmitBtn = $("#loginSubmitBtn");
  const loginCancelBtn = $("#loginCancelBtn");
  const loginSignOutBtn = $("#loginSignOutBtn");
  const writeDialog = $("#writeDialog");
  const authorField = $("#authorField");
  const authorInput = $("#authorInput");
  const messageInput = $("#messageInput");
  const charCount = $("#charCount");
  const emojiPicker = $("#emojiPicker");
  const postSubmitBtn = $("#postSubmitBtn");
  const postCancelBtn = $("#postCancelBtn");
  const toast = $("#toast");

  // State
  const STORAGE_KEY = "farewellMessages";
  const USER_KEY = "farewellUser";

  const seedMessages = [
    { text: "Your kindness and humor lit up every day. Wishing you endless adventures ahead. Don‚Äôt forget to write!", author: "Priya S.", dateISO: "2025-03-18", emoji: "üéà", picLabel: "Balloons celebrating" },
    { text: "Thanks for the guidance and the laughs. May your next chapter be even brighter!", author: "Daniel Lee", dateISO: "2025-03-20", emoji: "‚ú®", picLabel: "Sparkles for a bright future" },
    { text: "From late-night deploys to early morning coffees‚Äîcouldn‚Äôt have asked for a better teammate. You‚Äôll be missed!", author: "Mina K.", dateISO: "2025-03-22", emoji: "‚òïÔ∏è", picLabel: "Coffee for teamwork" },
    { text: "Go chase those dreams! The world is lucky to have you out there making it kinder.", author: "Arjun Rao", dateISO: "2025-03-25", emoji: "üåç", picLabel: "World for new journeys" },
    { text: "Your creativity inspired us all. Keep painting life with bold colors!", author: "Sofia Alvarez", dateISO: "2025-03-27", emoji: "üé®", picLabel: "Palette for creativity" },
    { text: "May your road be smooth and your playlist perfect. Drive safe and stay awesome!", author: "Chris P.", dateISO: "2025-03-29", emoji: "üöó", picLabel: "Car for the road ahead" },
    { text: "I‚Äôll miss your ‚Äòdad jokes‚Äô and your calm under pressure. Thank you for everything.", author: "Jules", dateISO: "2025-03-30", emoji: "üòÑ", picLabel: "Smile for good vibes" },
    { text: "You leave big shoes to fill. Keep soaring‚Äîsky‚Äôs the limit!", author: "Amelia", dateISO: "2025-04-01", emoji: "üöÄ", picLabel: "Rocket for new heights" },
    { text: "Lunch crew won‚Äôt be the same without you. Come back to visit, okay?", author: "Marco", dateISO: "2025-04-02", emoji: "üçΩÔ∏è", picLabel: "Plate for lunch memories" },
    { text: "Here‚Äôs to new challenges and amazing wins. You‚Äôve got this!", author: "Nadia", dateISO: "2025-04-03", emoji: "üí™", picLabel: "Flex for strength" }
  ];

  // Emoji options for picture themes
  const emojiOptions = [
    "üéà","üéâ","‚ú®","üåà","‚òÄÔ∏è","üåª","üöÄ","üé®","üì∑","üéµ","üíå","üß≠","üåä","üåü","üçÄ","‚òïÔ∏è"
  ];

  function getMessages() {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored) {
      try { return JSON.parse(stored); } catch { /* ignore */ }
    }
    // First time: seed with hues
    const seeded = seedMessages.map(m => ({ ...m, hue: randomHue(), id: cryptoRandomId() }));
    localStorage.setItem(STORAGE_KEY, JSON.stringify(seeded));
    return seeded;
  }
  function setMessages(arr) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
  }
  function getUser() {
    const u = localStorage.getItem(USER_KEY);
    if (!u) return null;
    try { return JSON.parse(u); } catch { return null; }
  }
  function setUser(u) {
    if (u) localStorage.setItem(USER_KEY, JSON.stringify(u));
    else localStorage.removeItem(USER_KEY);
    updateLoginUI();
  }

  function cryptoRandomId() {
    try {
      const b = new Uint8Array(8);
      crypto.getRandomValues(b);
      return [...b].map(x => x.toString(16).padStart(2,'0')).join('');
    } catch {
      return Math.random().toString(36).slice(2, 10);
    }
  }

  function updateLoginUI() {
    const user = getUser();
    if (user?.name) {
      loginBtnLabel.textContent = user.name;
      loginBtn.title = `Signed in as ${user.name}`;
    } else {
      loginBtnLabel.textContent = "Sign In";
      loginBtn.title = "Sign in";
    }
  }

  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 1800);
  }

  function clearNode(node) { while (node.firstChild) node.removeChild(node.firstChild); }

  // Render one card
  function createCard(m) {
    const article = document.createElement("article");
    article.className = "card";
    article.setAttribute("tabindex", "0");
    article.setAttribute("role", "article");
    article.dataset.id = m.id;

    const fig = document.createElement("figure");
    fig.className = "thumb";
    fig.setAttribute("aria-label", m.picLabel || "Picture");
    fig.dataset.emoji = m.emoji || "üéâ";
    fig.style.setProperty("--h", String(m.hue ?? randomHue()));
    article.appendChild(fig);

    const body = document.createElement("div");
    body.className = "card-body";

    const p = document.createElement("p");
    p.className = "message";
    p.textContent = m.text;
    body.appendChild(p);

    const meta = document.createElement("div");
    meta.className = "meta";

    const left = document.createElement("div");
    const av = document.createElement("span");
    av.className = "avatar";
    av.setAttribute("aria-hidden", "true");
    av.textContent = initials(m.author);
    const a = document.createElement("span");
    a.className = "author";
    a.textContent = "‚Äî " + (m.author || "Guest");
    left.appendChild(av);
    left.appendChild(a);

    const time = document.createElement("time");
    const iso = m.dateISO || new Date().toISOString();
    time.setAttribute("datetime", iso);
    time.textContent = formatDate(iso);

    meta.appendChild(left);
    meta.appendChild(time);

    body.appendChild(meta);
    article.appendChild(body);

    return article;
  }

  // Render board
  function renderBoard() {
    const msgs = getMessages().slice().sort((a,b) => new Date(b.dateISO) - new Date(a.dateISO));
    clearNode(boardEl);
    msgs.forEach(m => boardEl.appendChild(createCard(m)));
  }

  // Dialog helpers
  function openDialog(dlg) {
    if (typeof dlg.showModal === "function") {
      dlg.showModal();
      // Close on backdrop click
      const onClick = (e) => {
        const rect = dlg.getBoundingClientRect();
        const clickedIn = (e.clientX >= rect.left && e.clientX <= rect.right && e.clientY >= rect.top && e.clientY <= rect.bottom);
        if (!clickedIn) dlg.close();
      };
      dlg.addEventListener("click", onClick, { once: true });
    } else {
      dlg.classList.remove("hidden"); // fallback
    }
  }
  function closeDialog(dlg) {
    if (typeof dlg.close === "function") dlg.close();
    else dlg.classList.add("hidden");
  }

  // Build emoji picker options
  function buildEmojiPicker(selected = "üéâ") {
    clearNode(emojiPicker);
    emojiOptions.forEach((emo, idx) => {
      const label = document.createElement("label");
      label.className = "emoji-option";
      label.title = "Choose " + emo;
      const input = document.createElement("input");
      input.type = "radio";
      input.name = "emoji";
      input.value = emo;
      input.checked = emo === selected || (selected == null && idx === 0);
      const span = document.createElement("span");
      span.setAttribute("aria-hidden", "true");
      span.textContent = emo;
      label.appendChild(input);
      label.appendChild(span);
      emojiPicker.appendChild(label);
    });
  }
  function getSelectedEmoji() {
    const checked = emojiPicker.querySelector('input[name="emoji"]:checked');
    return checked ? checked.value : "üéâ";
  }

  // Events
  loginBtn.addEventListener("click", () => {
    const user = getUser();
    loginNameInput.value = user?.name || "";
    loginSignOutBtn.style.display = user?.name ? "inline-flex" : "none";
    openDialog(loginDialog);
    setTimeout(() => loginNameInput.focus(), 100);
  });
  loginCancelBtn.addEventListener("click", () => closeDialog(loginDialog));
  loginSignOutBtn.addEventListener("click", () => {
    setUser(null);
    showToast("Signed out");
    closeDialog(loginDialog);
  });
  loginSubmitBtn.addEventListener("click", () => {
    const name = loginNameInput.value.trim();
    if (!name) {
      showToast("Please enter a display name");
      loginNameInput.focus();
      return;
    }
    setUser({ name });
    showToast(`Signed in as ${name}`);
    closeDialog(loginDialog);
  });
  loginNameInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") loginSubmitBtn.click();
  });

  function openWrite() {
    const user = getUser();
    if (user?.name) {
      authorField.style.display = "none";
      authorInput.value = user.name;
    } else {
      authorField.style.display = "";
      authorInput.value = "";
    }
    messageInput.value = "";
    charCount.textContent = "0";
    buildEmojiPicker("üéâ");
    openDialog(writeDialog);
    setTimeout(() => messageInput.focus(), 100);
  }
  writeBtn.addEventListener("click", openWrite);
  writeFab.addEventListener("click", openWrite);

  postCancelBtn.addEventListener("click", () => closeDialog(writeDialog));
  messageInput.addEventListener("input", () => {
    charCount.textContent = String(messageInput.value.length);
  });

  postSubmitBtn.addEventListener("click", () => {
    const text = messageInput.value.trim();
    const name = (authorInput.value || "").trim() || getUser()?.name || "Guest";
    if (!text) {
      showToast("Please write a message");
      messageInput.focus();
      return;
    }
    const emoji = getSelectedEmoji();
    const newMsg = {
      id: cryptoRandomId(),
      text,
      author: name,
      dateISO: new Date().toISOString(),
      emoji,
      picLabel: emojiToLabel(emoji),
      hue: randomHue()
    };
    const msgs = getMessages();
    msgs.push(newMsg);
    setMessages(msgs);
    renderBoard();
    showToast("Message posted");
    closeDialog(writeDialog);
  });

  // Accessibility: ESC closes dialogs (native dialog handles cancel)
  [loginDialog, writeDialog].forEach(dlg => {
    dlg.addEventListener("cancel", (e) => e.preventDefault() || dlg.close());
  });

  function emojiToLabel(e) {
    const map = {
      "üéà":"Balloons celebrating", "üéâ":"Confetti party", "‚ú®":"Sparkles",
      "üåà":"Rainbow of hope", "‚òÄÔ∏è":"Sunny day", "üåª":"Sunflower",
      "üöÄ":"Rocket to new heights", "üé®":"Artist palette", "üì∑":"Camera memory",
      "üéµ":"Music note", "üíå":"Envelope with heart", "üß≠":"Compass for direction",
      "üåä":"Waves", "üåü":"Shining star", "üçÄ":"Lucky clover", "‚òïÔ∏è":"Coffee cup"
    };
    return map[e] || "Themed picture";
  }

  // Keyboard shortcut: "w" to write
  document.addEventListener("keydown", (e) => {
    if (e.key.toLowerCase() === "w" && !e.metaKey && !e.ctrlKey && !e.altKey) {
      const activeEl = document.activeElement;
      const editing = activeEl && (activeEl.tagName === "INPUT" || activeEl.tagName === "TEXTAREA" || activeEl.isContentEditable);
      if (!editing && !writeDialog.open && !loginDialog.open) {
        openWrite();
      }
    }
  });

  // Initialize
  updateLoginUI();
  buildEmojiPicker("üéâ");
  renderBoard();

  // Ensure UI fits 1280x720 nicely: adjust grid min if needed
  const mql = window.matchMedia("(min-width: 1280px)");
  function tuneGrid() {
    // keep comfortable card width within 1280x720
    // no-op for now; CSS handles responsivity
  }
  mql.addEventListener?.("change", tuneGrid);

})();
</script>
</body>
</html>