<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Event Feedback Viewer</title>
  <style>
    :root{
      --bg: #f7f9fc;
      --surface: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --accent: #2563eb;
      --accent-600:#1d4ed8;
      --line: #e5e7eb;
      --highlight:#eef2ff;
      --good:#16a34a;
      --bad:#dc2626;
      --shadow: 0 6px 16px rgba(2, 6, 23, 0.08);
      --radius: 12px;
    }
    *{box-sizing:border-box}
    html, body {
      height: 100%;
    }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      color:var(--text);
      background:linear-gradient(180deg, var(--bg), #ffffff 400px);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    header{
      padding: 24px 20px 8px;
    }
    .container{
      max-width: 1200px;
      margin: 0 auto;
    }
    h1{
      margin:0 0 14px 0;
      font-size: 28px;
      letter-spacing: -0.02em;
      font-weight: 700;
    }
    /* AI Summary */
    #aiSummary{
      background: var(--surface);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px 16px 16px 16px;
      position: relative;
    }
    #aiSummary h2{
      font-size:16px;
      margin:0 0 8px 0;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap:8px;
    }
    #aiSummary p{
      margin:0;
      line-height: 1.5;
    }
    #aiSummaryClose{
      position: absolute;
      inset-inline-end: 8px;
      inset-block-start: 8px;
      border: none;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      border-radius: 8px;
      padding: 6px;
    }
    #aiSummaryClose:hover{
      background: var(--highlight);
      color: var(--text);
    }
    #aiSummaryClose:focus-visible{
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    main{
      padding: 12px 20px 24px;
    }
    .toolbar{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .search{
      flex: 1 1 420px;
      display:flex;
      align-items:center;
      background: var(--surface);
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 10px 12px 10px 14px;
      box-shadow: var(--shadow);
      gap:8px;
    }
    .search svg{color: var(--muted)}
    #searchInput{
      border: none;
      outline: none;
      width: 100%;
      font-size: 15px;
      background: transparent;
      color: var(--text);
    }
    #searchInput::placeholder{color:#94a3b8}
    #clearSearchBtn{
      border: none;
      background: #eef2ff;
      color: var(--accent-600);
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 600;
    }
    #clearSearchBtn:hover{background:#e0e7ff}
    #clearSearchBtn:focus-visible{outline:2px solid var(--accent); outline-offset:2px}

    .meta{
      margin-left: auto;
      color: var(--muted);
      font-size: 14px;
    }

    /* Table */
    .table-card{
      background: var(--surface);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      display:flex;
      flex-direction: column;
      min-height: 420px;
    }
    .table-wrap{
      overflow: auto;
      max-height: calc(720px - 240px); /* target viewport */
    }
    table{
      width:100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    caption{
      text-align:left;
      padding: 12px 16px;
      color: var(--muted);
      font-size: 14px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, #f8fafc, #ffffff);
    }
    thead th{
      position: sticky;
      top: 0;
      z-index: 2;
      background: #f8fafc;
      border-bottom: 1px solid var(--line);
      font-weight: 700;
      text-align: left;
      color: #0f172a;
      font-size: 14px;
    }
    thead th:first-child{border-top-left-radius:12px}
    thead th:last-child{border-top-right-radius:12px}
    th, td{
      padding: 12px 14px;
      vertical-align: top;
      border-bottom: 1px solid var(--line);
    }
    tbody tr:nth-child(even) td{
      background: #fcfdff;
    }
    tbody tr:hover td{
      background: var(--highlight);
    }
    .col-date{width: 140px; white-space: nowrap}
    .col-event{width: 220px}
    .col-name{width: 200px}
    .col-rating{width: 140px; white-space: nowrap}
    .col-feedback{min-width: 320px}
    .muted{color: var(--muted)}

    /* Sort headers */
    .sort-btn{
      all: unset;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 8px 8px;
      border-radius: 8px;
    }
    .sort-btn:hover{
      background: #eef2ff;
    }
    th:focus-within .sort-btn{
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
    .sort-indicator{
      width: 14px; height: 14px; display:inline-flex; align-items:center; justify-content:center;
      color: #94a3b8;
    }
    th[aria-sort="ascending"] .sort-indicator{color: var(--accent-600)}
    th[aria-sort="descending"] .sort-indicator{color: var(--accent-600)}
    /* Icons via CSS content */
    .sort-indicator::before{
      content: "↕";
      font-size: 12px;
      line-height: 1;
    }
    th[aria-sort="ascending"] .sort-indicator::before{content:"▲"}
    th[aria-sort="descending"] .sort-indicator::before{content:"▼"}

    /* Rating */
    .rating{
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space: nowrap;
    }
    .stars{
      letter-spacing: 1px;
      color: #f59e0b;
      font-size: 14px;
    }
    .score{
      color: var(--muted);
      font-variant-numeric: tabular-nums;
    }

    /* Feedback text clamping with tooltip */
    .feedback{
      line-height: 1.5;
      color: #0b1221;
    }
    .feedback .clamp{
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .feedback .clamped{
      position: relative;
    }
    .feedback .clamped::after{
      content: "";
      position: absolute;
      right: 0; bottom:0;
      width: 40%;
      height: 1.2em;
      background: linear-gradient(90deg, rgba(255,255,255,0), var(--surface) 50%);
      pointer-events: none;
    }
    .no-results{
      padding: 24px;
      text-align: center;
      color: var(--muted);
    }

    /* Footer slim bar for info */
    .card-footer{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 12px;
      padding: 10px 14px;
      font-size: 13px;
      color: var(--muted);
      background: #f8fafc;
      border-top: 1px solid var(--line);
    }

    /* Responsive tweaks */
    @media (max-width: 860px){
      .col-event{width: 180px}
      .col-name{width: 160px}
    }
    @media (max-width: 640px){
      .toolbar{flex-direction: column; align-items: stretch}
      .meta{margin-left: 0}
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Event Feedback Viewer</h1>
      <section id="aiSummary" aria-label="AI summary" role="region">
        <button id="aiSummaryClose" aria-label="Close AI summary" title="Close">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M6.225 4.811L4.811 6.225 10.586 12l-5.775 5.775 1.414 1.414L12 13.414l5.775 5.775 1.414-1.414L13.414 12l5.775-5.775-1.414-1.414L12 10.586z"/></svg>
        </button>
        <h2>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#2563eb" aria-hidden="true" focusable="false"><path d="M12 2a6 6 0 00-6 6v2H4a2 2 0 00-2 2v6a2 2 0 002 2h5v-6H6v-2h3V8a3 3 0 016 0v2h3v2h-3v6h5a2 2 0 002-2v-6a2 2 0 00-2-2h-2V8a6 6 0 00-6-6z"/></svg>
          AI summary
        </h2>
        <p id="aiSummaryText">Analyzing submissions...</p>
      </section>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="toolbar" role="search">
        <div class="search" aria-label="Search feedback">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M10 2a8 8 0 105.293 14.293l4.207 4.207 1.414-1.414-4.207-4.207A8 8 0 0010 2zm0 2a6 6 0 110 12 6 6 0 010-12z"/></svg>
          <input id="searchInput" type="search" placeholder="Search by keyword (event, name, feedback, rating...)" autocomplete="off" />
          <button id="clearSearchBtn" type="button" title="Clear search">Clear</button>
        </div>
        <div class="meta" id="resultMeta" aria-live="polite">Showing 0 of 0</div>
      </div>

      <article class="table-card" aria-label="Feedback table">
        <div class="table-wrap">
          <table id="feedbackTable">
            <caption>Participant feedback submissions</caption>
            <colgroup>
              <col class="col-date">
              <col class="col-event">
              <col class="col-name">
              <col class="col-rating">
              <col class="col-feedback">
            </colgroup>
            <thead>
              <tr>
                <th id="th-date" scope="col" aria-sort="none">
                  <button id="sort-date" class="sort-btn" data-key="date" aria-label="Sort by date">Date <span class="sort-indicator" aria-hidden="true"></span></button>
                </th>
                <th id="th-event" scope="col" aria-sort="none">
                  <button id="sort-event" class="sort-btn" data-key="event" aria-label="Sort by event">Event <span class="sort-indicator" aria-hidden="true"></span></button>
                </th>
                <th id="th-name" scope="col" aria-sort="none">
                  <button id="sort-name" class="sort-btn" data-key="name" aria-label="Sort by participant">Participant <span class="sort-indicator" aria-hidden="true"></span></button>
                </th>
                <th id="th-rating" scope="col" aria-sort="none">
                  <button id="sort-rating" class="sort-btn" data-key="rating" aria-label="Sort by rating">Rating <span class="sort-indicator" aria-hidden="true"></span></button>
                </th>
                <th id="th-feedback" scope="col" aria-sort="none">
                  <button id="sort-feedback" class="sort-btn" data-key="feedback" aria-label="Sort by feedback">Feedback <span class="sort-indicator" aria-hidden="true"></span></button>
                </th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- rows injected -->
            </tbody>
          </table>
        </div>
        <div class="card-footer">
          <div id="selectionInfo">Tip: Click a column header to sort ascending/descending.</div>
          <div id="timeInfo"></div>
        </div>
      </article>
    </div>
  </main>

  <script>
    // Utilities
    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const choice = arr => arr[rand(0, arr.length - 1)];
    const pad2 = n => String(n).padStart(2, '0');
    function formatDate(ts){
      const d = new Date(ts);
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    }

    // Data generation
    const EVENT_NAMES = [
      "Quarterly Town Hall",
      "Sales Kickoff",
      "Leadership Workshop",
      "Product Launch Webinar",
      "Customer Success Summit",
      "IT Security Briefing",
      "All-Hands Meeting",
      "Innovation Lab Demo",
      "Finance Strategy Update",
      "HR Policy Refresh",
      "Marketing Analytics Deep-Dive",
      "Operational Excellence Forum"
    ];
    const FIRST_NAMES = ["Alex","Jordan","Taylor","Morgan","Casey","Riley","Quinn","Avery","Jamie","Drew","Reese","Cameron","Logan","Rowan","Parker","Sage","Elliot","Skyler","Kendall","Harper"];
    const LAST_NAMES = ["Nguyen","Patel","Garcia","Martin","Thompson","Lee","Walker","Hernandez","Clark","Young","Allen","King","Wright","Lopez","Hill","Scott","Adams","Baker","Campbell","Mitchell"];

    const POSITIVE_SNIPPETS = [
      "The session was well-structured and engaging throughout.",
      "Speakers were knowledgeable and kept the content practical.",
      "I appreciated the clarity of the examples and live demonstrations.",
      "Materials were concise, and the pacing felt thoughtfully planned.",
      "Breakout discussions added real value and encouraged collaboration."
    ];
    const NEUTRAL_SNIPPETS = [
      "Some segments ran a bit long, but overall it stayed on track.",
      "Venue was comfortable and the logistics were well organized.",
      "Q&A addressed most questions though a few topics remained open.",
      "Slides were informative, and the follow-up resources helped.",
      "Networking time was adequate, albeit slightly rushed."
    ];
    const IMPROVE_SNIPPETS = [
      "The pace could be a touch faster for advanced attendees.",
      "More hands-on exercises would enhance retention.",
      "Audio in the back rows was occasionally hard to hear.",
      "Providing case studies from different industries would broaden relevance.",
      "A dedicated segment on next steps would improve outcomes."
    ];

    function generateFeedbackText(){
      const sentences = [
        choice(POSITIVE_SNIPPETS),
        choice(NEUTRAL_SNIPPETS),
        choice(IMPROVE_SNIPPETS)
      ];
      // 2 or 3 sentences for a bit longer feedback
      const take = rand(2,3);
      return sentences.slice(0, take).join(" ");
    }

    function generateDataset(n=30){
      const today = Date.now();
      const oneYear = 365 * 24 * 60 * 60 * 1000;
      const rows = [];
      for (let i=0;i<n;i++){
        const event = choice(EVENT_NAMES);
        const name = `${choice(FIRST_NAMES)} ${choice(LAST_NAMES)}`;
        const rating = rand(2,5); // bias towards realistic (fewer extremes)
        const date = today - rand(0, Math.floor(oneYear*0.9)); // within last ~11 months
        const feedback = generateFeedbackText();
        rows.push({
          id: i+1,
          event,
          name,
          rating,
          date,
          feedback
        });
      }
      return rows;
    }

    const state = {
      data: [],
      filtered: [],
      sortBy: 'date',
      sortDir: 'desc',
      query: ''
    };

    function render(){
      const tbody = document.getElementById('tableBody');
      let rows = [...state.data];

      // Filter
      const q = state.query.trim().toLowerCase();
      if (q){
        rows = rows.filter(r => {
          return (
            r.event.toLowerCase().includes(q) ||
            r.name.toLowerCase().includes(q) ||
            r.feedback.toLowerCase().includes(q) ||
            formatDate(r.date).includes(q) ||
            String(r.rating).includes(q)
          );
        });
      }

      // Sort
      const dir = state.sortDir === 'asc' ? 1 : -1;
      const key = state.sortBy;
      rows.sort((a,b) => {
        let va = a[key], vb = b[key];
        if (key === 'event' || key === 'name' || key === 'feedback'){
          va = String(va).toLowerCase();
          vb = String(vb).toLowerCase();
          if (va < vb) return -1*dir;
          if (va > vb) return 1*dir;
          return 0;
        } else if (key === 'rating' || key === 'date'){
          return (va - vb) * dir;
        }
        return 0;
      });

      state.filtered = rows;

      // Build rows
      if (rows.length === 0){
        tbody.innerHTML = `<tr><td colspan="5" class="no-results">No results found. Try adjusting your search.</td></tr>`;
      } else {
        const html = rows.map(r => {
          const dateStr = formatDate(r.date);
          const stars = '★★★★★'.slice(0, r.rating) + '☆☆☆☆☆'.slice(0, 5 - r.rating);
          const feedbackEsc = escapeHtml(r.feedback);
          return `
            <tr data-row-id="${r.id}">
              <td class="col-date" data-label="Date"><span class="muted">${dateStr}</span></td>
              <td class="col-event" data-label="Event">${escapeHtml(r.event)}</td>
              <td class="col-name" data-label="Participant">${escapeHtml(r.name)}</td>
              <td class="col-rating" data-label="Rating">
                <div class="rating">
                  <span class="stars" aria-hidden="true">${stars}</span>
                  <span class="score" aria-label="${r.rating} out of 5">${r.rating}/5</span>
                </div>
              </td>
              <td class="col-feedback" data-label="Feedback">
                <div class="feedback" title="${feedbackEsc}">
                  <div class="clamp clamped">${feedbackEsc}</div>
                </div>
              </td>
            </tr>
          `;
        }).join('');
        tbody.innerHTML = html;
      }

      // Meta
      document.getElementById('resultMeta').textContent = `Showing ${rows.length} of ${state.data.length}`;
      updateSortIndicators();
      updateSummary();
      document.getElementById('timeInfo').textContent = `Updated ${new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}`;
    }

    function escapeHtml(str){
      return str.replace(/[&<>"']/g, m => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      })[m]);
    }

    function updateSortIndicators(){
      const map = {
        date: 'th-date',
        event: 'th-event',
        name: 'th-name',
        rating: 'th-rating',
        feedback: 'th-feedback'
      };
      Object.values(map).forEach(id => {
        const th = document.getElementById(id);
        th.setAttribute('aria-sort', 'none');
      });
      const activeTh = document.getElementById(map[state.sortBy]);
      activeTh.setAttribute('aria-sort', state.sortDir === 'asc' ? 'ascending' : 'descending');
    }

    // AI Summary generator: simple, data-driven
    function updateSummary(){
      const n = state.data.length;
      if (!n) return;
      const all = state.data;
      const minDate = new Date(Math.min(...all.map(r => r.date)));
      const maxDate = new Date(Math.max(...all.map(r => r.date)));
      const avg = (all.reduce((s,r) => s + r.rating, 0) / n).toFixed(1);
      const positivePct = Math.round(all.filter(r => r.rating >= 4).length / n * 100);

      // top events by count
      const counts = {};
      all.forEach(r => counts[r.event] = (counts[r.event]||0)+1);
      const topEvents = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,2).map(([k])=>k);
      const distinctEvents = Object.keys(counts).length;

      const fmt = (d)=>d.toLocaleDateString(undefined,{year:'numeric', month:'short'});
      const summaryText = `30 submissions analyzed across ${distinctEvents} events (${fmt(minDate)}–${fmt(maxDate)}). Average rating is ${avg}/5 and ${positivePct}% are 4–5 stars. Top events by volume: ${topEvents.join(', ')}. Common themes: strong speakers, useful content, and requests for more hands‑on practice.`;
      document.getElementById('aiSummaryText').textContent = summaryText;
    }

    // Event listeners
    function initSortHandlers(){
      document.querySelectorAll('.sort-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const key = btn.dataset.key;
          if (state.sortBy === key){
            state.sortDir = state.sortDir === 'asc' ? 'desc' : 'asc';
          } else {
            state.sortBy = key;
            // sensible default: dates/rating desc; text asc
            state.sortDir = (key === 'date' || key === 'rating') ? 'desc' : 'asc';
          }
          render();
        });
      });
    }

    function initSearch(){
      const input = document.getElementById('searchInput');
      const clearBtn = document.getElementById('clearSearchBtn');
      let t;
      input.addEventListener('input', () => {
        clearTimeout(t);
        t = setTimeout(() => {
          state.query = input.value;
          render();
        }, 120);
      });
      clearBtn.addEventListener('click', () => {
        input.value = '';
        state.query = '';
        render();
        input.focus();
      });
    }

    function initSummaryClose(){
      const closeBtn = document.getElementById('aiSummaryClose');
      const box = document.getElementById('aiSummary');
      closeBtn.addEventListener('click', () => {
        box.style.display = 'none';
      });
    }

    // Boot
    (function(){
      state.data = generateDataset(30);
      initSortHandlers();
      initSearch();
      initSummaryClose();
      render();
    })();
  </script>
</body>
</html>