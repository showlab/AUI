<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8" />
  <title>Nonprofit Impact Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Nonprofit Impact Report - measurable results of programs with infographics, success stories, and donation links." />
  <style>
    :root{
      --bg: #0f1020;
      --bg-2:#111430;
      --card:#171a3f;
      --text:#eef2ff;
      --muted:#b9c2ff;
      --accent:#6df0c2;
      --accent-2:#6ea8ff;
      --accent-3:#ffc86e;
      --danger:#ff6e8c;
      --shadow:0 10px 40px rgba(0,0,0,.35);
      --radius:16px;
      --radius-sm:10px;
      --glass:rgba(255,255,255,.06);
      --glass-2:rgba(255,255,255,.12);
      --gradient: linear-gradient(135deg, #1d2259 0%, #103d6a 40%, #0b6a68 100%);
      --accent-grad: linear-gradient(135deg, #6df0c2 0%, #6ea8ff 100%);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text); background: radial-gradient(1200px 600px at 20% -10%, #1a2155 0%, #0b1339 40%, #0a0d2a 100%), var(--bg);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      overflow-x:hidden;
    }
    a{color:inherit}
    .container{max-width:1180px; margin:0 auto; padding:0 20px}
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(8px);
      background:linear-gradient(180deg, rgba(10,13,42,.9), rgba(10,13,42,.4));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0;
    }
    .brand{
      display:flex; align-items:center; gap:12px; text-decoration:none;
    }
    .logo{
      width:38px; height:38px; border-radius:12px;
      background: conic-gradient(from 200deg, #6df0c2, #6ea8ff, #ffc86e, #6df0c2);
      box-shadow: 0 0 0 3px rgba(255,255,255,.08), inset 0 0 30px rgba(255,255,255,.25);
    }
    .brand h1{font-size:18px; margin:0; letter-spacing:.4px}
    nav ul{display:flex; gap:18px; list-style:none; margin:0; padding:0}
    nav a{padding:8px 12px; border-radius:10px; text-decoration:none; color:var(--muted)}
    nav a:hover{background:var(--glass-2); color:var(--text)}
    .btn{
      background:var(--accent-grad); color:#0a0d2a; font-weight:700; border:none;
      padding:10px 16px; border-radius:12px; cursor:pointer; box-shadow: var(--shadow);
      transition: transform .15s ease;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn.secondary{
      background: transparent; color:var(--text); border:1px solid rgba(255,255,255,.2)
    }
    .btn.ghost{
      background:transparent; border:1px solid rgba(255,255,255,.12); color:var(--muted)
    }
    .hero{
      position:relative; padding:58px 0 28px;
      background:
        radial-gradient(800px 400px at 80% -10%, rgba(110,168,255,.25), transparent 60%),
        radial-gradient(700px 300px at 10% 0%, rgba(109,240,194,.2), transparent 60%);
    }
    .hero-inner{
      display:grid; grid-template-columns: 1.1fr .9fr; gap:24px; align-items:center;
    }
    .hero h2{margin:0 0 10px; font-size:38px; line-height:1.15}
    .hero p{margin:0 0 18px; color:var(--muted)}
    .chip{
      display:inline-flex; align-items:center; gap:8px; font-weight:600; color:#0a0d2a;
      background:var(--accent-grad); padding:6px 10px; border-radius:999px; margin-bottom:12px;
    }
    .kpigrid{display:grid; grid-template-columns: repeat(3, 1fr); gap:14px; margin-top:16px}
    .kpi{
      background: var(--glass); border:1px solid rgba(255,255,255,.1); border-radius:14px; padding:14px;
      box-shadow: var(--shadow);
    }
    .kpi h3{margin:0; font-size:14px; color:var(--muted)}
    .kpi .num{font-size:24px; font-weight:800; margin-top:6px}
    .visual{
      background: var(--gradient); border-radius: 18px; padding:18px; position:relative; overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
    }
    .visual .orb{
      position:absolute; filter: blur(60px); opacity:.6;
      width:240px; height:240px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, rgba(109,240,194,.7), transparent 60%);
      top:-40px; right:-40px;
    }
    .visual .orb2{
      position:absolute; filter: blur(60px); opacity:.5;
      width:200px; height:200px; border-radius:50%;
      background: radial-gradient(circle at 40% 40%, rgba(110,168,255,.7), transparent 60%);
      bottom:-50px; left:-30px;
    }
    .controls{
      display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-top:12px
    }
    .control{
      background: var(--glass); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:10px 12px; display:flex; gap:8px; align-items:center;
    }
    label{font-size:13px; color:var(--muted)}
    select, input[type="range"]{
      appearance:none; background: transparent; color: var(--text); border:none; outline:none;
    }
    input[type="range"]{width:180px}
    .segmented{
      display:flex; background:var(--glass); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:4px;
    }
    .segmented button{
      border:none; background:transparent; color:var(--muted); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:700
    }
    .segmented button.active{
      background:var(--accent-grad); color:#0a0d2a;
    }
    .panel{
      background: var(--card); border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:16px; box-shadow: var(--shadow);
    }
    .infographics{
      display:grid; grid-template-columns: 1.2fr .8fr; gap:16px; margin-top:14px;
    }
    .chart-title{display:flex; justify-content:space-between; align-items:center; margin-bottom:10px}
    .legend{display:flex; gap:8px; align-items:center; color:var(--muted); font-size:12px}
    .legend .dot{width:10px; height:10px; border-radius:50%}
    .chartwrap{position:relative; min-height:260px}
    .tooltip{
      position:absolute; pointer-events:none; background:#0b0f2a; color:var(--text); border:1px solid rgba(255,255,255,.2);
      padding:6px 8px; border-radius:8px; font-size:12px; box-shadow: var(--shadow); opacity:0; transform:translate(-50%,-120%); transition:opacity .12s ease;
      z-index:10;
    }
    svg{width:100%; height:260px; display:block}
    .donut-center{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; pointer-events:none;
    }
    .donut-center .big{font-size:28px; font-weight:800}
    .donut-center .small{font-size:12px; color:var(--muted)}
    .stories{
      margin:42px 0 8px;
      display:grid; grid-template-columns: .9fr 1.1fr; gap:20px; align-items:start;
    }
    .story-filter{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .carousel{
      background: var(--card); border:1px solid rgba(255,255,255,.12); border-radius:16px; padding:0; overflow:hidden; box-shadow: var(--shadow);
      position:relative;
    }
    .slides{display:grid; grid-auto-flow:column; grid-auto-columns:100%; transition: transform .35s ease}
    .slide{
      padding:18px; display:grid; grid-template-columns: .8fr 1.2fr; gap:16px; align-items:center;
    }
    .thumb{
      min-height:220px; border-radius:12px; background: linear-gradient(160deg, rgba(109,240,194,.3), rgba(110,168,255,.3)), radial-gradient(200px 200px at 30% 30%, rgba(255,200,110,.3), transparent 60%);
      border:1px solid rgba(255,255,255,.12);
    }
    .slide h3{margin:0 0 6px}
    .tag{display:inline-block; font-size:12px; color:#0a0d2a; background:var(--accent-grad); padding:4px 8px; border-radius:999px; font-weight:700}
    .slide p{color:var(--muted)}
    .slide .more{margin-top:6px; display:none; color:var(--muted)}
    .slide.expanded .more{display:block}
    .carousel-controls{
      display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border-top:1px solid rgba(255,255,255,.08)
    }
    .dots{display:flex; gap:6px}
    .dotbtn{width:10px; height:10px; border-radius:50%; border:none; background:rgba(255,255,255,.25); cursor:pointer}
    .dotbtn.active{background: linear-gradient(135deg, #6df0c2, #6ea8ff)}
    .cta{
      margin:28px 0 48px; display:grid; grid-template-columns: 1.2fr .8fr; gap:16px; align-items:stretch;
    }
    .progress{
      height:10px; background:rgba(255,255,255,.12); border-radius:999px; overflow:hidden
    }
    .progress > span{
      display:block; height:100%; background:var(--accent-grad); width:0%
    }
    .pledge{
      display:grid; gap:10px;
    }
    .pledge .impact-note{color:var(--muted); font-size:14px}
    footer{
      padding:30px 0; border-top:1px solid rgba(255,255,255,.1); color:var(--muted)
    }
    .socials{display:flex; gap:10px}
    .to-top{
      position:fixed; right:18px; bottom:18px; z-index:40;
      opacity:0; transform: translateY(10px); transition: all .2s ease;
    }
    .to-top.show{opacity:1; transform: translateY(0)}
    /* Responsive */
    @media (max-width: 1000px){
      .hero-inner, .infographics, .stories, .cta{grid-template-columns: 1fr}
      .slide{grid-template-columns: 1fr}
      .kpigrid{grid-template-columns: 1fr 1fr 1fr}
    }
    @media (max-width: 640px){
      .kpigrid{grid-template-columns: 1fr 1fr}
      .controls{flex-direction:column; align-items:flex-start}
      .kpi .num{font-size:20px}
    }
    /* Range styling (basic) */
    input[type=range]::-webkit-slider-runnable-track {height:6px; background:rgba(255,255,255,.2); border-radius:999px}
    input[type=range]::-webkit-slider-thumb {appearance:none; margin-top:-6px; width:18px; height:18px; border-radius:50%; background:linear-gradient(135deg,#6df0c2,#6ea8ff); box-shadow:0 0 0 4px rgba(109,240,194,.2)}
    input[type=range]::-moz-range-track{height:6px; background:rgba(255,255,255,.2); border-radius:999px}
    input[type=range]::-moz-range-thumb{width:18px; height:18px; border-radius:50%; background:linear-gradient(135deg,#6df0c2,#6ea8ff); border:none; box-shadow:0 0 0 4px rgba(109,240,194,.2)}
    /* Focus ring */
    .focusable:focus{outline:2px solid #6ea8ff; outline-offset:2px; border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="container nav" role="navigation" aria-label="Main">
      <a href="#" class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>Nonprofit Impact Report</h1>
      </a>
      <nav>
        <ul>
          <li><a class="focusable" href="#impact">Impact</a></li>
          <li><a class="focusable" href="#stories">Success Stories</a></li>
          <li><a class="focusable" href="#donate">Get Involved</a></li>
        </ul>
      </nav>
      <button id="donateHeaderBtn" class="btn" aria-label="Donate from header" onclick="document.getElementById('donate').scrollIntoView({behavior:'smooth'})">Donate</button>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container hero-inner">
        <div>
          <span class="chip" aria-hidden="true">Impact that inspires</span>
          <h2>Real change. Measurable results.</h2>
          <p>We invest in education, health, and the environment to help communities thrive. Explore our data, meet the people behind the numbers, and join us in making a difference.</p>
          <div>
            <button id="exploreImpactBtn" class="btn" aria-label="Explore Impact">Explore Impact</button>
            <button id="learnMoreBtn" class="btn ghost" aria-label="Learn more" onclick="document.getElementById('stories').scrollIntoView({behavior:'smooth'})">Read Stories</button>
          </div>
          <div class="kpigrid" aria-label="Key performance indicators">
            <div class="kpi">
              <h3>People Reached (YTD)</h3>
              <div id="kpiPeople" class="num" aria-live="polite">—</div>
            </div>
            <div class="kpi">
              <h3>Communities Served</h3>
              <div id="kpiCommunities" class="num" aria-live="polite">—</div>
            </div>
            <div class="kpi">
              <h3>Volunteers</h3>
              <div id="kpiVolunteers" class="num" aria-live="polite">—</div>
            </div>
          </div>
        </div>
        <div class="visual" aria-hidden="true">
          <div class="orb"></div><div class="orb2"></div>
          <svg viewBox="0 0 420 260" role="img" aria-label="Decorative wave">
            <defs>
              <linearGradient id="gradA" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0" stop-color="#6df0c2"/>
                <stop offset="1" stop-color="#6ea8ff"/>
              </linearGradient>
            </defs>
            <path d="M0,170 C60,120 120,190 180,150 C240,110 300,170 360,140 C380,130 400,120 420,120 L420,260 L0,260 Z" fill="url(#gradA)" opacity=".5"/>
            <path d="M0,140 C60,100 120,160 180,120 C240,80 300,140 360,110 C380,100 400,90 420,90" fill="none" stroke="url(#gradA)" stroke-width="6" stroke-linecap="round"/>
          </svg>
        </div>
      </div>
    </section>

    <section id="impact" class="container" aria-labelledby="impactTitle">
      <div class="controls">
        <div class="control">
          <label for="programSelect">Program</label>
          <select id="programSelect" class="focusable" aria-label="Choose program">
            <option>Education</option>
            <option>Health</option>
            <option>Environment</option>
          </select>
        </div>
        <div class="control">
          <label for="yearRange">Year</label>
          <input id="yearRange" class="focusable" type="range" min="2019" max="2025" step="1" value="2024" />
          <strong id="yearLabel">2024</strong>
        </div>
        <div class="segmented" role="tablist" aria-label="Metric toggle">
          <button id="metricTogglePeople" role="tab" aria-selected="true" class="active">People Reached</button>
          <button id="metricToggleFunds" role="tab" aria-selected="false">Funds Utilized</button>
        </div>
      </div>

      <div class="infographics" aria-label="Program infographics">
        <article class="panel" aria-labelledby="barTitle">
          <div class="chart-title">
            <h3 id="barTitle" style="margin:0">Impact by Region</h3>
            <div class="legend">
              <span class="dot" style="background:#6df0c2"></span> Current selection
            </div>
          </div>
          <div id="barChartWrap" class="chartwrap">
            <div id="barTooltip" class="tooltip" role="tooltip" aria-hidden="true"></div>
            <svg id="barChart" aria-labelledby="barTitle" role="img"></svg>
          </div>
        </article>

        <aside class="panel" aria-labelledby="donutTitle">
          <div class="chart-title">
            <h3 id="donutTitle" style="margin:0">Goal Progress</h3>
          </div>
          <div class="chartwrap" style="min-height:240px; position:relative">
            <svg id="donutChart" viewBox="0 0 240 240" role="img" aria-labelledby="donutTitle">
              <defs>
                <linearGradient id="donutGrad" x1="0" x2="1" y1="0" y2="1">
                  <stop offset="0" stop-color="#6df0c2"/>
                  <stop offset="1" stop-color="#6ea8ff"/>
                </linearGradient>
              </defs>
              <circle cx="120" cy="120" r="88" stroke="rgba(255,255,255,.15)" stroke-width="20" fill="none"/>
              <circle id="donutArc" cx="120" cy="120" r="88" stroke="url(#donutGrad)" stroke-width="20" stroke-linecap="round" fill="none" transform="rotate(-90 120 120)" stroke-dasharray="0 999"/>
            </svg>
            <div class="donut-center">
              <div id="donutBig" class="big">0%</div>
              <div id="donutSmall" class="small">of annual target</div>
            </div>
          </div>
          <div style="margin-top:8px; color:var(--muted); font-size:14px">
            Target reflects yearly goals for each program. Progress updates with selected year and metric.
          </div>
        </aside>
      </div>
    </section>

    <section id="stories" class="container stories" aria-labelledby="storyTitle">
      <div>
        <h2 id="storyTitle" style="margin:0 0 8px">Success Stories</h2>
        <p style="color:var(--muted); margin-top:0">Data tells one side of the story. Meet the people and places where your support made a difference.</p>
        <div class="story-filter">
          <div class="control">
            <label for="storyProgramSelect">Filter</label>
            <select id="storyProgramSelect" class="focusable" aria-label="Filter stories by program">
              <option value="All">All</option>
              <option value="Education">Education</option>
              <option value="Health">Health</option>
              <option value="Environment">Environment</option>
            </select>
          </div>
          <div class="control">
            <label for="autoplayToggle">Autoplay</label>
            <input id="autoplayToggle" class="focusable" type="checkbox" aria-label="Toggle autoplay" />
          </div>
        </div>
      </div>

      <div class="carousel" aria-roledescription="carousel" aria-label="Impact stories">
        <div id="slides" class="slides">
          <!-- Slides will be injected -->
        </div>
        <div class="carousel-controls">
          <div>
            <button id="prevStory" class="btn secondary" aria-label="Previous story">Prev</button>
            <button id="nextStory" class="btn" aria-label="Next story">Next</button>
          </div>
          <div id="dots" class="dots" role="tablist" aria-label="Slide dots"></div>
        </div>
      </div>
    </section>

    <section id="donate" class="container cta" aria-labelledby="donateTitle">
      <article class="panel">
        <h2 id="donateTitle" style="margin-top:0">Fuel the next chapter</h2>
        <p style="color:var(--muted)">We are on track to reach more communities this year. Help us go further.</p>
        <div style="display:grid; gap:10px; margin:14px 0">
          <div style="display:flex; justify-content:space-between; color:var(--muted); font-size:14px">
            <span>Monthly goal</span>
            <span><strong id="goalRaised">$0</strong> raised of <strong id="goalTotal">$0</strong></span>
          </div>
          <div class="progress" aria-label="Donation progress">
            <span id="goalProgressBar" style="width:0%"></span>
          </div>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <a id="donateLink" class="btn" href="https://example.org/donate" target="_blank" rel="noopener" aria-label="Donate now in new tab">Donate Now</a>
          <button id="shareBtn" class="btn ghost" aria-label="Copy link to share">Share Impact</button>
        </div>
      </article>

      <aside class="panel pledge" aria-labelledby="pledgeTitle">
        <h3 id="pledgeTitle" style="margin:0">Pledge calculator</h3>
        <label for="pledgeSlider">Choose an amount</label>
        <input id="pledgeSlider" class="focusable" type="range" min="10" max="1000" step="10" value="100" />
        <div><strong id="pledgeAmount">$100</strong></div>
        <div class="impact-note" id="pledgeImpact" aria-live="polite">Your gift could provide 300 days of clean water.</div>
      </aside>
    </section>
  </main>

  <footer>
    <div class="container" style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap">
      <div>© <span id="yearNow"></span> Nonprofit Impact Report</div>
      <div class="socials" aria-label="Social links">
        <a class="focusable" href="#" aria-label="Twitter" title="Twitter">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53A4.48 4.48 0 0 0 12 8v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83"/></svg>
        </a>
        <a class="focusable" href="#" aria-label="LinkedIn" title="LinkedIn">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
        </a>
        <a class="focusable" href="#" aria-label="YouTube" title="YouTube">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.95-2C18.88 3.88 12 3.88 12 3.88s-6.88 0-8.59.54a2.78 2.78 0 0 0-1.95 2A29.94 29.94 0 0 0 .5 12a29.94 29.94 0 0 0 .96 5.58 2.78 2.78 0 0 0 1.95 2c1.71.54 8.59.54 8.59.54s6.88 0 8.59-.54a2.78 2.78 0 0 0 1.95-2A29.94 29.94 0 0 0 23.5 12a29.94 29.94 0 0 0-.96-5.58z"/><polygon points="9.75 15.02 15.5 12 9.75 8.98 9.75 15.02"/></svg>
        </a>
      </div>
    </div>
  </footer>

  <button id="backToTopBtn" class="btn to-top" aria-label="Back to top">Back to top</button>

  <script>
    // Data and utility
    const regions = ["Americas","Africa","Asia","Europe"];
    const programs = ["Education","Health","Environment"];
    const state = {
      year: 2024,
      program: "Education",
      metric: "people", // 'people' or 'funds'
      autoplay: false,
      slideIndex: 0
    };

    function seededRandom(seed){
      let x = Math.sin(seed) * 10000; return x - Math.floor(x);
    }
    function programSeed(program, year){return Array.from(program).reduce((a,c)=>a+c.charCodeAt(0),0) + year*7;}
    function niceNumber(n){ // formats numbers nicely
      if (n >= 1e9) return (n/1e9).toFixed(2).replace(/\.00$/,'') + "B";
      if (n >= 1e6) return (n/1e6).toFixed(2).replace(/\.00$/,'') + "M";
      if (n >= 1e3) return (n/1e3).toFixed(1).replace(/\.0$/,'') + "k";
      return String(n);
    }

    function computeData(program, year){
      const seed = programSeed(program, year);
      const regionData = regions.map((r, i)=>{
        const s = seededRandom(seed + i*19);
        // Determine base scaled by program flavor
        const base = program==="Education"? 22000 : program==="Health"? 26000 : 18000;
        const variance = (s*0.6 + 0.7); // 0.7 - 1.3
        const people = Math.round(base * variance + (year-2019)*1200 + (i*900));
        const funds = Math.round(people * (program==="Health" ? 42 : program==="Education" ? 30 : 38)); // $ per person proxy
        return {region: r, people, funds};
      });
      const totals = regionData.reduce((acc, d)=>({people:acc.people+d.people, funds:acc.funds+d.funds}), {people:0, funds:0});
      const communities = Math.max(12, Math.round(totals.people / 380));
      const volunteers = Math.round(totals.people / (program==="Health"? 18 : 22));
      // Goal definitions
      const baseGoalPeople = program==="Education"? 90000 : program==="Health"? 110000 : 80000;
      const goalPeople = Math.round(baseGoalPeople + (year-2019)*4500);
      const goalFunds = Math.round(goalPeople * (program==="Health" ? 40 : program==="Education" ? 28 : 34));
      return {
        program, year, regionData, totals, communities, volunteers, goals: {people: goalPeople, funds: goalFunds}
      };
    }

    // DOM references
    const kpiPeople = document.getElementById('kpiPeople');
    const kpiCommunities = document.getElementById('kpiCommunities');
    const kpiVolunteers = document.getElementById('kpiVolunteers');
    const programSelect = document.getElementById('programSelect');
    const yearRange = document.getElementById('yearRange');
    const yearLabel = document.getElementById('yearLabel');
    const metricTogglePeople = document.getElementById('metricTogglePeople');
    const metricToggleFunds = document.getElementById('metricToggleFunds');
    const barChart = document.getElementById('barChart');
    const barTooltip = document.getElementById('barTooltip');
    const donutArc = document.getElementById('donutArc');
    const donutBig = document.getElementById('donutBig');
    const donutSmall = document.getElementById('donutSmall');
    const exploreBtn = document.getElementById('exploreImpactBtn');
    const donateLink = document.getElementById('donateLink');
    const backToTopBtn = document.getElementById('backToTopBtn');
    const shareBtn = document.getElementById('shareBtn');
    const pledgeSlider = document.getElementById('pledgeSlider');
    const pledgeAmount = document.getElementById('pledgeAmount');
    const pledgeImpact = document.getElementById('pledgeImpact');
    const goalRaisedEl = document.getElementById('goalRaised');
    const goalTotalEl = document.getElementById('goalTotal');
    const goalBar = document.getElementById('goalProgressBar');
    const yearNowEl = document.getElementById('yearNow');

    // Event listeners
    programSelect.addEventListener('change', (e)=>{ state.program = e.target.value; renderAll(); });
    yearRange.addEventListener('input', (e)=>{ state.year = +e.target.value; yearLabel.textContent = String(state.year); renderAll(); });
    metricTogglePeople.addEventListener('click', ()=>{
      state.metric = 'people';
      metricTogglePeople.classList.add('active'); metricTogglePeople.setAttribute('aria-selected','true');
      metricToggleFunds.classList.remove('active'); metricToggleFunds.setAttribute('aria-selected','false');
      renderCharts();
    });
    metricToggleFunds.addEventListener('click', ()=>{
      state.metric = 'funds';
      metricToggleFunds.classList.add('active'); metricToggleFunds.setAttribute('aria-selected','true');
      metricTogglePeople.classList.remove('active'); metricTogglePeople.setAttribute('aria-selected','false');
      renderCharts();
    });
    exploreBtn.addEventListener('click', ()=>{
      document.getElementById('impact').scrollIntoView({behavior:'smooth'});
    });
    window.addEventListener('scroll', ()=>{
      const show = window.scrollY > 600;
      backToTopBtn.classList.toggle('show', show);
    });
    backToTopBtn.addEventListener('click', ()=>window.scrollTo({top:0, behavior:'smooth'}));
    shareBtn.addEventListener('click', async ()=>{
      const shareData = {
        title: 'Nonprofit Impact Report',
        text: 'See the measurable results of our programs.',
        url: location.href
      };
      try{
        if (navigator.share) {
          await navigator.share(shareData);
        } else {
          await navigator.clipboard.writeText(location.href);
          shareBtn.textContent = "Link copied!";
          setTimeout(()=>shareBtn.textContent = "Share Impact", 1500);
        }
      }catch(e){}
    });
    pledgeSlider.addEventListener('input', ()=>{
      const val = +pledgeSlider.value;
      pledgeAmount.textContent = `$${val}`;
      updatePledgeImpact(val);
    });

    // KPI and Chart rendering
    function countUp(el, to, duration=800){
      const start = performance.now();
      const from = 0;
      const formatCurrency = el.dataset.currency === "1";
      function frame(now){
        const p = Math.min(1, (now - start)/duration);
        const val = Math.floor(from + (to - from)*p);
        el.textContent = formatCurrency ? "$" + niceNumber(val) : niceNumber(val);
        if (p < 1) requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }

    function renderKPIs(data){
      countUp(kpiPeople, data.totals.people);
      countUp(kpiCommunities, data.communities);
      countUp(kpiVolunteers, data.volunteers);
    }

    function renderBarChart(data){
      const metric = state.metric;
      const w = barChart.clientWidth || 560;
      const h = 260;
      const padding = {l:50, r:18, t:10, b:34};
      const chartW = w - padding.l - padding.r;
      const chartH = h - padding.t - padding.b;
      barChart.setAttribute('viewBox', `0 0 ${w} ${h}`);
      while (barChart.firstChild) barChart.removeChild(barChart.firstChild);

      // Axes (minimal)
      const axis = document.createElementNS("http://www.w3.org/2000/svg","line");
      axis.setAttribute("x1", padding.l); axis.setAttribute("y1", h - padding.b);
      axis.setAttribute("x2", w - padding.r); axis.setAttribute("y2", h - padding.b);
      axis.setAttribute("stroke", "rgba(255,255,255,.25)"); axis.setAttribute("stroke-width", "1");
      barChart.appendChild(axis);

      const maxVal = Math.max(...data.regionData.map(d=>d[metric])) * 1.1;
      const barW = chartW / data.regionData.length * 0.6;
      data.regionData.forEach((d, i)=>{
        const x = padding.l + (i+0.2) * (chartW / data.regionData.length);
        const val = d[metric];
        const barH = Math.max(2, val / maxVal * chartH);
        const y = h - padding.b - barH;
        const rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
        rect.setAttribute("x", x);
        rect.setAttribute("y", y);
        rect.setAttribute("width", barW);
        rect.setAttribute("height", barH);
        rect.setAttribute("rx", 6);
        rect.setAttribute("fill", "url(#gradBar"+i+")");
        rect.setAttribute("tabindex", "0");
        rect.setAttribute("role", "img");
        rect.setAttribute("aria-label", `${d.region}: ${metric==='people'? d.people + ' people' : '$'+ niceNumber(d.funds)}`);
        rect.addEventListener('mouseenter', (ev)=>showBarTooltip(ev, d));
        rect.addEventListener('mousemove', (ev)=>moveTooltip(ev));
        rect.addEventListener('mouseleave', hideTooltip);
        rect.addEventListener('focus', (ev)=>showBarTooltip(ev, d));
        rect.addEventListener('blur', hideTooltip);

        // Grad for each bar
        const defs = document.createElementNS("http://www.w3.org/2000/svg","defs");
        const lg = document.createElementNS("http://www.w3.org/2000/svg","linearGradient");
        lg.setAttribute("id","gradBar"+i); lg.setAttribute("x1","0"); lg.setAttribute("x2","0"); lg.setAttribute("y1","0"); lg.setAttribute("y2","1");
        const s1 = document.createElementNS("http://www.w3.org/2000/svg","stop");
        s1.setAttribute("offset","0%"); s1.setAttribute("stop-color", metric==='people' ? "#6df0c2" : "#ffc86e");
        const s2 = document.createElementNS("http://www.w3.org/2000/svg","stop");
        s2.setAttribute("offset","100%"); s2.setAttribute("stop-color", metric==='people' ? "#6ea8ff" : "#ff8f6e");
        lg.appendChild(s1); lg.appendChild(s2); defs.appendChild(lg);
        barChart.appendChild(defs);

        // Animate bars
        rect.style.transition = "y .4s ease, height .4s ease";
        barChart.appendChild(rect);

        // Labels
        const lbl = document.createElementNS("http://www.w3.org/2000/svg","text");
        lbl.setAttribute("x", x + barW/2); lbl.setAttribute("y", h - padding.b + 20);
        lbl.setAttribute("text-anchor","middle"); lbl.setAttribute("fill","rgba(255,255,255,.8)");
        lbl.setAttribute("font-size","12"); lbl.textContent = d.region;
        barChart.appendChild(lbl);
      });
    }

    function showBarTooltip(ev, d){
      const metric = state.metric;
      const valStr = metric==='people' ? `${niceNumber(d.people)} people` : `$${niceNumber(d.funds)}`;
      barTooltip.innerHTML = `<strong>${d.region}</strong><br>${valStr}`;
      barTooltip.style.left = ev.clientX + 'px';
      barTooltip.style.top = ev.clientY + 'px';
      barTooltip.style.opacity = 1;
      barTooltip.setAttribute('aria-hidden', 'false');
    }
    function moveTooltip(ev){
      barTooltip.style.left = ev.clientX + 'px';
      barTooltip.style.top = (ev.clientY - 10) + 'px';
    }
    function hideTooltip(){
      barTooltip.style.opacity = 0;
      barTooltip.setAttribute('aria-hidden', 'true');
    }

    function renderDonut(data){
      const metric = state.metric;
      const actual = metric==='people' ? data.totals.people : data.totals.funds;
      const goal = metric==='people' ? data.goals.people : data.goals.funds;
      const pct = Math.max(0, Math.min(1, actual / goal));
      const r = 88;
      const circ = 2 * Math.PI * r;
      const dash = `${(circ * pct).toFixed(2)} ${(circ * (1-pct)).toFixed(2)}`;
      donutArc.setAttribute('stroke-dasharray', dash);
      donutBig.textContent = Math.round(pct*100) + "%";
      donutSmall.textContent = metric==='people' ? "of people target" : "of funds target";
    }

    function renderCharts(){
      const data = computeData(state.program, state.year);
      renderBarChart(data);
      renderDonut(data);
      renderKPIs(data);
    }

    // Success stories
    const stories = [
      {
        program:"Education",
        title:"Books to Broadband",
        excerpt:"In rural districts, we expanded a library into a digital hub.",
        detail:"Through local partnerships, we trained student mentors and provided community Wi‑Fi access. Attendance rose 22% and graduation rates improved in two years.",
      },
      {
        program:"Health",
        title:"Mobile Clinic, Lasting Trust",
        excerpt:"A mobile clinic brought care to remote villages weekly.",
        detail:"Over 18 months, nurses screened 5,000 residents and reduced treatable illnesses by 31%. Community health workers now manage follow‑ups locally.",
      },
      {
        program:"Environment",
        title:"Mangroves that Protect",
        excerpt:"Coastal families planted mangroves to shield their homes.",
        detail:"With 40,000 seedlings and youth leadership, erosion slowed and fisheries rebounded. The project also created eco‑tourism jobs.",
      },
      {
        program:"Education",
        title:"STEM for Girls",
        excerpt:"A mentorship network for girls in STEM changed career paths.",
        detail:"After 12 weekend bootcamps, participants reported greater confidence and 65% pursued advanced courses the next semester.",
      },
      {
        program:"Health",
        title:"Clean Water, Clear Futures",
        excerpt:"Low‑cost filtration systems cut waterborne disease dramatically.",
        detail:"Local technicians now maintain the filters, ensuring sustainability. School absenteeism dropped by 17% in the first term.",
      },
      {
        program:"Environment",
        title:"Turning Waste into Wages",
        excerpt:"Community composting reduced landfill waste and created income.",
        detail:"Farmers buy nutrient‑rich compost at affordable prices while households earn credits for sorted waste.",
      }
    ];

    const slidesEl = document.getElementById('slides');
    const dotsEl = document.getElementById('dots');
    const prevStory = document.getElementById('prevStory');
    const nextStory = document.getElementById('nextStory');
    const storyProgramSelect = document.getElementById('storyProgramSelect');
    const autoplayToggle = document.getElementById('autoplayToggle');
    let autoplayTimer = null;

    function getFilteredStories(){
      const sel = storyProgramSelect.value;
      return sel==="All" ? stories : stories.filter(s=>s.program===sel);
    }
    function renderStories(){
      const list = getFilteredStories();
      slidesEl.innerHTML = "";
      dotsEl.innerHTML = "";
      list.forEach((s, idx)=>{
        const slide = document.createElement('article');
        slide.className='slide';
        slide.setAttribute('role','group');
        slide.setAttribute('aria-roledescription','slide');
        slide.setAttribute('aria-label', `${s.title} (${s.program})`);
        slide.innerHTML = `
          <div class="thumb" aria-hidden="true"></div>
          <div>
            <span class="tag">${s.program}</span>
            <h3>${s.title}</h3>
            <p>${s.excerpt}</p>
            <p class="more">${s.detail}</p>
            <button class="btn ghost" aria-label="Read more about ${s.title}">Read more</button>
          </div>
        `;
        const btn = slide.querySelector('button');
        btn.addEventListener('click', ()=>{
          const expanded = slide.classList.toggle('expanded');
          btn.textContent = expanded ? "Show less" : "Read more";
          btn.setAttribute('aria-expanded', expanded ? 'true' : 'false');
        });
        slidesEl.appendChild(slide);

        const dot = document.createElement('button');
        dot.className = 'dotbtn';
        dot.setAttribute('aria-label', `Go to slide ${idx+1}`);
        dot.addEventListener('click', ()=>goToSlide(idx));
        dotsEl.appendChild(dot);
      });
      state.slideIndex = 0;
      updateCarousel();
    }
    function updateCarousel(){
      const count = slidesEl.children.length;
      const idx = ((state.slideIndex % count) + count) % count;
      state.slideIndex = idx;
      slidesEl.style.transform = `translateX(-${idx*100}%)`;
      Array.from(dotsEl.children).forEach((d,i)=>d.classList.toggle('active', i===idx));
    }
    function goToSlide(i){
      state.slideIndex = i;
      updateCarousel();
      resetAutoplay();
    }
    prevStory.addEventListener('click', ()=>{ state.slideIndex--; updateCarousel(); resetAutoplay(); });
    nextStory.addEventListener('click', ()=>{ state.slideIndex++; updateCarousel(); resetAutoplay(); });
    storyProgramSelect.addEventListener('change', ()=>{ renderStories(); resetAutoplay(); });
    autoplayToggle.addEventListener('change', (e)=>{
      state.autoplay = e.target.checked;
      resetAutoplay();
    });
    function startAutoplay(){
      clearInterval(autoplayTimer);
      if (!state.autoplay) return;
      autoplayTimer = setInterval(()=>{ state.slideIndex++; updateCarousel(); }, 4000);
    }
    function resetAutoplay(){
      clearInterval(autoplayTimer);
      startAutoplay();
    }

    // Donation progress and pledge impact
    function renderDonationProgress(){
      const goal = 120000; // monthly goal
      // simulate raised amount based on current date
      const today = new Date();
      const day = today.getDate();
      const daysInMonth = new Date(today.getFullYear(), today.getMonth()+1, 0).getDate();
      const raised = Math.round(goal * (0.35 + 0.5 * (day/daysInMonth))); // 35%-85% over month
      goalRaisedEl.textContent = "$" + niceNumber(raised);
      goalTotalEl.textContent = "$" + niceNumber(goal);
      const pct = Math.min(100, Math.round(raised/goal*100));
      goalBar.style.width = pct + "%";
      goalBar.style.transition = "width .7s ease";
    }
    function updatePledgeImpact(amount){
      // Simple conversion assumptions
      const waterDays = amount * 3;
      const meals = Math.round(amount / 2);
      const trees = Math.round(amount / 5);
      const text = `Your gift could provide ${waterDays} days of clean water, ${meals} nutritious meals, or ${trees} trees planted.`;
      pledgeImpact.textContent = text;
    }

    // Initialize
    function renderAll(){
      yearLabel.textContent = state.year;
      renderCharts();
    }

    function init(){
      yearNowEl.textContent = new Date().getFullYear();
      // KPI currency flag example
      [kpiPeople, kpiCommunities, kpiVolunteers].forEach(el=>el.dataset.currency="0");
      renderAll();
      renderStories();
      renderDonationProgress();
      updatePledgeImpact(+pledgeSlider.value);
      startAutoplay();

      // Accessibility: keyboard for metric tabs
      [metricTogglePeople, metricToggleFunds].forEach(btn=>{
        btn.addEventListener('keydown', (e)=>{
          if (e.key === 'ArrowRight' || e.key === 'ArrowLeft'){
            e.preventDefault();
            if (btn === metricTogglePeople) metricToggleFunds.click(); else metricTogglePeople.click();
          }
        });
      });

      // Donation link analytics-friendly id
      donateLink.addEventListener('click', ()=> {
        // basic ripple feedback
        donateLink.style.transform = 'scale(0.98)';
        setTimeout(()=>donateLink.style.transform='scale(1)',120);
      });
      // Resize chart on window resize for responsiveness
      let resizeTimer;
      window.addEventListener('resize', ()=>{
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(renderCharts, 120);
      });
    }
    init();
  </script>
</body>
</html>